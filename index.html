<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>Lokal</title>

<!-- libs -->
<link rel="stylesheet" href="https://unpkg.com/aos@next/dist/aos.css">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css" crossorigin="anonymous" referrerpolicy="no-referrer"/>

<!-- your styles -->
<link rel="stylesheet" href="style.css">
<link rel="stylesheet" href="cart.css">
<link rel="stylesheet" href="wishlist.css">
<script src="wishlist.js" defer></script>

<!-- GitHub Pages base (adjust if not using GH Pages) -->
<meta name="site-base" content="/Lokal/">

<!-- Asset helpers -->
<script>
  (function(){
    const SITE_BASE = (document.querySelector('meta[name="site-base"]')?.content || "/").replace(/\/+$/, "/");
    const ORIGIN_BASE = location.origin + SITE_BASE;
    window.resolveAsset = function(p){
      if (!p) return "";
      if (/^https?:\/\//i.test(p)) return p;
      const cleaned = String(p).replace(/^\/+/, "");
      const hit = cleaned.match(/(?:^|\/)(images\/.+)$/i);
      const tail = hit ? hit[1] : cleaned;
      try { return new URL(tail, ORIGIN_BASE).href; } catch { return p; }
    };
    window.siteHref = function(rel){
      rel = String(rel || "").replace(/^\//,"");
      return SITE_BASE.replace(/\/$/,"/") + rel;
    };
  })();
</script>

<!-- Minimal extra styles for popup + toast + greeting only (index page) -->
<style>
/* ——— Auth popup ——— */
.lokal-auth.la-overlay{position:fixed;inset:0;background:rgba(0,0,0,.55);display:none;place-items:center;z-index:3000}
.lokal-auth.la-overlay[aria-hidden="false"]{display:grid}
.lokal-auth .la-modal{
  width:min(440px,92vw);background:#fff;border-radius:6px;border:1px solid #D7D6AA;
  box-shadow:0 16px 50px rgba(0,0,0,.25);font-family:system-ui, -apple-system, "Segoe UI", Roboto, Arial, sans-serif;
  animation:fadeIn .25s ease;
}
@keyframes fadeIn{from{opacity:0;transform:scale(.96)}to{opacity:1;transform:scale(1)}}
.lokal-auth .la-head{display:flex;align-items:center;justify-content:space-between;padding:22px 26px 14px 26px;}
.lokal-auth .la-title{font-size:1.05rem;font-weight:700;margin:0;color:#222;}
.lokal-auth .la-close{background:none;border:none;font-size:22px;cursor:pointer;color:#222}
.lokal-auth .la-body{padding:0 26px 20px 26px;}
.lokal-auth .la-intro{font-weight:600;color:#222;margin-bottom:20px;}
.lokal-auth .la-label{display:block;font-size:.9rem;font-weight:600;margin-bottom:6px;color:#222;}
.lokal-auth .la-input{width:100%;padding:13px 12px;border:1px solid #222;border-radius:4px;font-size:.9rem;color:#222;outline:none;}
.lokal-auth .la-input:focus{border-color:#A9A74F;box-shadow:0 0 0 2px rgba(169,167,79,.3);}
.lokal-auth .la-btn{width:100%;padding:14px;border:none;border-radius:4px;background:#6A6932;color:#fff;font-weight:600;cursor:pointer;margin-top:16px;font-size:.95rem;}
.lokal-auth .la-btn:hover{background:#8A8841;}
.lokal-auth .la-sub{text-align:center;margin-top:8px;}
.lokal-auth .la-sub a{color:#222;text-decoration:underline;font-size:.88rem;}
.lokal-auth .la-foot{text-align:center;border-top:1px solid #D7D6AA;padding:18px 0 20px 0;}
.lokal-auth .la-mini{display:flex;justify-content:center;align-items:center;gap:6px;font-size:.85rem;color:#555;}
.lokal-auth .la-mini i{font-size:14px;}

/* ——— Signed-out toast ——— */
.toast-signout {
  position: fixed;
  top: 76px;
  right: 12px;
  z-index: 3000;
  background:#fff;
  border:1px solid #e8e3da;
  border-radius:12px;
  padding:10px 14px;
  box-shadow:0 16px 40px rgba(0,0,0,.12);
  font:600 0.92rem/1.3 system-ui, -apple-system, "Segoe UI", Roboto, Arial, sans-serif;
  color:#2b1f1a;
}
.toast-signout button {
  background:none; border:0; cursor:pointer; font-size:18px; line-height:1;
  padding:0 4px; margin-left:10px; color:#2b1f1a;
}

/* ——— Greeting chip (index only) ——— */
.header{ position: relative; } /* anchor area */
.hi-tag{
  position:absolute;
  top:6px;
  right:14px;              /* TOP-RIGHT like you asked */
  font: 800 0.92rem/1 'Montserrat', system-ui, -apple-system, "Segoe UI", Roboto, Arial, sans-serif;
  color:#2b1f1a;
  pointer-events:none;     /* NEVER blocks clicks */
  z-index:2;
  white-space:nowrap;
}
@media (max-width: 640px){ .hi-tag{ display:none; } }

/* ——— Kill any legacy inline greeting injected by lokal.js ——— */
.inline-greeting { display:none !important; }
#homeGreeting { display:none !important; }
</style>
<style>
  /* Safety net so overlays never block the header when "hidden" */
  #cdOverlay[aria-hidden="true"]{
    display: none !important;
    pointer-events: none !important;
  }
  #cdDrawer[aria-hidden="true"]{
    display: none !important;
    pointer-events: none !important;
  }

  /* Your greeting tag should never block clicks */
  .hi-tag{ pointer-events: none; }
</style>

</head>

<body>

<!-- ========== LOKAL AUTH POPUP (include on every page) ========== -->
<div class="lokal-auth la-overlay" id="lokalAuthOverlay" aria-hidden="true">
  <div class="la-modal" role="dialog" aria-modal="true" aria-labelledby="laTitle">
    <div class="la-head">
      <h3 id="laTitle" class="la-title">SIGN IN</h3>
      <button class="la-close" id="laClose" aria-label="Close">×</button>
    </div>

    <div class="la-body">
      <p class="la-intro">Sign in with your email or sign up to become a Lokal Member.</p>

      <!-- Step 1: Email -->
      <form id="laEmailForm" novalidate>
        <label class="la-label" for="laEmail">Email <span style="color:#b02a37">*</span></label>
        <input class="la-input" id="laEmail" type="email" placeholder="Email" required />
        <button class="la-btn" type="submit">CONTINUE</button>
      </form>

      <!-- Step 2: Password -->
      <form id="laPassForm" hidden novalidate>
        <label class="la-label" for="laPass">Password</label>
        <input class="la-input" id="laPass" type="password" placeholder="••••••" required minlength="6" />
        <button class="la-btn" type="submit">SIGN IN</button>
        <p class="la-sub"><a href="#" id="laBackEmail">Use another email</a></p>
      </form>
    </div>

    <div class="la-foot">
      <div class="la-mini"><i class="fa-solid fa-lock"></i> All data is kept secure</div>
      <a class="la-mlink" href="membership.html">Lokal Membership</a>
    </div>
  </div>
</div>
<!-- ========== /LOKAL AUTH POPUP ========== -->

<!-- HEADER -->
<header class="header">
  <div class="logo">
    <a href="index.html" aria-label="Home">
      <img src="images/projectlogo.png" alt="logo">
    </a>
  </div>

  <div class="nav-center">
    <form class="site-search" action="search.html" method="GET">
      <i class="fa-solid fa-magnifying-glass"></i>
      <input type="search" name="q" placeholder="Search products, categories..." autocomplete="off" />
      <button type="submit">Search</button>
    </form>

    <nav class="main-links">
      <ul>
        <li><a href="best-pick/best-picks.html">Best Picks</a></li>
        <li><a href="shop-all.html">Shop All</a></li>
        <li class="has-megamenu">
          <a href="#" class="catmenu-toggle" aria-expanded="false">
            Shop by Category <i class="fa-solid fa-chevron-down" aria-hidden="true"></i>
          </a>
          <div class="mega" id="catMega" role="menu" aria-label="Shop by Category">
            <h3 class="cat-heading">All Categories</h3>
            <ul class="cat-list">
              <li><a href="shop-all.html?cat=flavors"><i class="fa-solid fa-cookie-bite"></i> Flavors</a></li>
              <li><a href="shop-all.html?cat=accessories"><i class="fa-solid fa-gear"></i> Accessories</a></li>
              <li><a href="shop-all.html?cat=bags"><i class="fa-solid fa-bag-shopping"></i> Bags</a></li>
              <li><a href="shop-all.html?cat=clothing"><i class="fa-solid fa-shirt"></i> Clothing</a></li>
              <li><a href="shop-all.html?cat=home"><i class="fa-solid fa-mug-hot"></i> Home</a></li>
              <li><a href="shop-all.html?cat=crafts"><i class="fa-solid fa-scissors"></i> Crafts</a></li>
              <li><a href="shop-all.html?cat=christmas"><i class="fa-solid fa-snowflake"></i> Christmas / Season</a></li>
            </ul>
          </div>
        </li>
      </ul>
    </nav>
  </div>

  <nav class="utils">
    <ul class="nav-links">
      <!-- IMPORTANT: use # so clicks are JS-handled on every page -->
      <li><a href="#" id="accountLink" aria-label="Account"><i class="fa-solid fa-user"></i></a></li>
      <li>
        <a href="#" id="openCart" aria-label="Open cart">
          <i class="fa-solid fa-cart-shopping"></i>
          <span class="cart-count">0</span>
        </a>
      </li>
      <li style="position: relative;">
        <a href="wishlist.html" aria-label="Favorites" id="wishlistLink">
          <i class="fa-regular fa-heart"></i>
          <span class="wishlist-count" id="wishlistCount">0</span>
        </a>
      </li>
      <li><a href="support.html" aria-label="Support"><i class="fa-solid fa-headset"></i></a></li>
    </ul>
  </nav>

  <!-- Top-right greeting (index only) -->
  <div id="hiTag" class="hi-tag" hidden></div>
</header>

<!-- BANNER -->
<section class="banner">
  <div class="banner-slider">
    <div class="slide active">
      <div class="slide-details">
        <h1>Supporting Local, One Purchase at a Time.</h1>
        <p>Discover a wide variety of everyday essentials and unique finds from trusted local sellers.</p>
        <button class="button" onclick="location.href='shop-all.html'">Shop Now</button>
      </div>
    </div>
    <div class="slide">
      <div class="slide-details">
        <h1>Handmade Crafts for Every Occasion.</h1>
        <p>Unique gifts and décor made with love. Each purchase supports artisans in your community.</p>
        <button class="button" onclick="location.href='shop-all.html?cat=crafts'">Explore Crafts</button>
      </div>
    </div>
    <div class="slide">
      <div class="slide-details">
        <h1>Celebrate Christmas with Local Gifts!</h1>
        <p>Find the perfect holiday gifts handcrafted by local artisans.</p>
        <button class="button" onclick="location.href='shop-all.html?cat=christmas'">Shop Christmas</button>
      </div>
    </div>
  </div>
</section>

<!-- FEATURED -->
<section class="featured">
  <div class="featured-box-1">
    <div class="overlay">
      <button class="button btn" onclick="location.href='shop-all.html?cat=clothing'">Shop Local Clothing</button>
    </div>
    <div class="bg-image">
      <img src="images/filipiniana.png" alt="Clothing">
    </div>
  </div>
  <div class="featured-box-2">
    <div class="featured-box-2-box-1">
      <div class="overlay">
        <button class="button btn" onclick="location.href='shop-all.html?cat=crafts'">Shop Local Crafts</button>
      </div>
      <div class="bg-image">
        <img src="images/16.png" alt="Crafts">
      </div>
    </div>
    <div class="featured-box-2-box-2">
      <div class="overlay">
        <button class="button btn" onclick="location.href='shop-all.html?cat=accessories'">Shop Accessories</button>
      </div>
      <div class="bg-image">
        <img src="images/4p.webp" alt="Accessories">
      </div>
    </div>
    <div class="featured-box-2-box-3">
      <div class="overlay">
        <button class="button btn" onclick="location.href='shop-all.html?cat=bags'">Shop Bags</button>
      </div>
      <div class="bg-image">
        <img src="images/bags.png" alt="Bags">
      </div>
    </div>
  </div>
  <div class="featured-box-3">
    <div class="overlay">
      <button class="button btn" onclick="location.href='shop-all.html?cat=flavors'">Shop Local Flavors</button>
    </div>
    <div class="bg-image">
      <img src="images/delicacies.png" alt="Flavors">
    </div>
  </div>
</section>

<!-- PRODUCTS (sample) -->
<section class="products">
  <h1 class="section-title">Top products of the Season</h1>
  <div class="products-list">
    <!-- sample cards (unchanged) -->
    <div class="product" data-name="Santa Ornament" data-price="₱479.00" data-img="images/main-image.png" data-desc="Festive Santa ornament for your tree.">
      <div class="product-image">
        <div class="main-image"><img src="images/main-image.png" alt="Santa Ornament"></div>
        <div class="effect-image"><img src="images/effect-image.png" alt="Santa Ornament Alt"></div>
        <div class="overlay-image"><button class="button btn">Add To Cart</button></div>
        <button class="wishlist-btn" aria-label="Add to favorites" title="Add to favorites"
          data-id="santa-ornament" data-name="Santa Ornament" data-price="₱479.00"
          data-img="images/main-image.png" data-desc="Festive Santa ornament for your tree."
          data-url="best-pick/product.html" type="button">
          <i class="fa-regular fa-heart"></i>
        </button>
      </div>
      <div class="product-details"><p class="product-name">Santa Ornament</p><p>₱479.00</p></div>
    </div>

    <div class="product" data-name="Christmas Parol" data-price="₱900.00" data-img="images/main-image2.png" data-desc="Classic parol to brighten your holidays.">
      <div class="product-image">
        <div class="main-image"><img src="images/main-image2.png" alt="Christmas Parol"></div>
        <div class="effect-image"><img src="images/effect-image2.png" alt="Christmas Parol Alt"></div>
        <div class="overlay-image"><button class="button btn">Add To Cart</button></div>
        <button class="wishlist-btn" aria-label="Add to favorites" title="Add to favorites"
          data-id="christmas-parol" data-name="Christmas Parol" data-price="₱900.00"
          data-img="images/main-image2.png" data-desc="Classic parol to brighten your holidays."
          data-url="best-pick/product.html" type="button">
          <i class="fa-regular fa-heart"></i>
        </button>
      </div>
      <div class="product-details"><p class="product-name">Christmas Parol</p><p>₱900.00</p></div>
    </div>

    <div class="product" data-name="Santa Stockings" data-price="₱295.00" data-img="images/main-image3.png" data-desc="Cozy stockings for gifts and treats.">
      <div class="product-image">
        <div class="main-image"><img src="images/main-image3.png" alt="Santa Stockings"></div>
        <div class="effect-image"><img src="images/effect-image3.png" alt="Santa Stockings Alt"></div>
        <div class="overlay-image"><button class="button btn">Add To Cart</button></div>
        <button class="wishlist-btn" aria-label="Add to favorites" title="Add to favorites"
          data-id="santa-stockings" data-name="Santa Stockings" data-price="₱295.00"
          data-img="images/main-image3.png" data-desc="Cozy stockings for gifts and treats."
          data-url="best-pick/product.html" type="button">
          <i class="fa-regular fa-heart"></i>
        </button>
      </div>
      <div class="product-details"><p class="product-name">Santa Stockings</p><p>₱295.00</p></div>
    </div>

    <div class="product" data-name="Queso de Bola" data-price="₱300.00" data-img="images/main-image4.png" data-desc="Holiday favorite cheese ball.">
      <div class="product-image">
        <div class="main-image"><img src="images/main-image4.png" alt="Queso de Bola"></div>
        <div class="effect-image"><img src="images/effect-image4.png" alt="Queso de Bola Alt"></div>
        <div class="overlay-image"><button class="button btn">Add To Cart</button></div>
        <button class="wishlist-btn" aria-label="Add to favorites" title="Add to favorites"
          data-id="queso-de-bola" data-name="Queso de Bola" data-price="₱300.00"
          data-img="images/main-image4.png" data-desc="Holiday favorite cheese ball."
          data-url="best-pick/product.html" type="button">
          <i class="fa-regular fa-heart"></i>
        </button>
      </div>
      <div class="product-details"><p class="product-name">Queso de Bola</p><p>₱300.00</p></div>
    </div>
  </div>
</section>

<!-- INSTAGRAM -->
<section class="insta">
  <h1 class="section-title">Shop Now</h1>
  <div class="posts">
    <div class="post-image" data-aos="zoom-in" data-aos-delay="200"><img src="images/insta1.png" alt="insta"></div>
    <div class="post-image" data-aos="zoom-in" data-aos-delay="200"><img src="images/insta2.png" alt="insta"></div>
    <div class="post-image" data-aos="zoom-in" data-aos-delay="200"><img src="images/insta3.png" alt="insta"></div>
    <div class="post-image" data-aos="zoom-in" data-aos-delay="200"><img src="images/insta4.png" alt="insta"></div>
    <div class="post-image" data-aos="zoom-in" data-aos-delay="200"><img src="images/insta5.png" alt="insta"></div>
    <div class="post-image" data-aos="zoom-in" data-aos-delay="200"><img src="images/insta6.png" alt="insta"></div>
  </div>
</section>

<!-- FOOTER -->
<footer class="footer">
  <div class="footer-section">
    <h1>Contact Us</h1>
    <ul class="footer-list">
      <li>lokal@info.com</li>
      <li>lokal@admin.com</li>
      <li>Manila Philippines</li>
      <li class="border-list"></li>
      <li class="socials">
        <i class="fa-brands fa-square-instagram"></i>
        <i class="fa-brands fa-square-facebook"></i>
        <i class="fa-brands fa-tiktok"></i>
      </li>
    </ul>
  </div>
  <div class="footer-section">
    <h1>Quick Links</h1>
    <ul class="footer-list">
      <li><a href="index.html">Home</a></li>
      <li><a href="shop-all.html">Shop All</a></li>
      <li><a href="about.html">About Us</a></li>
      <li><a href="terms.html">Terms & Conditions</a></li>
    </ul>
  </div>
  <div class="footer-section">
    <h1>Subscribe to Newsletter</h1>
    <ul class="footer-list">
      <li>A local marketplace is a community hub where people buy, sell, or trade goods and services within their area.</li>
      <li class="sub">
        <input type="text" placeholder="Your email">
        <button class="button">Subscribe</button>
      </li>
    </ul>
  </div>
</footer>

<!-- CART DRAWER -->
<div class="cd-overlay" id="cdOverlay" aria-hidden="true"></div>
<aside class="cd-drawer" id="cdDrawer" aria-labelledby="cdTitle" aria-hidden="true" role="dialog">
  <header class="cd-header">
    <h2 id="cdTitle">Cart</h2>
    <button class="cd-close" id="cdClose" aria-label="Close cart">&times;</button>
  </header>
  <div class="cd-body">
    <div class="cd-items" id="cdItems"></div>
    <div class="cd-summary">
      <div class="cd-row">
        <span>Subtotal</span>
        <strong id="cdSubtotal">₱0.00</strong>
      </div>
      <p class="cd-note">Shipping, taxes, and discount codes calculated at checkout.</p>
      <label class="cd-terms">
        <input type="checkbox" id="cdAgree">
        I agree with the <a href="terms.html" target="_blank" rel="noopener">terms and conditions</a>
      </label>
      <button class="cd-checkout" id="cdCheckout" disabled>Check Out</button>
    </div>
  </div>
</aside>

<!-- SCRIPTS -->
<script src="https://unpkg.com/aos@next/dist/aos.js"></script>
<script>AOS.init();</script>

<!-- Supabase -->
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
<script src="supabase.js"></script>

<!-- Account link controller + Greeting + Sign-out toast -->
<script>
(function(){
  const $ = (s)=>document.querySelector(s);
  const overlay = $('#lokalAuthOverlay');
  const emailForm = $('#laEmailForm'), passForm = $('#laPassForm');
  const emailInput = $('#laEmail'),  passInput = $('#laPass');
  const accountLink = $('#accountLink');
  const hiTag = $('#hiTag');

  // ---------- helpers ----------
  const cap = s => { s = String(s||'').trim(); return s ? s[0].toUpperCase()+s.slice(1) : ''; };
  function firstFromUser(user){
    const md = (user && user.user_metadata) || {};
    return md.first_name || md.given_name || (md.full_name||md.name||'').split(/\s+/)[0] || '';
  }
  function showGreeting(name){
    if (!name){ hiTag.hidden = true; return; }
    hiTag.textContent = 'Hi, ' + cap(name);
    hiTag.hidden = false;
  }
  function hideGreeting(){ hiTag.hidden = true; }

  // ---------- open/close popup ----------
  const openAuth = ()=>{ overlay?.setAttribute('aria-hidden','false'); emailForm.hidden=false; passForm.hidden=true; setTimeout(()=>emailInput?.focus(),50); };
  const closeAuth = ()=> overlay?.setAttribute('aria-hidden','true');
  $('#laClose')?.addEventListener('click', closeAuth);
  overlay?.addEventListener('click', e=>{ if(e.target===overlay) closeAuth(); });
  document.addEventListener('keydown', e=>{ if(e.key==='Escape') closeAuth(); });

  // flow: email -> password
  emailForm?.addEventListener('submit', (e)=>{
    e.preventDefault();
    const email=(emailInput.value||'').trim().toLowerCase();
    if(!email){ emailInput.focus(); return; }
    passForm.dataset.email = email;
    emailForm.hidden = true;
    passForm.hidden = false;
    passInput.focus();
  });
  $('#laBackEmail')?.addEventListener('click', (e)=>{ e.preventDefault(); emailForm.hidden=false; passForm.hidden=true; emailInput.focus(); });

  // sign in
  passForm?.addEventListener('submit', async (e)=>{
    e.preventDefault();
    const email = passForm.dataset.email || '';
    const password = passInput.value || '';
    if (!email || !password) { alert('Please enter email and password.'); return; }
    try{
      if (!window.sb || !sb.auth) throw new Error('Supabase client missing. Check supabase.js');
      const { data, error } = await sb.auth.signInWithPassword({ email, password });
      if (error) {
        const msg = (error.message || '').toLowerCase();
        if (msg.includes('confirm')) { alert('Please confirm your email first.'); return; }
        if (msg.includes('invalid') || msg.includes('password')) { alert('Incorrect email or password.'); return; }
        const create = confirm('No account found. Create one?');
        if (!create) return;
        const { error: signUpError } = await sb.auth.signUp({
          email, password,
          options:{ emailRedirectTo: new URL('user.html', location.href).href }
        });
        if (signUpError) { alert(signUpError.message || 'Sign up failed.'); return; }
        alert('Check your email to verify, then sign in.');
        closeAuth();
        return;
      }
      // success
      sessionStorage.setItem('hadSession','1');
      const user = data?.user;
      const first = firstFromUser(user);
      if (first) localStorage.setItem('lokalFirstName', first);
      closeAuth();
      showGreeting(first || localStorage.getItem('lokalFirstName') || '');
    } catch (err){
      alert((err && err.message) || 'Network error. Check your Supabase setup.');
    }
  });

  // user icon: popup if signed out, go profile if signed in
  accountLink?.addEventListener('click', async (e)=>{
    e.preventDefault();
    try{
      const { data:{ session } } = await sb.auth.getSession();
      if (session) location.href = 'user.html';
      else openAuth();
    }catch{
      openAuth();
    }
  });

  // show/hide greeting on load based on session
  document.addEventListener('DOMContentLoaded', async ()=>{
    try{
      const { data:{ session } } = await sb.auth.getSession();
      if (session){
        const first = firstFromUser(session.user) || localStorage.getItem('lokalFirstName') || '';
        showGreeting(first);
      } else {
        hideGreeting();
      }
    }catch{ hideGreeting(); }
  });

  // react to auth changes (keep greeting + toast flags correct)
  if (window.sb?.auth?.onAuthStateChange){
    sb.auth.onAuthStateChange((evt, session)=>{
      if (evt === 'SIGNED_IN' || (session && session.user)){
        sessionStorage.setItem('hadSession','1');
        const first = firstFromUser(session?.user) || localStorage.getItem('lokalFirstName') || '';
        if (first) localStorage.setItem('lokalFirstName', first);
        showGreeting(first);
      }
      if (evt === 'SIGNED_OUT'){
        if (sessionStorage.getItem('hadSession') === '1'){
          sessionStorage.setItem('justSignedOut','1');
        }
        hideGreeting();
      }
    });
  }
})();
</script>

<!-- Logout toast (shows only right after a real sign-out) -->
<script>
(function(){
  function showToast(msg){
    if (document.getElementById('signedOutToast')) return;
    const box = document.createElement('div');
    box.id = 'signedOutToast';
    box.className = 'toast-signout';
    box.setAttribute('role','status');
    box.setAttribute('aria-live','polite');
    box.innerHTML = `<span>${msg}</span><button aria-label="Dismiss">×</button>`;
    document.body.appendChild(box);
    const close = () => box.remove();
    box.querySelector('button')?.addEventListener('click', close);
    setTimeout(close, 5000);
  }
  document.addEventListener('DOMContentLoaded', ()=>{
    if (sessionStorage.getItem('justSignedOut') === '1'){
      showToast("You’re signed out.");
      sessionStorage.removeItem('justSignedOut');
      sessionStorage.removeItem('hadSession');
    }
  });
})();
</script>

<!-- Storefront glue and cart -->
<script src="lokal.js"></script>
<script src="cart.js" defer></script>
</body>
</html>
