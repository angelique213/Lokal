_MetricalDeployment={version:"",lastUpdated:"2023-07-19 20:49:06 UTC"},_MetricalHosts={legacy:{apiendpointhost:"api.getmetrical.com",staticendpointhost:"content.getmetrical.com",probabilityenginehost:"probability.getmetrical.com",probabilityenginetesthost:!1,surveyanswerendpoint:"https://hfcqk5kiya.execute-api.us-east-1.amazonaws.com/prod/postanswer",cxinteractionendpoint:"https://hfcqk5kiya.execute-api.us-east-1.amazonaws.com/prod/postcxinteraction"},endpoints:{previousVisitor:"https://g4ipuvvgf7.execute-api.us-east-1.amazonaws.com/prod/visit/{surveyId}/{uuid}/{sessionId}/previousVisitor",previousCustomer:"https://g4ipuvvgf7.execute-api.us-east-1.amazonaws.com/prod/visit/{surveyId}/{uuid}/{sessionId}/previousCustomer",coupon:"https://g4ipuvvgf7.execute-api.us-east-1.amazonaws.com/prod/coupon",provision:"https://g4ipuvvgf7.execute-api.us-east-1.amazonaws.com/prod/site/provision",interaction:"https://api-v2.getmetrical.com/interaction",offerFlow:"https://api-v2.getmetrical.com/offerflow",singleUseCoupon:"https://api-v2.getmetrical.com/singleusecoupon",timeframeCoupon:"https://api-v2.getmetrical.com/coupon/timeframe",pe:"https://api-v2.getmetrical.com/pe",storageSync:"https://api-v2.getmetrical.com/storagesync",callBridge:"https://phoneservices.getmetrical.com/bridgeCall",message:"https://phoneservices.getmetrical.com/message"}},String.prototype.includes||(String.prototype.includes=function(){"use strict";return-1!==String.prototype.indexOf.apply(this,arguments)}),Array.prototype.includes||Object.defineProperty(Array.prototype,"includes",{value:function(e,t){if(null==this)throw new TypeError('"this" is null or not defined');var i=Object(this),r=i.length>>>0;if(0===r)return!1;var n,o,a=0|t,s=Math.max(a>=0?a:r-Math.abs(a),0);for(;s<r;){if((n=i[s])===(o=e)||"number"==typeof n&&"number"==typeof o&&isNaN(n)&&isNaN(o))return!0;s++}return!1}}),"function"!=typeof Object.assign&&Object.defineProperty(Object,"assign",{value:function(e,t){"use strict";if(null==e)throw new TypeError("Cannot convert undefined or null to object");for(var i=Object(e),r=1;r<arguments.length;r++){var n=arguments[r];if(null!=n)for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(i[o]=n[o])}return i},writable:!0,configurable:!0}),function(){const e=function(e){return"string"==typeof e},t=function(e){return e instanceof Blob};(function(){if(function(){return"navigator"in this&&"sendBeacon"in this.navigator}.call(this))return;"navigator"in this||(this.navigator={});this.navigator.sendBeacon=function(i,r){var n=this.event&&this.event.type,o="unload"===n||"beforeunload"===n;const a="XMLHttpRequest"in this?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP");a.open("POST",i,!o),a.withCredentials=!0,a.setRequestHeader("Accept","*/*"),e(r)?(a.setRequestHeader("Content-Type","text/plain;charset=UTF-8"),a.responseType="text/plain"):t(r)&&r.type&&a.setRequestHeader("Content-Type",r.type);try{a.send(r)}catch(e){return!1}return!0}.bind(this)}).call("object"==typeof window?window:this)}(),Object.setPrototypeOf||(Object.prototype.setPrototypeOf=function(e,t){if(e.__proto__)return e.__proto__=t,e;var i=function(){for(var t in e)Object.defineProperty(this,t,{value:e[t]})};return i.prototype=t,new i}),function(){var e;e=function(){"use strict";function e(e){var t=this.constructor;return this.then(function(i){return t.resolve(e()).then(function(){return i})},function(i){return t.resolve(e()).then(function(){return t.reject(i)})})}function t(e){return!(!e||void 0===e.length)}function i(){}function r(e){if(!(this instanceof r))throw new TypeError("Promises must be constructed via new");if("function"!=typeof e)throw new TypeError("not a function");this._state=0,this._handled=!1,this._value=void 0,this._deferreds=[],l(e,this)}function n(e,t){for(;3===e._state;)e=e._value;0!==e._state?(e._handled=!0,r._immediateFn(function(){var i=1===e._state?t.onFulfilled:t.onRejected;if(null!==i){var r;try{r=i(e._value)}catch(e){return void a(t.promise,e)}o(t.promise,r)}else(1===e._state?o:a)(t.promise,e._value)})):e._deferreds.push(t)}function o(e,t){try{if(t===e)throw new TypeError("A promise cannot be resolved with itself.");if(t&&("object"==typeof t||"function"==typeof t)){var i=t.then;if(t instanceof r)return e._state=3,e._value=t,void s(e);if("function"==typeof i)return void l(function(e,t){return function(){e.apply(t,arguments)}}(i,t),e)}e._state=1,e._value=t,s(e)}catch(t){a(e,t)}}function a(e,t){e._state=2,e._value=t,s(e)}function s(e){2===e._state&&0===e._deferreds.length&&r._immediateFn(function(){e._handled||r._unhandledRejectionFn(e._value)});for(var t=0,i=e._deferreds.length;i>t;t++)n(e,e._deferreds[t]);e._deferreds=null}function l(e,t){var i=!1;try{e(function(e){i||(i=!0,o(t,e))},function(e){i||(i=!0,a(t,e))})}catch(e){if(i)return;i=!0,a(t,e)}}var c=setTimeout;r.prototype.catch=function(e){return this.then(null,e)},r.prototype.then=function(e,t){var r=new this.constructor(i);return n(this,new function(e,t,i){this.onFulfilled="function"==typeof e?e:null,this.onRejected="function"==typeof t?t:null,this.promise=i}(e,t,r)),r},r.prototype.finally=e,r.all=function(e){return new r(function(i,r){function n(e,t){try{if(t&&("object"==typeof t||"function"==typeof t)){var s=t.then;if("function"==typeof s)return void s.call(t,function(t){n(e,t)},r)}o[e]=t,0==--a&&i(o)}catch(e){r(e)}}if(!t(e))return r(new TypeError("Promise.all accepts an array"));var o=Array.prototype.slice.call(e);if(0===o.length)return i([]);for(var a=o.length,s=0;o.length>s;s++)n(s,o[s])})},r.resolve=function(e){return e&&"object"==typeof e&&e.constructor===r?e:new r(function(t){t(e)})},r.reject=function(e){return new r(function(t,i){i(e)})},r.race=function(e){return new r(function(i,n){if(!t(e))return n(new TypeError("Promise.race accepts an array"));for(var o=0,a=e.length;a>o;o++)r.resolve(e[o]).then(i,n)})},r._immediateFn="function"==typeof setImmediate&&function(e){setImmediate(e)}||function(e){c(e,0)},r._unhandledRejectionFn=function(e){void 0!==console&&console&&console.warn("Possible Unhandled Promise Rejection:",e)};var u=function(){if("undefined"!=typeof self)return self;if("undefined"!=typeof window)return window;if("undefined"!=typeof global)return global;throw Error("unable to locate global object")}();"Promise"in u?u.Promise.prototype.finally||(u.Promise.prototype.finally=e):u.Promise=r},"object"==typeof exports&&"undefined"!=typeof module?e():"function"==typeof define&&define.amd?define(e):e()}(),"".trim||(String.prototype.trim=function(){return this.replace(/^[\s]+|[\s]+$/g,"")}),function(e){"use strict";e.DOMException||((DOMException=function(e){this.message=e}).prototype=new Error);var t,i,r=/[\11\12\14\15\40]/,n=0,o=function(e,t){if(""===t)throw new DOMException("Failed to execute '"+e+"' on 'DOMTokenList': The token provided must not be empty.");if(-1!==(n=t.search(r)))throw new DOMException("Failed to execute '"+e+"' on 'DOMTokenList': The token provided ('"+t[n]+"') contains HTML space characters, which are not valid in tokens.")};"function"!=typeof DOMTokenList&&function(e){var t=e.document,i=e.Object,n=i.prototype.hasOwnProperty,a=i.defineProperty,s=0,l=0;function c(){if(!s)throw TypeError("Illegal constructor")}function u(){var t=e.event,i=t.propertyName;if(!l&&("className"===i||"classList"===i&&!a)){var n=t.srcElement,o=n[" uCLp"],s=""+n[i],c=s.trim().split(r),u=n["classList"===i?" uCL":"classList"],d=o.length;e:for(var p=0,h=o.length=c.length,g=0;p!==h;++p){for(var f=0;f!==p;++f)if(c[f]===c[p]){g++;continue e}u[p-g]=c[p]}for(var m=h-g;m<d;++m)delete u[m];if("classList"!==i)return;l=1,n.classList=u,n.className=s,l=0,u.length=c.length-g}}function d(e){if(!(e&&"innerHTML"in e))throw TypeError("Illegal invocation");e.detachEvent("onpropertychange",u),s=1;try{function t(){}t.prototype=new c}finally{s=0}var i=t.prototype,n=new t;e:for(var o=e.className.trim().split(r),d=0,p=o.length,h=0;d!==p;++d){for(var g=0;g!==d;++g)if(o[g]===o[d]){h++;continue e}this[d-h]=o[d]}i.length=p-h,i.value=e.className,i[" uCL"]=e,a?(a(e,"classList",{enumerable:1,get:function(){return n},configurable:0,set:function(t){l=1,e.className=i.value=t+="",l=0;var o=t.trim().split(r),a=i.length;e:for(var s=0,c=i.length=o.length,u=0;s!==c;++s){for(var d=0;d!==s;++d)if(o[d]===o[s]){u++;continue e}n[s-u]=o[s]}for(var p=c-u;p<a;++p)delete n[p]}}),a(e," uCLp",{enumerable:0,configurable:0,writeable:0,value:t.prototype}),a(i," uCL",{enumerable:0,configurable:0,writeable:0,value:e})):(e.classList=n,e[" uCL"]=n,e[" uCLp"]=t.prototype),e.attachEvent("onpropertychange",u)}c.prototype.toString=c.prototype.toLocaleString=function(){return this.value},c.prototype.add=function(){e:for(var e=0,t=arguments.length,i="",r=this[" uCL"],n=r[" uCLp"];e!==t;++e){i=arguments[e]+"",o("add",i);for(var a=0,s=n.length,c=i;a!==s;++a){if(this[a]===i)continue e;c+=" "+this[a]}this[s]=i,n.length+=1,n.value=c}l=1,r.className=n.value,l=0},c.prototype.remove=function(){for(var e=0,t=arguments.length,i="",r=this[" uCL"],n=r[" uCLp"];e!==t;++e){i=arguments[e]+"",o("remove",i);for(var a=0,s=n.length,c="",u=0;a!==s;++a)u?this[a-1]=this[a]:this[a]!==i?c+=this[a]+" ":u=1;u&&(delete this[s],n.length-=1,n.value=c)}l=1,r.className=n.value,l=0},e.DOMTokenList=c;try{e.Object.defineProperty(e.Element.prototype,"classList",{enumerable:1,get:function(e){return n.call(this,"classList")||d(this),this.classList},configurable:0,set:function(e){this.className=e}})}catch(i){e[" uCL"]=d,t.documentElement.firstChild.appendChild(t.createElement("style")).styleSheet.cssText='_*{x-uCLp:expression(!this.hasOwnProperty("classList")&&window[" uCL"](this))}[class]{x-uCLp/**/:expression(!this.hasOwnProperty("classList")&&window[" uCL"](this))}'}}(e),t=e.DOMTokenList.prototype,i=e.document.createElement("div").classList,t.item||(t.item=function(e){return void 0===(t=this[e])?null:t;var t}),t.toggle&&!1===i.toggle("a",0)||(t.toggle=function(e){if(arguments.length>1)return this[arguments[1]?"add":"remove"](e),!!arguments[1];var t=this.value;return this.remove(t),t===this.value&&(this.add(e),!0)}),t.replace&&"boolean"==typeof i.replace("a","b")||(t.replace=function(e,t){o("replace",e),o("replace",t);var i=this.value;return this.remove(e),this.value!==i&&(this.add(t),!0)}),t.contains||(t.contains=function(e){for(var t=0,i=this.length;t!==i;++t)if(this[t]===e)return!0;return!1}),t.forEach||(t.forEach=function(e){if(1===arguments.length)for(var t=0,i=this.length;t!==i;++t)e(this[t],t,this);else{t=0,i=this.length;for(var r=arguments[1];t!==i;++t)e.call(r,this[t],t,this)}}),t.entries||(t.entries=function(){var e=0,t=this;return{next:function(){return e<t.length?{value:[e,t[e++]],done:!1}:{done:!0}}}}),t.values||(t.values=function(){var e=0,t=this;return{next:function(){return e<t.length?{value:t[e++],done:!1}:{done:!0}}}}),t.keys||(t.keys=function(){var e=0,t=this;return{next:function(){return e<t.length?{value:e++,done:!1}:{done:!0}}}})}(window),function(){"use strict";if("object"==typeof window)if("IntersectionObserver"in window&&"IntersectionObserverEntry"in window&&"intersectionRatio"in window.IntersectionObserverEntry.prototype)"isIntersecting"in window.IntersectionObserverEntry.prototype||Object.defineProperty(window.IntersectionObserverEntry.prototype,"isIntersecting",{get:function(){return this.intersectionRatio>0}});else{var e=function(e){for(var t=window.document,i=n(t);i;)i=n(t=i.ownerDocument);return t}(),t=[],i=null,r=null;a.prototype.THROTTLE_TIMEOUT=100,a.prototype.POLL_INTERVAL=null,a.prototype.USE_MUTATION_OBSERVER=!0,a._setupCrossOriginUpdater=function(){return i||(i=function(e,i){r=e&&i?d(e,i):{top:0,bottom:0,left:0,right:0,width:0,height:0},t.forEach(function(e){e._checkForIntersections()})}),i},a._resetCrossOriginUpdater=function(){i=null,r=null},a.prototype.observe=function(e){if(!this._observationTargets.some(function(t){return t.element==e})){if(!e||1!=e.nodeType)throw new Error("target must be an Element");this._registerInstance(),this._observationTargets.push({element:e,entry:null}),this._monitorIntersections(e.ownerDocument),this._checkForIntersections()}},a.prototype.unobserve=function(e){this._observationTargets=this._observationTargets.filter(function(t){return t.element!=e}),this._unmonitorIntersections(e.ownerDocument),0==this._observationTargets.length&&this._unregisterInstance()},a.prototype.disconnect=function(){this._observationTargets=[],this._unmonitorAllIntersections(),this._unregisterInstance()},a.prototype.takeRecords=function(){var e=this._queuedEntries.slice();return this._queuedEntries=[],e},a.prototype._initThresholds=function(e){var t=e||[0];return Array.isArray(t)||(t=[t]),t.sort().filter(function(e,t,i){if("number"!=typeof e||isNaN(e)||e<0||e>1)throw new Error("threshold must be a number between 0 and 1 inclusively");return e!==i[t-1]})},a.prototype._parseRootMargin=function(e){var t=(e||"0px").split(/\s+/).map(function(e){var t=/^(-?\d*\.?\d+)(px|%)$/.exec(e);if(!t)throw new Error("rootMargin must be specified in pixels or percent");return{value:parseFloat(t[1]),unit:t[2]}});return t[1]=t[1]||t[0],t[2]=t[2]||t[0],t[3]=t[3]||t[1],t},a.prototype._monitorIntersections=function(t){var i=t.defaultView;if(i&&-1==this._monitoringDocuments.indexOf(t)){var r=this._checkForIntersections,o=null,a=null;this.POLL_INTERVAL?o=i.setInterval(r,this.POLL_INTERVAL):(s(i,"resize",r,!0),s(t,"scroll",r,!0),this.USE_MUTATION_OBSERVER&&"MutationObserver"in i&&(a=new i.MutationObserver(r)).observe(t,{attributes:!0,childList:!0,characterData:!0,subtree:!0})),this._monitoringDocuments.push(t),this._monitoringUnsubscribes.push(function(){var e=t.defaultView;e&&(o&&e.clearInterval(o),l(e,"resize",r,!0)),l(t,"scroll",r,!0),a&&a.disconnect()});var c=this.root&&(this.root.ownerDocument||this.root)||e;if(t!=c){var u=n(t);u&&this._monitorIntersections(u.ownerDocument)}}},a.prototype._unmonitorIntersections=function(t){var i=this._monitoringDocuments.indexOf(t);if(-1!=i){var r=this.root&&(this.root.ownerDocument||this.root)||e;if(!this._observationTargets.some(function(e){var i=e.element.ownerDocument;if(i==t)return!0;for(;i&&i!=r;){var o=n(i);if((i=o&&o.ownerDocument)==t)return!0}return!1})){var o=this._monitoringUnsubscribes[i];if(this._monitoringDocuments.splice(i,1),this._monitoringUnsubscribes.splice(i,1),o(),t!=r){var a=n(t);a&&this._unmonitorIntersections(a.ownerDocument)}}}},a.prototype._unmonitorAllIntersections=function(){var e=this._monitoringUnsubscribes.slice(0);this._monitoringDocuments.length=0,this._monitoringUnsubscribes.length=0;for(var t=0;t<e.length;t++)e[t]()},a.prototype._checkForIntersections=function(){if(this.root||!i||r){var e=this._rootIsInDom(),t=e?this._getRootRect():{top:0,bottom:0,left:0,right:0,width:0,height:0};this._observationTargets.forEach(function(r){var n=r.element,a=c(n),s=this._rootContainsTarget(n),l=r.entry,u=e&&s&&this._computeTargetAndRootIntersection(n,a,t),d=null;this._rootContainsTarget(n)?i&&!this.root||(d=t):d={top:0,bottom:0,left:0,right:0,width:0,height:0};var p=r.entry=new o({time:window.performance&&performance.now&&performance.now(),target:n,boundingClientRect:a,rootBounds:d,intersectionRect:u});l?e&&s?this._hasCrossedThreshold(l,p)&&this._queuedEntries.push(p):l&&l.isIntersecting&&this._queuedEntries.push(p):this._queuedEntries.push(p)},this),this._queuedEntries.length&&this._callback(this.takeRecords(),this)}},a.prototype._computeTargetAndRootIntersection=function(t,n,o){if("none"!=window.getComputedStyle(t).display){for(var a,s,l,u,p,g,f,m,v=n,b=h(t),y=!1;!y&&b;){var M=null,w=1==b.nodeType?window.getComputedStyle(b):{};if("none"==w.display)return null;if(b==this.root||9==b.nodeType)if(y=!0,b==this.root||b==e)i&&!this.root?!r||0==r.width&&0==r.height?(b=null,M=null,v=null):M=r:M=o;else{var k=h(b),I=k&&c(k),_=k&&this._computeTargetAndRootIntersection(k,I,o);I&&_?(b=k,M=d(I,_)):(b=null,v=null)}else{var S=b.ownerDocument;b!=S.body&&b!=S.documentElement&&"visible"!=w.overflow&&(M=c(b))}if(M&&(a=M,s=v,l=void 0,u=void 0,p=void 0,g=void 0,f=void 0,m=void 0,l=Math.max(a.top,s.top),u=Math.min(a.bottom,s.bottom),p=Math.max(a.left,s.left),g=Math.min(a.right,s.right),m=u-l,v=(f=g-p)>=0&&m>=0&&{top:l,bottom:u,left:p,right:g,width:f,height:m}||null),!v)break;b=b&&h(b)}return v}},a.prototype._getRootRect=function(){var t;if(this.root&&!g(this.root))t=c(this.root);else{var i=g(this.root)?this.root:e,r=i.documentElement,n=i.body;t={top:0,left:0,right:r.clientWidth||n.clientWidth,width:r.clientWidth||n.clientWidth,bottom:r.clientHeight||n.clientHeight,height:r.clientHeight||n.clientHeight}}return this._expandRectByRootMargin(t)},a.prototype._expandRectByRootMargin=function(e){var t=this._rootMarginValues.map(function(t,i){return"px"==t.unit?t.value:t.value*(i%2?e.width:e.height)/100}),i={top:e.top-t[0],right:e.right+t[1],bottom:e.bottom+t[2],left:e.left-t[3]};return i.width=i.right-i.left,i.height=i.bottom-i.top,i},a.prototype._hasCrossedThreshold=function(e,t){var i=e&&e.isIntersecting?e.intersectionRatio||0:-1,r=t.isIntersecting?t.intersectionRatio||0:-1;if(i!==r)for(var n=0;n<this.thresholds.length;n++){var o=this.thresholds[n];if(o==i||o==r||o<i!=o<r)return!0}},a.prototype._rootIsInDom=function(){return!this.root||p(e,this.root)},a.prototype._rootContainsTarget=function(t){var i=this.root&&(this.root.ownerDocument||this.root)||e;return p(i,t)&&(!this.root||i==t.ownerDocument)},a.prototype._registerInstance=function(){t.indexOf(this)<0&&t.push(this)},a.prototype._unregisterInstance=function(){var e=t.indexOf(this);-1!=e&&t.splice(e,1)},window.IntersectionObserver=a,window.IntersectionObserverEntry=o}function n(e){try{return e.defaultView&&e.defaultView.frameElement||null}catch(e){return null}}function o(e){this.time=e.time,this.target=e.target,this.rootBounds=u(e.rootBounds),this.boundingClientRect=u(e.boundingClientRect),this.intersectionRect=u(e.intersectionRect||{top:0,bottom:0,left:0,right:0,width:0,height:0}),this.isIntersecting=!!e.intersectionRect;var t=this.boundingClientRect,i=t.width*t.height,r=this.intersectionRect,n=r.width*r.height;this.intersectionRatio=i?Number((n/i).toFixed(4)):this.isIntersecting?1:0}function a(e,t){var i,r,n,o=t||{};if("function"!=typeof e)throw new Error("callback must be a function");if(o.root&&1!=o.root.nodeType&&9!=o.root.nodeType)throw new Error("root must be a Document or Element");this._checkForIntersections=(i=this._checkForIntersections.bind(this),r=this.THROTTLE_TIMEOUT,n=null,function(){n||(n=setTimeout(function(){i(),n=null},r))}),this._callback=e,this._observationTargets=[],this._queuedEntries=[],this._rootMarginValues=this._parseRootMargin(o.rootMargin),this.thresholds=this._initThresholds(o.threshold),this.root=o.root||null,this.rootMargin=this._rootMarginValues.map(function(e){return e.value+e.unit}).join(" "),this._monitoringDocuments=[],this._monitoringUnsubscribes=[]}function s(e,t,i,r){"function"==typeof e.addEventListener?e.addEventListener(t,i,r||!1):"function"==typeof e.attachEvent&&e.attachEvent("on"+t,i)}function l(e,t,i,r){"function"==typeof e.removeEventListener?e.removeEventListener(t,i,r||!1):"function"==typeof e.detatchEvent&&e.detatchEvent("on"+t,i)}function c(e){var t;try{t=e.getBoundingClientRect()}catch(e){}return t?(t.width&&t.height||(t={top:t.top,right:t.right,bottom:t.bottom,left:t.left,width:t.right-t.left,height:t.bottom-t.top}),t):{top:0,bottom:0,left:0,right:0,width:0,height:0}}function u(e){return!e||"x"in e?e:{top:e.top,y:e.top,bottom:e.bottom,left:e.left,x:e.left,right:e.right,width:e.width,height:e.height}}function d(e,t){var i=t.top-e.top,r=t.left-e.left;return{top:i,left:r,height:t.height,width:t.width,bottom:i+t.height,right:r+t.width}}function p(e,t){for(var i=t;i;){if(i==e)return!0;i=h(i)}return!1}function h(t){var i=t.parentNode;return 9==t.nodeType&&t!=e?n(t):(i&&i.assignedSlot&&(i=i.assignedSlot.parentNode),i&&11==i.nodeType&&i.host?i.host:i)}function g(e){return e&&9===e.nodeType}}(),_MetricalUtils={evaluate:function(input){try{var result=eval(input);return result}catch(e){var name="EvalParsingError",message=name+" - "+e.message+" - "+input;throw e.name=name,e.message=message,e}},evaluateObject:function(e){var t={};if("object"!=typeof e)throw new Error("_MetricalUtils.evaluateObject() expects the input to be an object");null!==e&&Object.keys(e).forEach(function(i){for(var r=e[i],n=Array.isArray(r)?r:[r],o=null,a=0;a<n.length&&null===(o=_MetricalUtils.evaluate(n[a]));a++);t[i]=o});return t},evaluateRule:function(rule,conditions,tags){var result=!1,originalRule=rule;try{var keys=Object.keys(conditions);keys.sort(function(e,t){return t.length-e.length});var tagKeys=Object.keys(tags||[]);tagKeys.sort(function(e,t){return t.length-e.length});for(var i=0;i<tagKeys.length;i++){var tagKey=tagKeys[i],searchKey="#"+tagKey,tagValue="object"==typeof tags[tagKey]&&null!==tags[tagKey]&&void 0!==tags[tagKey]&&"result"in tags[tagKey]?tags[tagKey].result:tags[tagKey];rule=rule.replace(searchKey,String(tagValue))}for(var i=0;i<keys.length;i++){var conditionKey=keys[i],conditionValue="object"==typeof conditions[conditionKey]&&"result"in conditions[conditionKey]?conditions[conditionKey].result:conditions[conditionKey];rule=rule.replace(conditionKey,String(conditionValue))}result=eval(rule)}catch(e){var name="RuleParsingError",message=e.message+" - "+originalRule+" - "+rule+" - "+JSON.stringify(conditions)+" - "+JSON.stringify(tags);throw e.name=name,e.message=message,e}return result},ruleCriteriaString:function(e,t,i){i=i||{};var r=Object.keys(t);r.sort(function(e,t){return t.length-e.length});var n=Object.keys(i||[]);n.sort(function(e,t){return t.length-e.length});for(var o=0;o<n.length;o++){var a=n[o],s=i[a],l="#"+a,c=l+" ("+String(s)+") ",u=new RegExp(l+"\\s{1}|"+l+"$","g");e=e.replace(u,c).trim()}for(o=0;o<r.length;o++){var d=r[o],p="object"==typeof t[d]&&"result"in t[d]?t[d].result:t[d];c=d+" ("+String(p)+")";e=e.replace(d,c)}return e},chooseRandomItem:function(e){for(var t,i,r=e.reduce(function(e,t){return e+t.weight},0),n=(t=0,i=r,Math.random()*(i-t)+t),o=0,a=0;a<e.length;a++)if(n<=(o=+(o+=e[a].weight).toFixed(4)))return e[a].item},testRegex:function(e,t){return new RegExp(e).test(t)},determineDevice:function(){var e="desktop";/Touch|Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)&&(e=window.matchMedia("(max-width: 730px)").matches?"mobile":window.matchMedia("screen and (orientation: portrait)").matches?screen.width<=480?"mobile":"tabletvertical":screen.height<=480?"mobile":"tablethorizontal");return e},isPlusDelimitedFormat:function(e){return/^\[(.*?\+)+[^\+]+?\]$/.test(e)},plusDelimitedParts:function(e){return 1==this.isPlusDelimitedFormat(e)?e.slice(1).slice(0,-1).split("+"):(newInput=e.replace("[","").replace("]",""),newInput.length>0?[newInput]:[])},plusDelimitArray:function(e){var t=Array.isArray(e)?e:[e];return t.length>0?"["+t.join("+")+"]":null},round:function(e,t){var i=Math.pow(10,t),r=e*i;return Math.round(r)/i},cleanMoney:function(e){var t=0;if("number"==typeof e&&(t=e),"string"==typeof e){var i=e.replace("$","").replace(",","").match(/[\d]+(\.\d+)?/g);null!==i&&(t=parseFloat(i[0]))}return t},getIEVersion:function(){var e=navigator.userAgent.match(/(?:MSIE |Trident\/.*; rv:)(\d+)/);return e?parseInt(e[1]):void 0},makeUUID:function(){var e=Date.now();return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(t){var i=(e+16*Math.random())%16|0;return e=Math.floor(e/16),("x"==t?i:7&i|8).toString(16)})},getFullDateUTC:function(e){var t=""+e.getUTCFullYear(),i=""+(e.getUTCMonth()+1);1==i.length&&(i="0"+i);var r=""+e.getUTCDate();1==r.length&&(r="0"+r);var n=""+e.getUTCHours();1==n.length&&(n="0"+n);var o=""+e.getUTCMinutes();1==o.length&&(o="0"+o);var a=""+e.getUTCSeconds();return 1==a.length&&(a="0"+a),t+"-"+i+"-"+r+" "+n+":"+o+":"+a},identifierIsIOS:function(){return!!/iPhone|iPad|iPod/i.test(navigator.userAgent)},PubSub:function(){var e={subscriptions:{},subscriptionKeys:{},topicPublishCount:{},subscribers:function(e){var t=this;return(e in this.subscriptions?Object.keys(this.subscriptions[e]):[]).map(function(i){return e in t.subscriptions?t.subscriptions[e][i]:function(){}})},subscribe:function(e,t){e in this.subscriptions||(this.subscriptions[e]={},this.subscriptionKeys[e]=0);var i=e+"-"+this.subscriptionKeys[e];return this.subscriptions[e][i]=t,this.subscriptionKeys[e]++,i},unsubscribe:function(e,t){var i=e in this.subscriptions?this.subscriptions[e]:{};t in i&&delete i[t]},publish:function(e,t,i){var r=e in this.subscriptions?this.subscriptions[e]:{};if(this.topicPublishCount[e]=e in this.topicPublishCount?this.topicPublishCount[e]+1:1,void 0===i||this.topicPublishCount[e]<=i)for(var n in r){(0,r[n])(t)}}};return e},jsonPath:function(obj,expr,arg){var P={resultType:arg&&arg.resultType||"VALUE",result:[],normalize:function(e){var t=[];return e.replace(/[\['](\??\(.*?\))[\]']/g,function(e,i){return"[#"+(t.push(i)-1)+"]"}).replace(/'?\.'?|\['?/g,";").replace(/;;;|;;/g,";..;").replace(/;$|'?\]|'$/g,"").replace(/#([0-9]+)/g,function(e,i){return t[i]})},asPath:function(e){for(var t=e.split(";"),i="$",r=1,n=t.length;r<n;r++)i+=/^[0-9*]+$/.test(t[r])?"["+t[r]+"]":"['"+t[r]+"']";return i},store:function(e,t){return e&&(P.result[P.result.length]="PATH"==P.resultType?P.asPath(e):t),!!e},trace:function(e,t,i){if(e){var r=e.split(";"),n=r.shift();if(r=r.join(";"),t&&t.hasOwnProperty(n))P.trace(r,t[n],i+";"+n);else if("*"===n)P.walk(n,r,t,i,function(e,t,i,r,n){P.trace(e+";"+i,r,n)});else if(".."===n)P.trace(r,t,i),P.walk(n,r,t,i,function(e,t,i,r,n){"object"==typeof r[e]&&P.trace("..;"+i,r[e],n+";"+e)});else if(/,/.test(n))for(var o=n.split(/'?,'?/),a=0,s=o.length;a<s;a++)P.trace(o[a]+";"+r,t,i);else/^\(.*?\)$/.test(n)?P.trace(P.eval(n,t,i.substr(i.lastIndexOf(";")+1))+";"+r,t,i):/^\?\(.*?\)$/.test(n)?P.walk(n,r,t,i,function(e,t,i,r,n){P.eval(t.replace(/^\?\((.*?)\)$/,"$1"),r[e],e)&&P.trace(e+";"+i,r,n)}):/^(-?[0-9]*):(-?[0-9]*):?([0-9]*)$/.test(n)&&P.slice(n,r,t,i)}else P.store(i,t)},walk:function(e,t,i,r,n){if(i instanceof Array)for(var o=0,a=i.length;o<a;o++)o in i&&n(o,e,t,i,r);else if("object"==typeof i)for(var s in i)i.hasOwnProperty(s)&&n(s,e,t,i,r)},slice:function(e,t,i,r){if(i instanceof Array){var n=i.length,o=0,a=n,s=1;e.replace(/^(-?[0-9]*):(-?[0-9]*):?(-?[0-9]*)$/g,function(e,t,i,r){o=parseInt(t||o),a=parseInt(i||a),s=parseInt(r||s)}),o=o<0?Math.max(0,o+n):Math.min(n,o),a=a<0?Math.max(0,a+n):Math.min(n,a);for(var l=o;l<a;l+=s)P.trace(l+";"+t,i,r)}},eval:function(x,_v,_vname){try{return $&&_v&&eval(x.replace(/@/g,"_v"))}catch(e){throw new SyntaxError("jsonPath: "+e.message+": "+x.replace(/@/g,"_v").replace(/\^/g,"_a"))}}},$=obj;if(expr&&obj&&("VALUE"==P.resultType||"PATH"==P.resultType))return P.trace(P.normalize(expr).replace(/^\$;/,""),obj,"$"),!!P.result.length&&P.result},get:function(e,t,i){i=void 0!==i?i:null,t=0!==t.indexOf("$.")?"$."+t:t;var r=this.jsonPath(e,t);return Array.isArray(r)&&r.length>0?r[0]:i},isJson:function(e){try{JSON.parse(e);return!0}catch(e){return!1}},getParameterByName:function(e,t){t||(t=window.location.href),e=e.replace(/[\[\]]/g,"\\$&");var i=new RegExp("[?&]"+e+"(=([^&#]*)|&|#|$)").exec(t);return i?i[2]?decodeURIComponent(i[2].replace(/\+/g," ")):"":null},waitForIdToAppear:function(e,t){if(document.getElementById(e))t();else{var i=new MutationObserver(function(r){document.getElementById(e)&&(i.disconnect(),t())});i.observe(document,{attributes:!1,childList:!0,characterData:!1,subtree:!0})}},parseUserMetaArray:function(e){return/^\[(.*?)\]$/.test(e)?e.slice(1).slice(0,-1).split("+"):[e]},querySelector:function(e){return document.querySelector(e)},querySelectorAll:function(e){return document.querySelectorAll(e)},isEqual:function(){var e=200,t="__lodash_hash_undefined__",i=1,r=2,n=9007199254740991,o="[object Arguments]",a="[object Array]",s="[object Boolean]",l="[object Date]",c="[object Error]",u="[object Function]",d="[object GeneratorFunction]",p="[object Map]",h="[object Number]",g="[object Object]",f="[object RegExp]",m="[object Set]",v="[object String]",b="[object Symbol]",y="[object ArrayBuffer]",M="[object DataView]",w=/^\[object .+?Constructor\]$/,k=/^(?:0|[1-9]\d*)$/,I={};I["[object Float32Array]"]=I["[object Float64Array]"]=I["[object Int8Array]"]=I["[object Int16Array]"]=I["[object Int32Array]"]=I["[object Uint8Array]"]=I["[object Uint8ClampedArray]"]=I["[object Uint16Array]"]=I["[object Uint32Array]"]=!0,I[o]=I[a]=I[y]=I[s]=I[M]=I[l]=I[c]=I[u]=I[p]=I[h]=I[g]=I[f]=I[m]=I[v]=I["[object WeakMap]"]=!1;var _="object"==typeof global&&global&&global.Object===Object&&global,S="object"==typeof self&&self&&self.Object===Object&&self,A=_||S||Function("return this")(),x="object"==typeof exports&&exports&&!exports.nodeType&&exports,C=x&&"object"==typeof module&&module&&!module.nodeType&&module,O=C&&C.exports===x&&_.process,j=function(){try{return O&&O.binding("util")}catch(e){}}(),T=j&&j.isTypedArray;function $(e,t){for(var i=-1,r=e?e.length:0;++i<r;)if(t(e[i],i,e))return!0;return!1}function q(e){var t=!1;if(null!=e&&"function"!=typeof e.toString)try{t=!!(e+"")}catch(e){}return t}function D(e){var t=-1,i=Array(e.size);return e.forEach(function(e,r){i[++t]=[r,e]}),i}function E(e){var t=-1,i=Array(e.size);return e.forEach(function(e){i[++t]=e}),i}var L,R,V,P=Array.prototype,W=Function.prototype,B=Object.prototype,U=A["__core-js_shared__"],H=(L=/[^.]+$/.exec(U&&U.keys&&U.keys.IE_PROTO||""))?"Symbol(src)_1."+L:"",N=W.toString,F=B.hasOwnProperty,Q=B.toString,K=RegExp("^"+N.call(F).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),z=A.Symbol,J=A.Uint8Array,Y=B.propertyIsEnumerable,G=P.splice,X=(R=Object.keys,V=Object,function(e){return R(V(e))}),Z=_e(A,"DataView"),ee=_e(A,"Map"),te=_e(A,"Promise"),ie=_e(A,"Set"),re=_e(A,"WeakMap"),ne=_e(Object,"create"),oe=xe(Z),ae=xe(ee),se=xe(te),le=xe(ie),ce=xe(re),ue=z?z.prototype:void 0,de=ue?ue.valueOf:void 0;function pe(e){var t=-1,i=e?e.length:0;for(this.clear();++t<i;){var r=e[t];this.set(r[0],r[1])}}function he(e){var t=-1,i=e?e.length:0;for(this.clear();++t<i;){var r=e[t];this.set(r[0],r[1])}}function ge(e){var t=-1,i=e?e.length:0;for(this.clear();++t<i;){var r=e[t];this.set(r[0],r[1])}}function fe(e){var t=-1,i=e?e.length:0;for(this.__data__=new ge;++t<i;)this.add(e[t])}function me(e){this.__data__=new he(e)}function ve(e,t){var i=Oe(e)||function(e){return function(e){return De(e)&&je(e)}(e)&&F.call(e,"callee")&&(!Y.call(e,"callee")||Q.call(e)==o)}(e)?function(e,t){for(var i=-1,r=Array(e);++i<e;)r[i]=t(i);return r}(e.length,String):[],r=i.length,n=!!r;for(var a in e)!t&&!F.call(e,a)||n&&("length"==a||Ae(a,r))||i.push(a);return i}function be(e,t){for(var i=e.length;i--;)if(Ce(e[i][0],t))return i;return-1}function ye(e,t,n,u,d){return e===t||(null==e||null==t||!qe(e)&&!De(t)?e!=e&&t!=t:function(e,t,n,u,d,w){var k=Oe(e),I=Oe(t),_=a,S=a;k||(_=(_=Se(e))==o?g:_);I||(S=(S=Se(t))==o?g:S);var A=_==g&&!q(e),x=S==g&&!q(t),C=_==S;if(C&&!A)return w||(w=new me),k||Ee(e)?ke(e,t,n,u,d,w):function(e,t,n,o,a,u,d){switch(n){case M:if(e.byteLength!=t.byteLength||e.byteOffset!=t.byteOffset)return!1;e=e.buffer,t=t.buffer;case y:return!(e.byteLength!=t.byteLength||!o(new J(e),new J(t)));case s:case l:case h:return Ce(+e,+t);case c:return e.name==t.name&&e.message==t.message;case f:case v:return e==t+"";case p:var g=D;case m:var w=u&r;if(g||(g=E),e.size!=t.size&&!w)return!1;var k=d.get(e);if(k)return k==t;u|=i,d.set(e,t);var I=ke(g(e),g(t),o,a,u,d);return d.delete(e),I;case b:if(de)return de.call(e)==de.call(t)}return!1}(e,t,_,n,u,d,w);if(!(d&r)){var O=A&&F.call(e,"__wrapped__"),j=x&&F.call(t,"__wrapped__");if(O||j){var T=O?e.value():e,$=j?t.value():t;return w||(w=new me),n(T,$,u,d,w)}}if(!C)return!1;return w||(w=new me),function(e,t,i,n,o,a){var s=o&r,l=Le(e),c=l.length,u=Le(t).length;if(c!=u&&!s)return!1;for(var d=c;d--;){var p=l[d];if(!(s?p in t:F.call(t,p)))return!1}var h=a.get(e);if(h&&a.get(t))return h==t;var g=!0;a.set(e,t),a.set(t,e);for(var f=s;++d<c;){p=l[d];var m=e[p],v=t[p];if(n)var b=s?n(v,m,p,t,e,a):n(m,v,p,e,t,a);if(!(void 0===b?m===v||i(m,v,n,o,a):b)){g=!1;break}f||(f="constructor"==p)}if(g&&!f){var y=e.constructor,M=t.constructor;y!=M&&"constructor"in e&&"constructor"in t&&!("function"==typeof y&&y instanceof y&&"function"==typeof M&&M instanceof M)&&(g=!1)}return a.delete(e),a.delete(t),g}(e,t,n,u,d,w)}(e,t,ye,n,u,d))}function Me(e){return!(!qe(e)||(t=e,H&&H in t))&&(Te(e)||q(e)?K:w).test(xe(e));var t}function we(e){if(i=(t=e)&&t.constructor,r="function"==typeof i&&i.prototype||B,t!==r)return X(e);var t,i,r,n=[];for(var o in Object(e))F.call(e,o)&&"constructor"!=o&&n.push(o);return n}function ke(e,t,n,o,a,s){var l=a&r,c=e.length,u=t.length;if(c!=u&&!(l&&u>c))return!1;var d=s.get(e);if(d&&s.get(t))return d==t;var p=-1,h=!0,g=a&i?new fe:void 0;for(s.set(e,t),s.set(t,e);++p<c;){var f=e[p],m=t[p];if(o)var v=l?o(m,f,p,t,e,s):o(f,m,p,e,t,s);if(void 0!==v){if(v)continue;h=!1;break}if(g){if(!$(t,function(e,t){if(!g.has(t)&&(f===e||n(f,e,o,a,s)))return g.add(t)})){h=!1;break}}else if(f!==m&&!n(f,m,o,a,s)){h=!1;break}}return s.delete(e),s.delete(t),h}function Ie(e,t){var i,r,n=e.__data__;return("string"==(r=typeof(i=t))||"number"==r||"symbol"==r||"boolean"==r?"__proto__"!==i:null===i)?n["string"==typeof t?"string":"hash"]:n.map}function _e(e,t){var i=function(e,t){return null==e?void 0:e[t]}(e,t);return Me(i)?i:void 0}pe.prototype.clear=function(){this.__data__=ne?ne(null):{}},pe.prototype.delete=function(e){return this.has(e)&&delete this.__data__[e]},pe.prototype.get=function(e){var i=this.__data__;if(ne){var r=i[e];return r===t?void 0:r}return F.call(i,e)?i[e]:void 0},pe.prototype.has=function(e){var t=this.__data__;return ne?void 0!==t[e]:F.call(t,e)},pe.prototype.set=function(e,i){return this.__data__[e]=ne&&void 0===i?t:i,this},he.prototype.clear=function(){this.__data__=[]},he.prototype.delete=function(e){var t=this.__data__,i=be(t,e);return!(i<0||(i==t.length-1?t.pop():G.call(t,i,1),0))},he.prototype.get=function(e){var t=this.__data__,i=be(t,e);return i<0?void 0:t[i][1]},he.prototype.has=function(e){return be(this.__data__,e)>-1},he.prototype.set=function(e,t){var i=this.__data__,r=be(i,e);return r<0?i.push([e,t]):i[r][1]=t,this},ge.prototype.clear=function(){this.__data__={hash:new pe,map:new(ee||he),string:new pe}},ge.prototype.delete=function(e){return Ie(this,e).delete(e)},ge.prototype.get=function(e){return Ie(this,e).get(e)},ge.prototype.has=function(e){return Ie(this,e).has(e)},ge.prototype.set=function(e,t){return Ie(this,e).set(e,t),this},fe.prototype.add=fe.prototype.push=function(e){return this.__data__.set(e,t),this},fe.prototype.has=function(e){return this.__data__.has(e)},me.prototype.clear=function(){this.__data__=new he},me.prototype.delete=function(e){return this.__data__.delete(e)},me.prototype.get=function(e){return this.__data__.get(e)},me.prototype.has=function(e){return this.__data__.has(e)},me.prototype.set=function(t,i){var r=this.__data__;if(r instanceof he){var n=r.__data__;if(!ee||n.length<e-1)return n.push([t,i]),this;r=this.__data__=new ge(n)}return r.set(t,i),this};var Se=function(e){return Q.call(e)};function Ae(e,t){return!!(t=null==t?n:t)&&("number"==typeof e||k.test(e))&&e>-1&&e%1==0&&e<t}function xe(e){if(null!=e){try{return N.call(e)}catch(e){}try{return e+""}catch(e){}}return""}function Ce(e,t){return e===t||e!=e&&t!=t}(Z&&Se(new Z(new ArrayBuffer(1)))!=M||ee&&Se(new ee)!=p||te&&"[object Promise]"!=Se(te.resolve())||ie&&Se(new ie)!=m||re&&"[object WeakMap]"!=Se(new re))&&(Se=function(e){var t=Q.call(e),i=t==g?e.constructor:void 0,r=i?xe(i):void 0;if(r)switch(r){case oe:return M;case ae:return p;case se:return"[object Promise]";case le:return m;case ce:return"[object WeakMap]"}return t});var Oe=Array.isArray;function je(e){return null!=e&&$e(e.length)&&!Te(e)}function Te(e){var t=qe(e)?Q.call(e):"";return t==u||t==d}function $e(e){return"number"==typeof e&&e>-1&&e%1==0&&e<=n}function qe(e){var t=typeof e;return!!e&&("object"==t||"function"==t)}function De(e){return!!e&&"object"==typeof e}var Ee=T?function(e){return function(t){return e(t)}}(T):function(e){return De(e)&&$e(e.length)&&!!I[Q.call(e)]};function Le(e){return je(e)?ve(e):we(e)}return function(e,t){return ye(e,t)}}(),throttle:function(e,t){let i,r;return function(){var n=this,o=arguments;r?(clearTimeout(i),i=setTimeout(function(){Date.now()-r>=t&&(e.apply(n,o),r=Date.now())},t-(Date.now()-r))):(e.apply(n,o),r=Date.now())}},debounce:function(e,t){let i;return function(){var r=this,n=arguments;clearTimeout(i),i=setTimeout(function(){e.apply(r,n)},t)}},intersection:function(e,t){var i;return t.length>e.length&&(i=t,t=e,e=i),e.filter(function(e){return t.indexOf(e)>-1}).filter(function(e,t,i){return i.indexOf(e)===t})},categoryList:function(e,t){return t=t||"/",0==!!e?[]:String(e).split(t).map(function(e){return String(e).trim()})},applyFunctionToObject:function(e,t){if("object"!=typeof e||null===e)throw new Error("applyFunctionToObject expects an input object to be provided");if("function"!=typeof t)throw new Error("applyFunctionToObject expects a function to be provided that accepts a value and key parameter");var i=function(e){var r={};for(var n in e){var o=e[n],a="object"==typeof o&&null!==o?i(o):t(o,n);r[n]=a}return r};return i(e)},template:function(e,t){if(t="object"==typeof t?t:{},"string"!=typeof e)return e;for(var i in t){var r="{{"+i+"}}";e=e.replace(r,t[i])}return e},promiseSequence:function(e){return new Promise(function(t,i){var r=Promise.resolve(),n=[];e.filter(function(e){return"function"==typeof e}).length!=e.length&&i(new Error("promiseSequence was provided an input value that is not a function")),e.forEach(function(e){r=r.then(function(){return e()}).then(function(e){return n.push(e),e}).catch(function(e){i(e)})}),r.then(function(){t(n)}).catch(function(e){i(e)})})},sessionIdentifiers:function(){return{surveyId:_MetricalAbandonCart.Config.surveyid,uuid:_MetricalIdentity.getDeviceId(),sessionId:_MetricalIdentity.getSessionId()}},watchForElement:function(e,t){try{var i=document.getElementsByTagName("body"),r=(n=function(){_MetricalAbandonCart.logger.debug("selector check function");var i=document.querySelector(e);null!==i&&(_MetricalAbandonCart.logger.debug("el has a value"),_MetricalAbandonCart.logger.debug(typeof t),t(i))},o=250,function(){var e=this,t=arguments,i=a&&!s;clearTimeout(s),s=setTimeout(function(){s=null,a||n.apply(e,t)},o),i&&n.apply(e,t)});new MutationObserver(function(e,t){_MetricalAbandonCart.logger.debug(e.length);for(var i=0;i<e.length;i++)"childList"===e[i].type&&(_MetricalAbandonCart.logger.debug("calling debounce method"),r())}).observe(i[0],{attributes:!1,childList:!0,subtree:!0})}catch(e){console.error(e)}var n,o,a,s},run:function(inputCommands){const commands=Array.isArray(inputCommands)?inputCommands:[inputCommands];var context=void 0;return commands.forEach(function(cur){var result=eval(cur);context=result}),context}},_MetricalDateUtils={getLocalUtcTimestamp:function(){return(new Date).getTime()},isValidTimestamp:function(e){return!isNaN(parseFloat(e))&&isFinite(e)},getTimestamp:function(e){if(null!=e)return this.isValidTimestamp(e)?e:Date.parse(e)},isTimestampBetweenDates:function(e,t,i){return(void 0===t||!isNaN(t))&&((void 0===i||!isNaN(i))&&(t&&i?t<=e&&e<=i:t&&!i?t<=e:!(t||!i)&&e<=i))},dbFormat:function(e){var t=e||(new Date).getTime();return new Date(t).toISOString()}},_MetricalStorage={root:this,import:function(e){var t=this;"object"==typeof e&&null!==e&&("storage"in e&&"object"==typeof e.storage&&Object.keys(e.storage).forEach(function(i){t.Storage.setItem(i,e.storage[i])}),"sessionStorage"in e&&"object"==typeof e.sessionStorage&&Object.keys(e.sessionStorage).forEach(function(i){t.SessionStorage.setItem(i,e.sessionStorage[i])}),"cookie"in e&&"object"==typeof e.cookie&&Object.keys(e.cookie).forEach(function(i){t.Cookie.setItem(i,e.cookie[i],1/0,"/",t.Cookie.rootDomain())}),"sessionCookie"in e&&"object"==typeof e.sessionCookie&&Object.keys(e.sessionCookie).forEach(function(i){t.Cookie.sessionQuickSet(i,e.sessionCookie[i])}))},export:function(){var e=this,t={};t.storage=e.Storage.metricalObject(),t.sessionStorage=e.SessionStorage.metricalObject();var i=e.Cookie.metricalObject(),r=Object.keys(i).reduce(function(t,r){return 1==e.Cookie.isLongLivedKey(r)&&(t[r]=i[r]),t},{});t.cookie=r;var n=Object.keys(i).reduce(function(t,r){return 0==e.Cookie.isLongLivedKey(r)&&(t[r]=i[r]),t},{});return t.sessionCookie=n,t},Storage:{storagePrefix:"_Metrical_",prefixKey:function(e){return e=0===e.indexOf(this.storagePrefix)?e:this.storagePrefix+e},getItem:function(e){e=this.prefixKey(e);var t=localStorage.getItem(e);return _MetricalUtils.isJson(t)&&(t=JSON.parse(t)),t},setItem:function(e,t){var i=this.prefixKey(e);value="object"==typeof t?JSON.stringify(t):t;var r=this.getItem(e);localStorage.setItem(i,value),0==_MetricalUtils.isEqual(r,t)&&_MetricalStorage.publish("data-change",{action:"storage-set",key:i,value:t})},removeItem:function(e){var t=this.prefixKey(e);return localStorage.removeItem(t),_MetricalStorage.publish("data-change",{action:"storage-remove",key:t}),!0},clear:function(){for(var e=this.keys(),t=0;t<e.length;t++){var i=e[t];0===i.indexOf(this.storagePrefix)&&this.removeItem(i.replace(this.storagePrefix,""))}},keys:function(){for(var e=[],t=0,i=localStorage.length;t<i;++t){var r=localStorage.key(t);0===r.indexOf(this.storagePrefix)&&e.push(r)}return e},metricalObject:function(){for(var e={},t=this.keys(),i=0;i<t.length;i++){var r=t[i],n=this.getItem(r);e[r]=n}return e}},SessionStorage:{storagePrefix:"_Metrical_",prefixKey:function(e){return e=0===e.indexOf(this.storagePrefix)?e:this.storagePrefix+e},getItem:function(e){e=this.prefixKey(e);var t=sessionStorage.getItem(e);return _MetricalUtils.isJson(t)&&(t=JSON.parse(t)),t},setItem:function(e,t){var i=this.prefixKey(e);value="object"==typeof t?JSON.stringify(t):t;var r=this.getItem(e);sessionStorage.setItem(i,value),0==_MetricalUtils.isEqual(r,t)&&_MetricalStorage.publish("data-change",{action:"session-set",key:i,value:t})},removeItem:function(e){var t=this.prefixKey(e);return sessionStorage.removeItem(t),_MetricalStorage.publish("data-change",{action:"session-remove",key:t}),!0},clear:function(){for(var e=this.keys(),t=0;t<e.length;t++){var i=e[t];0===i.indexOf(this.storagePrefix)&&this.removeItem(i.replace(this.storagePrefix,""))}},keys:function(){for(var e=[],t=0,i=sessionStorage.length;t<i;++t){var r=sessionStorage.key(t);0===r.indexOf(this.storagePrefix)&&e.push(r)}return e},metricalObject:function(){for(var e={},t=this.keys(),i=0;i<t.length;i++){var r=t[i],n=this.getItem(r);e[r]=n}return e}},Cookie:{path:"/",domain:document.domain,prefix:"_Metrical_",altPrefix:"_MetricalObject_",longLivedCookies:["_Metrical_ACStatusOutputCounter","_Metrical_UserAbandonCount","_Metrical_ConditionsObserver_enabled","_Metrical_promoopened_general","_Metrical_PageViewCount","_Metrical_TimeOnSite","_Metrical_offers_disabled","_Metrical_CookiesUpdated","_MetricalObject_QA","_MetricalObject_did","_MetricalObject_sample","_MetricalObject_tracking","_Metrical_clickregistered_","_MetricalAbandonCart_","_treatmenttag","_testgroup","_localtime_override"],isLongLivedKey:function(e){return e=this.prefixKey(e),this.longLivedCookies.filter(function(t){return-1!==e.indexOf(t)}).length>0},rootDomain:function(){var e=location.hostname.split(".").reverse();return e.length>1?"uk"==e[0]&&"co"==e[1]&&e.length>2?"."+e[2]+"."+e[1]+"."+e[0]:"com"==e[0]&&"myshopify"==e[1]?location.hostname:"."+e[1]+"."+e[0]:"."+e[0]},prefixKey:function(e){return e=0===e.indexOf(this.prefix)||0===e.indexOf(this.altPrefix)?e:this.prefix+e},getItem:function(e){e=this.prefixKey(e);var t=decodeURIComponent(document.cookie.replace(new RegExp("(?:(?:^|.*;)\\s*"+encodeURIComponent(e).replace(/[\-\.\+\*]/g,"\\$&")+"\\s*\\=\\s*([^;]*).*$)|^.*$"),"$1"))||null;return _MetricalUtils.isJson(t)&&(t=JSON.parse(t)),t},getItemWithoutPrefix:function(e){var t=decodeURIComponent(document.cookie.replace(new RegExp("(?:(?:^|.*;)\\s*"+encodeURIComponent(e).replace(/[\-\.\+\*]/g,"\\$&")+"\\s*\\=\\s*([^;]*).*$)|^.*$"),"$1"))||null;return _MetricalUtils.isJson(t)&&(t=JSON.parse(t)),t},sessionQuickSet:function(e,t){return this.quickSet(e,t,0)},quickSet:function(e,t,i){return void 0===i&&(i=1/0),this.setItem(e,t,i,this.path,this.rootDomain(),!1)},setItem:function(e,t,i,r,n,o,a){if(r||(r=this.path),n||(n=this.rootDomain()),!e||/^(?:expires|max\-age|path|domain|secure|SameSite)$/i.test(e))return!1;e=this.prefixKey(e);var s="";if(i)switch(i.constructor){case Number:s=i===1/0?"; expires=Fri, 31 Dec 9999 23:59:59 GMT":"; max-age="+i;break;case String:s="; expires="+i;break;case Date:s="; expires="+i.toUTCString()}sValue="object"==typeof t?JSON.stringify(t):t;var l=location.protocol;o||"https:"!=l||(o="secure"),a||(a="Lax");var c=this.getItem(e),u=encodeURIComponent(e)+"="+encodeURIComponent(sValue)+s+(n?"; domain="+n:"")+(r?"; path="+r:"")+(o?"; secure":"")+"; SameSite="+a;return document.cookie=u,0==_MetricalUtils.isEqual(c,t)&&_MetricalStorage.publish("data-change",{action:"cookie-set",key:e,value:t}),!0},removeItem:function(e,t,i){return!(!e||!this.hasItem(e))&&(e=this.prefixKey(e),t=t||this.path,i=i||this.rootDomain(),document.cookie=encodeURIComponent(e)+"=; expires=Thu, 01 Jan 1970 00:00:00 GMT"+(i?"; domain="+i:"")+(t?"; path="+t:""),_MetricalStorage.publish("data-change",{action:"cookie-remove",key:e}),!0)},hasItem:function(e){return e=this.prefixKey(e),new RegExp("(?:^|;\\s*)"+encodeURIComponent(e).replace(/[\-\.\+\*]/g,"\\$&")+"\\s*\\=").test(document.cookie)},keys:function(){for(var e=document.cookie.replace(/((?:^|\s*;)[^\=]+)(?=;|$)|^\s*|\s*(?:\=[^;]*)?(?:\1|$)/g,"").split(/\s*(?:\=[^;]*)?;\s*/),t=0;t<e.length;t++)e[t]=decodeURIComponent(e[t]);return e},getAllCookies:function(){return this.getCookies(!1)},getCookies:function(e){null==e&&(e=!0);for(var t=this.keys(),i=[],r=0;r<t.length;r++){var n=t[r],o=this.getItem(n);1==e&&-1==n.indexOf(this.metricalCookieNamePrefix)||i.push({"cookie-key":n,value:o})}return i},getAllCookieObject:function(){return this.getCookieObject(!1)},getCookieObject:function(e){for(var t=this.getCookies(e),i={},r=0;r<t.length;r++){var n=t[r],o=n["cookie-key"],a=n.value;i[o]=a}return i},makeExpires:function(e){var t=new Date;return t.setTime(t.getTime()+1e3*e),t},metricalObject:function(){for(var e={},t=this.keys(),i=0;i<t.length;i++){var r=t[i];if(0===r.indexOf(this.prefix)||0===r.indexOf(this.altPrefix)){var n=this.getItem(r);e[r]=n}}return e},addSameSiteSupport:function(){var e=this;if(!this.hasItem("CookiesUpdated")){var t=[];this.keys().forEach(function(i){-1!==i.indexOf("Metrical")&&e.longLivedCookies.forEach(function(e){-1!==i.indexOf(e)&&t.push(i)})}),t.forEach(function(t){var i=e.getItem(t);i&&e.setItem(t,i,1/0,"/",e.rootDomain())}),e.setItem("CookiesUpdated",!0,1/0,"/",e.rootDomain())}}},ServerStore:{store:{},objKey:null,init:function(e,t){if(this.objKey=t,0!=!!e){var i=this,r=_MetricalHosts.endpoints.offerFlowStore+"/"+e;jQuery.ajax({type:"GET",url:r,dataType:"json",async:!1,success:function(e){i.store[i.objKey]=e,console.log("data"),console.log(e)},error:function(e,t,i){console.log(e),console.log(t),console.log(i)}})}},getItem:function(e){return this.store[e]?this.store[e]:null},setItem:function(e,t){this.store[e]=t},_post:function(e){var t=_MetricalHosts.endpoints.offerFlowStore;navigator.sendBeacon(t,JSON.stringify(e))}}},Object.setPrototypeOf(_MetricalStorage,_MetricalUtils.PubSub()),_MetricalTransportDefault=function(e){var t={logLevel:"warning",levels:{trace:10,debug:20,info:30,warning:40,error:50,fatal:60},filters:[],infoLogFunc:console.log,errorLogFunc:console.error};this.properties=Object.assign({},t,e),this.levels=this.properties.levels},_MetricalTransportDefault.prototype.write=function(e){var t=this.levels[this.properties.logLevel];this.levels[e.level]>=t&&this.entryPassesFilters(e)&&(e.value>=50?this.properties.errorLogFunc(e):this.properties.infoLogFunc(e))},_MetricalTransportDefault.prototype.setLogLevel=function(e){if(!(e in this.levels))throw new Error("Passed value "+e+" is not a valid log level");this.properties.logLevel=e},_MetricalTransportDefault.prototype.clearFilters=function(){this.properties.filters=[]},_MetricalTransportDefault.prototype.addFilter=function(e){if(!("path"in e))throw new Error("path parameter is a required key in the filter");if(!("is"in e||"not"in e))throw new Error("is or not parameters are a required key in the filter");this.properties.filters.push(e)},_MetricalTransportDefault.prototype.entryPassesFilters=function(e){return 0==this.properties.filters.length||1!=this.properties.filters.map(function(t){try{var i=t.path,r=null,n=!0;if("is"in t&&(r=t.is),"not"in t&&(r=t.not,n=!n),i in e&&null!==r)if(e[i]==r)return n;return!n}catch(e){return console.error(e),!0}}).includes(!1)},_MetricalLogger=function(e){this.properties=Object.assign({},{defaultLevel:"info",extra:{},transports:[],levels:{trace:10,debug:20,info:30,warning:40,error:50,fatal:60}},e),this.levels=this.properties.levels,this.transports=this.properties.transports},_MetricalLogger.prototype.addTransport=function(e){this.transports.push(e)},_MetricalLogger.prototype.clearTransports=function(){this.transports=[]},_MetricalLogger.prototype.child=function(e){var t=Object.assign({},this.properties,{extra:e||{}});return new _MetricalLogger(t)},_MetricalLogger.prototype._formatEntry=function(e,t,i){var r=(new Date).toISOString();return Object.assign({level:e,value:this.levels[e],ts:r},this.properties.extra||{},t||{},i||{})},_MetricalLogger.prototype.transport=function(e){this.transports.forEach(function(t){switch(typeof t){case"function":t(e);break;case"object":"write"in t&&t.write(e)}})},_MetricalLogger.prototype.log=function(){var e=this.properties.defaultLevel,t="",i={};if(1==arguments.length)t="object"==typeof arguments[0]?Object.assign(arguments[0]):{msg:String(arguments[0])};else if(2==arguments.length){var r=arguments[0];r in this.levels?(e=r,t="object"==typeof arguments[1]?Object.assign(arguments[1]):{msg:String(arguments[1])}):(t="object"==typeof arguments[0]?Object.assign(arguments[0]):{msg:String(arguments[0])},i="object"==typeof arguments[1]?Object.assign(arguments[1]):{})}else 3==arguments.length&&(e=arguments[0],t="object"==typeof arguments[1]?Object.assign(arguments[1]):{msg:String(arguments[1])},i="object"==typeof arguments[2]?Object.assign(arguments[2]):{});var n=this._formatEntry(e,t,i);this.transport(n)},_MetricalLogger.prototype.traceStart=function(e,t){this.trace(">>> "+e,t)},_MetricalLogger.prototype.traceEnd=function(e,t){this.trace("<<< "+e,t)},_MetricalLogger.prototype.trace=function(e,t){this.log("trace",e,t)},_MetricalLogger.prototype.debug=function(e,t){this.log("debug",e,t)},_MetricalLogger.prototype.info=function(e,t){this.log("info",e,t)},_MetricalLogger.prototype.warning=function(e,t){this.log("warning",e,t)},_MetricalLogger.prototype.error=function(e,t){this.log("error",e,t)},_MetricalLogger.prototype.fatal=function(e,t){this.log("fatal",e,t)},_MetricalUserEvents={events:{},interacted:{},handles:{},init:function(e){var t={interactIntervals:[],document:document,window:window,throttle:_MetricalUtils.throttle,debounce:_MetricalUtils.debounce,logger:new _MetricalLogger({extra:{module:"userevents"}})};if(this.properties=Object.assign({},t,e||{}),this.logger=this.properties.logger,this.events={},this.interacted={},this.handles={},this.lastPageYOffset=0,this.lastPercentChange=0,this.interactTimer=null,this.properties.interactIntervals.length>0){var i=this;this.properties.interactIntervals.forEach(function(e){i.interacted[e.interval]=!1})}this._initializeEvents()},hasIntervals:function(){return this.properties.interactIntervals.length>0},addInterval:function(e,t){0==this.properties.interactIntervals.map(function(e){return e.topic}).includes(t)&&(this.properties.interactIntervals.push({interval:e,topic:t}),this.interacted[e]=!1)},_setInteracted:function(){if(this.properties.interactIntervals.length>0){var e=this;this.properties.interactIntervals.forEach(function(t){e.interacted[t.interval]=!0})}},startIntervals:function(){var e=this;this.properties.interactIntervals.length>0&&this.properties.interactIntervals.forEach(function(t){var i=t.interval,r=t.topic,n=1e3*i;e.handles[i]=setInterval(function(){e.publish(r,{hasInteracted:e.interacted[i]}),e.interacted[i]=!1},n)})},scrollPercent:function(){var e=document.documentElement,t=document.body,i="scrollTop",r="scrollHeight";return(e[i]||t[i])/((e[r]||t[r])-e.clientHeight)*100},initializeForms:function(e,t,i){var r=this;r.logger.traceStart("initializeForms"),void 0===t&&(t=[]),void 0===i&&(i=[]),r.checkFilters(e)?(r.logger.debug("Filter check passed for initializeForms"),r.properties.document.addEventListener("change",function(e){var n=((e=e||r.properties.window.event).target||e.srcElement).closest("form");if(n){var o=n.id,a=i.includes(o),s=t.includes(o);if(r.logger.debug("Whitelist and Blacklist results",{inBlacklist:a,inWhitelist:s}),0==a&&(0==t.length||1==s)){var l=r.formData(n);r.logger.debug("Form data",{data:l}),r.publish("capture-form",l)}}})):r.logger.debug("Filter check failed for initializeForms"),r.logger.traceEnd("initializeForms")},formData:function(e){var t=new FormData(e),i={};for(var r of t.entries()){var n=r[0],o=r[1];if(n in i&&0==Array.isArray(i[n])){var a=i[n];i[n]=[],i[n].push(a),i[n].push(o)}else 1==Array.isArray(i[n])?i[n].push(o):i[n]=o}return{formId:e.id||e.name||"unknown",fromData:i}},checkFilters:function(e){var t=this;return void 0===e&&(e={}),(e=Array.isArray(e)?e:[e]).reduce(function(e,i){var r="url"in i?i.url:".*",n="eval"in i?i.eval:"true",o=_MetricalUtils.testRegex(r,t.properties.window.location.href),a=_MetricalUtils.evaluate(n);return o&&a&&(e=!0),e},!1)},initializeClicks:function(e,t){var i=this;i.logger.traceStart("initializeClicks"),void 0===t&&(t=[{tag:"input"},{tag:"button"},{tag:"select"},{tag:"textarea"},{tag:"a"},{tag:"area"}]),t=Array.isArray(t)?t:[t],i.checkFilters(e)?(i.logger.debug("Filter check passed for initializeClicks"),i.properties.document.addEventListener("click",function(e){var r=(e=e||window.event).target||e.srcElement;t.forEach(function(e){var t=r.closest(e.tag);if(t){var n=!0;if("class"in e){var o=Array.isArray(e.class)?e.class:[e.class],a=t.classList;n=1!=o.map(function(e){return a.contains(e)}).includes(!1)}else n=!0;n&&i.publish("capture-click",t)}})},!1)):i.logger.debug("Filter check failed for initializeClicks"),i.logger.traceEnd("initializeClicks")},initializePageLeave:function(){var e=this;e.logger.traceStart("initializePageLeave"),e.properties.document.addEventListener("visibilitychange",function(t){"hidden"===e.properties.document.visibilityState&&e.publish("unload",t)}),e.logger.traceEnd("initializePageLeave")},_initializeEvents:function(){var e=this,t=e.properties.throttle(function(t){e.publish("interact",t)},750);e.properties.window.addEventListener("mousemove",e.properties.debounce(function(i){e._setInteracted(),e.publish("mousemove",i),t(i)},250)),e.properties.window.addEventListener("scroll",e.properties.debounce(function(i){e._setInteracted(),e.publish("scroll",i),t(i);var r=Math.max(e.properties.window.pageYOffset||0,e.properties.window.scrollY||0),n=e.scrollPercent();if(r>e.lastPageYOffset){var o=n-e.lastPercentChange;e.publish("scrolldown",i,{percent:n,percentDelta:o})}if(r<e.lastPageYOffset){o=e.lastPercentChange-n;e.publish("scrollup",i,{percent:n,percentDelta:o})}e.lastPageYOffset=r,e.lastPercentChange=n},250)),e.properties.window.addEventListener("keydown",function(i){e._setInteracted(),e.publish("keydown",i),t(i)}),e.properties.window.addEventListener("click",function(i){e._setInteracted(),e.publish("click",i),t(i)}),e.properties.window.addEventListener("touchstart",function(i){e._setInteracted(),t(i)}),e.properties.window.addEventListener("touchmove",e.properties.debounce(function(i){e._setInteracted(),t(i)},250)),e.properties.document.addEventListener("mouseout",function(t){var i=void 0;"toElement"in t&&(i=t.toElement),"relatedTarget"in t&&(i=t.relatedTarget),null===i&&e.publish("documentout",t)}),e.properties.window.addEventListener("resize",e.properties.debounce(function(t){e.publish("resize",t)},250)),e.properties.document.addEventListener("mouseup",function(t){var i="";window.getSelection?i=window.getSelection().toString():document.selection&&(i=document.selection.createRange().text),i&&e.publish("textSelect",i)}),e.properties.document.addEventListener("copy",function(t){var i=e.properties.document.getSelection();i&&(i=i.toString())&&e.publish("copy",i)}),this.interactTimer=setInterval(t,2e3)},initializeOnSubscribe:function(e){var t=this.events[e]||!1;if(Array.isArray(t)&&0===t.length)switch(e){case"unload":this.initializePageLeave()}},subscribe:function(e,t){var i=this.events[e];!1==!!i&&(i=this.events[e]=[]),"function"==typeof t&&(this.initializeOnSubscribe(e),i.push(t))},unsubscribe:function(e,t){var i=this.events[e];if(!1!=!!i){var r=i.indexOf(t);i.splice(r)}},publish:function(e,t,i){var r=this.events[e];!1!=!!r&&r.forEach(function(e){"function"==typeof e&&e.call(this,t,i)})}},_MetricalDimensions=function(e){const t={document:document||null,window:window||null};this.properties=Object.assign({},t,e||{})},_MetricalDimensions.prototype.documentWidth=function(){return Math.max(this.properties.document.body.clientWidth||0,this.properties.document.documentElement.clientWidth||0,this.properties.window.innerWidth||0)},_MetricalDimensions.prototype.documentHeight=function(){return Math.max(this.properties.document.body.clientHeight||0,this.properties.document.documentElement.clientHeight||0,this.properties.window.innerHeight||0)},_MetricalDimensions.prototype.viewPortWidth=function(){return Math.max(this.properties.document.documentElement.clientWidth||0,this.properties.window.innerWidth||0)},_MetricalDimensions.prototype.viewPortHeight=function(){return Math.max(this.properties.document.documentElement.clientHeight||0,this.properties.window.innerHeight||0)},_MetricalDimensions.prototype.browserWidth=function(){return this.properties.window.outerWidth||0},_MetricalDimensions.prototype.browserHeight=function(){return this.properties.window.outerHeight||0},_MetricalDimensions.prototype.screenWidth=function(){return this.properties.window.screen.width||0},_MetricalDimensions.prototype.screenHeight=function(){return this.properties.window.screen.height||0},_MetricalExitIntent=function(e){if(this.properties=Object.assign({},{yStart:0,yThickness:10,leftZoneSize:200,rightZoneSize:200,dimensions:null},e||{}),!1==!!this.properties.dimensions)throw new Error("Exit intent requires the dimensions module be passed");this.x=null,this.y=null,this.zones=[],this.exitIntents=0,this.lastExitIntentTimestamp=null},_MetricalExitIntent.prototype.hasExitIntent=function(){return this.exitIntents>0},_MetricalExitIntent.prototype.checkForIntent=function(e,t){return this.x=e,this.y=t,1==this.isInZone(this.x,this.y)&&(this.incrementExitIntents(),!0)},_MetricalExitIntent.prototype.incrementExitIntents=function(){this.exitIntents++,this.lastExitIntentTimestamp=(new Date).getTime()},_MetricalExitIntent.prototype.isInZone=function(e,t){return t<=this.properties.yStart+this.properties.yThickness};var _Metrical={startingBehavior:null,shouldDisplay:!1,showWidget:function(){return"Not active yet. Please wait."},makeVisible:function(){},addLoadEvent:function(e){var t=window.onload;"function"!=typeof window.onload?window.onload=e:window.onload=function(){t&&t(),e()}},waitAdditionalJS:!1,clearCookies:function(){var e=_Metrical.app.getCookieObject();return jQuery.each(e,function(e,t){_Metrical.app.removeCookieByKey(e)}),"All Metrical cookies are cleared."},init:function(jQuery,_MetricalObject){var rootMetricalObj=this;_MetricalStorage.Cookie.addSameSiteSupport(),function(e){window.XDomainRequest&&!e.support.cors&&e.ajaxTransport(function(t){var i;if(t.crossDomain&&t.async)return t.timeout&&(t.xdrTimeout=t.timeout,delete t.timeout),{send:function(r,n){function o(t,r,o,a){i.onload=i.onerror=i.ontimeout=i.onprogress=e.noop,i=void 0,e.event.trigger("ajaxStop"),n(t,r,o,a)}(i=new XDomainRequest).open(t.type,t.url),i.onload=function(){var e=200,t=i.responseText,r=null!=i.responseText&&""!=i.responseText?JSON.parse(i.responseText):"";r.StatusCode&&r.Message&&(e=r.StatusCode,t=r.Message),o(e,t,{text:t},"Content-Type: "+i.contentType)},i.onerror=function(){o(500,"Unable to Process Data")},i.onprogress=function(){},t.xdrTimeout&&(i.ontimeout=function(){o(0,"timeout")},i.timeout=t.xdrTimeout),i.send(t.hasContent&&t.data||null)},abort:function(){i&&(i.onerror=e.noop(),i.abort())}}})}(jQuery),function($){var Logging=function(){this.logs=new Array},Metrical_options;function log(e){window.console&&MetricalApp.logging.logInfo(e)}function url_protocol(){return"https:"===document.location.protocol?"https://":"http://"}function detectmob(){return window.innerWidth<=800&&window.innerHeight<=600}function are_cookies_enabled(){var e=!!navigator.cookieEnabled;return void 0!==navigator.cookieEnabled||e||(document.cookie="testcookie=1",(e=-1!=document.cookie.indexOf("testcookie"))&&(document.cookie="testcookie=1; expires=Thu, 01-Jan-1970 00:00:01 GMT")),e}function makeUUID(){var e=Date.now();return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(t){var i=(e+16*Math.random())%16|0;return e=Math.floor(e/16),("x"==t?i:7&i|8).toString(16)})}function _MetricalObject_did_cookie(){docCookies.hasItem("_MetricalObject_did")||(uuid=makeUUID(),date=new Date,date.setTime(date.getTime()+15768e7),docCookies.setItem("_MetricalObject_did",uuid,date,"/",docCookies.rootDomain()))}function _MetricalObject_sessionid(){docCookies.hasItem("_MetricalObject_sessionid")||(uuid=makeUUID(),docCookies.setItem("_MetricalObject_sessionid",uuid,"","/",docCookies.rootDomain()))}if(Logging.prototype.logInfo=function(e,t){this.logs.push({level:"info",message:e,object:t})},Logging.prototype.logError=function(e){this.logs.push({level:"error",object:e})},rootMetricalObj.echoLog=function(e){if(window.console){var t=0;jQuery.each(MetricalApp.logging.logs,function(i,r){if("info"==r.level?null!=r.object?console.info(r.message,r.object):console.info(r.message):"error"==r.level&&(void 0!==r.object&&r.object instanceof Error?console.error(r.object.name+" - "+r.object.message,r.object.stack):console.error("Error - ",r.object)),t++,void 0!==e&&t>=e)return!1})}return"End of logs"},rootMetricalObj.flushLog=function(){return MetricalApp.logging.logs.splice(0,MetricalApp.logging.logs.length),"Log flushed out"},Metrical_options=void 0===_MetricalObject?{}:_MetricalObject,null==Metrical_options.survey)for(var property in Metrical_options)if(Metrical_options.hasOwnProperty(property)&&"metricalid"==property.toLowerCase()){Metrical_options.survey=Metrical_options[property];break}var defaultStarsForScale=5,MetricalApp={logging:new Logging,defaultProperties:{usermeta:{},surveyanswerendpoint:_MetricalHosts.legacy.surveyanswerendpoint,cxinteractionendpoint:_MetricalHosts.legacy.cxinteractionendpoint,apiendpointhost:_MetricalHosts.legacy.apiendpointhost,staticendpointhost:_MetricalHosts.legacy.staticendpointhost,positiontype:"fixed",position:"right-top",mobilecss:null,mobilejs:null,postCallback:function(){},preInitHook:function(){},postInitHook:function(){},makeVisibleHook:function(){},afterDelayOpenedHook:function(){},preShowHook:function(){},postWidgetRender:function(){},echolog:!1,defaultstylesheet:"/css/styles.css",rendertype:null},properties:{},el:null,elTab:null,sa_container:null,tabOpenerTimer:null,tabCloserTimer:null,timedQuestionDelay:null,timedQuestionButtonAction:null,cookieName:["_MetricalObject_QA","_MetricalObject_did","_MetricalObject_transitial","_Metrical_PageViewCount","_MetricalObject_sample","_MetricalObject_tracking","_MetricalObject_sessionid","_Metrical_TimeOnSite"],transitialCookeName:"_MetricalObject_transitial",operationsTracking:{randomSample:null,metricalInitializationCount:1},instanceId:null,sampleValue:null,initTimestamp:null,pageLoadTimeOnSite:0,timeOnSiteTimer:null,logger:null,defaultTransport:null,ei:null,generateInstanceId:function(){var e=Date.now(),t="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(t){var i=(e+16*Math.random())%16|0;return e=Math.floor(e/16),("x"==t?i:7&i|8).toString(16)});return this.instanceId=t,MetricalApp.logging.logInfo("generated instanceId with the value "+this.instanceId),this.instanceId},generateSampleValue:function(){this.sampleValue=Math.floor(100*Math.random())},setSampleCookie:function(){docCookies.hasItem("_MetricalObject_sample")||docCookies.setItem("_MetricalObject_sample",this.sampleValue,"","/",docCookies.rootDomain())},setupTrackingObject:function(){docCookies.hasItem("_MetricalObject_tracking")&&null!=docCookies.getItem("_MetricalObject_tracking")&&""!=docCookies.getItem("_MetricalObject_tracking")?(cookieValue=docCookies.getItem("_MetricalObject_tracking"),this.operationsTracking=JSON.parse(cookieValue),this.operationsTracking.randomSample=this.sampleValue,this.operationsTracking.metricalInitializationCount++,docCookies.setItem("_MetricalObject_tracking",JSON.stringify(this.operationsTracking),"","/",docCookies.rootDomain())):(this.operationsTracking.randomSample=this.sampleValue,docCookies.setItem("_MetricalObject_tracking",JSON.stringify(this.operationsTracking),"","/",docCookies.rootDomain())),rootMetricalObj.operationsTracking=this.operationsTracking},init:function(e,t){var i=this;this.generateInstanceId(),this.generateSampleValue(),this.setSampleCookie(),_MetricalBrowserHistory.init(),this.setupTrackingObject(),this.properties=$.extend(this.defaultProperties,e),this.properties.apiendpointhost=url_protocol()+this.properties.apiendpointhost,this.properties.staticendpointhost=url_protocol()+this.properties.staticendpointhost,MetricalApp.logging.logInfo("configured properties",this.properties),MetricalApp.logging.logInfo("metrical version",rootMetricalObj.version);if(docCookies.hasItem("_Metrical_TimeOnSite")){var r=parseInt(docCookies.getItem("_Metrical_TimeOnSite"));MetricalApp.pageLoadTimeOnSite=r}"function"==typeof this.properties.preInitHook&&this.properties.preInitHook(this),this.setCSS().then(function(e){"function"==typeof i.properties.postInitHook&&i.properties.postInitHook(i),"function"==typeof t&&t(i)}),this.setInnerCss(),this.setExternalCSS(),this.setIOSSpecificCSSJS(),_MetricalTestMode.init(docCookies),this.logger=new _MetricalLogger,this.defaultTransport=new _MetricalTransportDefault,this.defaultTransport.setLogLevel(_MetricalStorage.Storage.getItem("loglevel")||"error"),(_MetricalStorage.Storage.getItem("logfilters")||[]).forEach(function(e){i.defaultTransport.addFilter(e)}),this.logger.addTransport(this.defaultTransport),_MetricalUserEvents.init({logger:this.logger}),this.ei=new _MetricalExitIntent({dimensions:new _MetricalDimensions});var n=function(){return SurveyMdl.widgetObj.exitintentisactive&&!0===SurveyMdl.widgetObj.exitintentisactive&&!(!0===_Metrical.hasReevaluated)&&!(!0===_Metrical.disableExitIntentCX)};"desktop"==_MetricalUtils.determineDevice()?_MetricalUserEvents.subscribe("documentout",function(e){null!=e&&null!=e.clientX&&null!=e.clientY&&i.ei.checkForIntent(e.clientX,e.clientY),i.ei.hasExitIntent()&&n()&&(_Metrical.hasReevaluated=!0,_Metrical.reevaluate())}):(_MetricalUserEvents.subscribe("scrollup",function(e){i.ei.incrementExitIntents()}),i.ei.hasExitIntent()&&n()&&(_Metrical.hasReevaluated=!0,_Metrical.reevaluate()))},reinit:function(e){"function"==typeof e&&e(this),this.ADATrap(MetricalApp.el)},postSurveyInit:function(){this.configureDomMountPoint(),Validator.properties(this.properties),this.properties.iframe&&this.resizeParent(),this.updatePageLoads(),this.setupInteractions(),MetricalApp.timeOnSiteTimer=setInterval(function(){var e=MetricalApp.updateTimeOnSite();MetricalApp.handleTimeOnSiteEvent(e)},1e3)},identifierIsIOS:function(){return!!/iPhone|iPad|iPod/i.test(navigator.userAgent)},determineIdentifier:function(){var e="desktop";/Touch|Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)&&(e=window.matchMedia("(max-width: 730px)").matches?"mobile":window.matchMedia("screen and (orientation: portrait)").matches?screen.width<=480?"mobile":"tabletvertical":screen.height<=480?"mobile":"tablethorizontal");return e},loadAsset:function(e,t,i){return new Promise(function(i,r){try{var n=document.createElement(e);switch(e){case"link":n.setAttribute("rel","stylesheet"),n.setAttribute("href",t),n.setAttribute("type","text/css"),document.head.appendChild(n);break;case"script":n.src=t,document.body.appendChild(n)}n.onload=function(){i(t)}}catch(e){r(e)}})},setCSS:function(){var e=this;MetricalApp.logging.logInfo("Loading the base CSS files");var t=this.properties.staticendpointhost;null!=this.properties.cssendpointhost&&(t=url_protocol()+this.properties.cssendpointhost);var i=[],r=t+"/css/reset.css";i.push(r);var n=t+"/css/styles-noie8.css";(i.push(n),void 0!==MetricalApp.properties.css)&&(Array.isArray(MetricalApp.properties.css)?MetricalApp.properties.css:[MetricalApp.properties.css]).forEach(function(e){i.push(e)});var o=i.map(function(t){return e.loadAsset("link",t)});if(MetricalApp.properties.supportie9){var a=t+"/css/styles-ie8.css";i.push(a)}if(MetricalApp.properties.iframe){var s=t+"/css/iframe.css";i.push(s)}return Promise.all(o)},setExternalCSS:function(){void 0!==MetricalApp.properties.css&&($.isArray(MetricalApp.properties.css)?$.each(MetricalApp.properties.css,function(e,t){$("head link[rel='stylesheet']").last().after("<link rel='stylesheet' href='"+t+"' type='text/css' >")}):$("head link[rel='stylesheet']").last().after("<link rel='stylesheet' href='"+MetricalApp.properties.css+"' type='text/css' >"))},setJS:function(){additionalJS=ClientWidget.widgetObj.js,void 0!==additionalJS&&(rootMetricalObj.waitAdditionalJS=!0,$.isArray(additionalJS)?$.each(additionalJS,function(e,t){$.getScript(t).done(function(t,i){e==additionalJS.length-1&&(rootMetricalObj.waitAdditionalJS=!1)}).fail(function(t,i,r){e==additionalJS.length-1&&(rootMetricalObj.waitAdditionalJS=!1),console.log("Triggered ajaxError handler.")})}):$.getScript(additionalJS).done(function(e,t){rootMetricalObj.waitAdditionalJS=!1}).fail(function(e,t,i){rootMetricalObj.waitAdditionalJS=!1,console.log("Triggered ajaxError handler.")}))},setInnerCss:function(){if(void 0!==this.properties.style){var e=this.properties.style,t="<style>";if(void 0!==e.buttoncolour&&(t+=".Metrical .form-list input[type='submit'] {background-color: "+e.buttoncolour+";}"),void 0!==e.buttoncolourhover&&(t+=".Metrical .form-list input[type='submit']:hover {background-color: "+e.buttoncolourhover+";}"),void 0!==e.topbordercolour&&(t+=".Metrical .lb-wrapper  {border-top: 5px solid "+e.topbordercolour+" ;}"),void 0!==e.starhovercolour&&(t+=".Metrical .form-list .ratings .star:hover {background-color: "+e.starhovercolour+";}",t+="#metrical-widget-form input[type='radio']  + label:hover {background-color: "+e.starhovercolour+";}"),void 0!==e.staractivecolour&&(t+=".Metrical .form-list .ratings .star.active {background-color: "+e.staractivecolour+";}",t+=".#metrical-widget-form input[type='radio']:checked  + label {background-color: "+e.staractivecolour+";}",t+="#metrical-widget-form .active-labe{background-color: "+e.staractivecolour+" !important;}"),void 0!==e.tablinecolour)t+="left"===this.properties.position?".MetricalContainer  .elTab-left {border-top: 0.14em solid "+e.tablinecolour+";}":".MetricalContainer  .elTab-right {border-top: 0.14em solid "+e.tablinecolour+";}";MetricalApp.properties.iframe&&(t+=".container-left{padding-right: 0px;}"),t+="</style>",$("head").append(t)}},setSliderCSSJS:function(){var e=!1,t=ClientWidget.widgetObj.questions;if($.each(t,function(t,i){"slider"==i.questiontype&&(e=!0)}),e){var i=MetricalApp.properties.staticendpointhost;null!=MetricalApp.properties.cssendpointhost&&(i=url_protocol()+MetricalApp.properties.cssendpointhost),$("head").append("<link rel='stylesheet' href='"+i+"/css/jslider/jslider.css' type='text/css' >"),$("head").append("<link rel='stylesheet' href='"+i+"/css/jslider/jslider.metrical.css' type='text/css' >");var r=MetricalApp.properties.staticendpointhost;null!=MetricalApp.properties.jsendpointhost&&(r=url_protocol()+MetricalApp.properties.jsendpointhost),$.getScript(r+"/js/jslider/jshashtable-2.1_src.js").done(function(e,i){$.getScript(r+"/js/jslider/jquery.numberformatter-1.2.3.js").done(function(e,i){$.getScript(r+"/js/jslider/tmpl.js").done(function(e,i){$.getScript(r+"/js/jslider/jquery.dependClass-0.1.js").done(function(e,i){$.getScript(r+"/js/jslider/draggable-0.1.js").done(function(e,i){$.getScript(r+"/js/jslider/jquery.slider.js").done(function(e,i){$.each(t,function(e,t){if("slider"==t.questiontype){setTimeout(function e(){$("#"+t.id).length>0?$("#"+t.id).slider({from:t.slider.from,to:t.slider.to,step:t.slider.step,smooth:t.slider.smooth,round:t.slider.round,scale:t.slider.scale,dimension:t.slider.dimension,onstatechange:function(e){var i=t.id;e=e,SurveyAnswersMdl.questionsAnswers[i]=e,passValidator=Widget.checkActivateSubmit(),passValidator&&$("#metrical-confirm-button").is(":visible")}}):setTimeout(e,200)},200)}})}).fail(function(e,t,i){console.log("Triggered ajaxError handler.")})}).fail(function(e,t,i){console.log("Triggered ajaxError handler.")})}).fail(function(e,t,i){console.log("Triggered ajaxError handler.")})}).fail(function(e,t,i){console.log("Triggered ajaxError handler.")})}).fail(function(e,t,i){console.log("Triggered ajaxError handler.")})}).fail(function(e,t,i){console.log("Triggered ajaxError handler.")})}},setIOSSpecificCSSJS:function(){if(MetricalApp.logging.logInfo("Checking if is an iOS device to set specific CSS and JS"),/iPhone|iPad|iPod/i.test(navigator.userAgent)){css=".MetricalContainer input, .MetricalContainer select, .MetricalContainer textarea {font-size: 14px !important;}";var e=document.getElementsByTagName("head")[0],t=document.createElement("style");t.setAttribute("type","text/css"),t.styleSheet?t.styleSheet.cssText=css:t.appendChild(document.createTextNode(css)),e.appendChild(t),$(".MetricalContainer input, .MetricalContainer select, .MetricalContainer textarea").bind("focus",function(e){$("html, body").animate({scrollTop:0,scrollLeft:0},"slow")}),MetricalApp.logging.logInfo("Added specific CSS and JS for an iOS device")}else MetricalApp.logging.logInfo("Not an iOS device")},setCookie:function(){},postSize:function(e,t){var i=parent.postMessage?parent:parent.document.postMessage?parent.document:void 0;void 0!==i&&i.postMessage(e+":"+t,"*")},resizeParent:function(){var e=this;newHeight=$(".Metrical").height(),newWidth=$(".Metrical").width(),e.postSize(newHeight,newWidth),$(".Metrical").resize(function(){newHeight=$(".Metrical").height(),newWidth=$(".Metrical").width(),e.postSize(newHeight,newWidth)})},getCookieKeys:function(){return docCookies.keys()},getCookies:function(){var e=this,t=docCookies.keys(),i=[];return $.each(t,function(t,r){$.inArray(r,e.cookieName)>-1&&i.push({"cookie-key":r,value:docCookies.getItem(r)})}),i},getCookieObject:function(){for(var e=this.getCookies(),t={},i=0;i<e.length;i++){var r=e[i],n=r["cookie-key"],o=r.value;t[n]=o}return t},removeCookieByKey:function(e){var t=document.domain;"_MetricalObject_QA"==e&&(t=null);return docCookies.removeItem(e,"/",t),!0},removeCookieByName:function(e){var t=document.domain;document.cookie=e+"=; expires="+ +new Date+"; domain="+t+"; path=/"},showContainer:function(){$(".MetricalContainer").removeClass("not-visible")},configureDomMountPoint:function(){if(MetricalApp.properties.iframe)MetricalApp.el=$("div.Metrical");else{var e="#"+this.properties.el,t="#"+this.properties.eltab,i=this.properties.rendertype?this.properties.rendertype:"slideout";this.properties.rendertype||"desktop"==MetricalApp.determineIdentifier()||(i="lightbox");var r=this.properties.position?this.properties.position:"left-middle";if(-1==["left-top","left-middle","left-bottom","bottom-left","bottom-middle","bottom-right","right-bottom","right-middle","right-top"].indexOf(r))r="left-middle";"lightbox"==i&&$("body").append('<div class="Metrical_lightbox"><div class="Metrical_lightbox_center"><div class="Metrical_lightbox_content"></div></div></div>');var n=r.split("-"),o=n[0],a=n[1],s=this.properties.positiontype?this.properties.positiontype:"absolute",l="container-middle",c="container-right",u="el-right",d="elTab-right";"left"===o&&(c="container-left",u="el-left",d="elTab-left"),"top"===a?l="container-top":"bottom"===a&&(l="container-bottom"),"bottom"===o&&(s=null,u="el-left",d="elTab-top",c="","left"===a?l="bottom-container-left":"middle"===a?l="bottom-container-middle":"right"===a&&(l="bottom-container-right")),position_type=s?"fixed"===s?"position-fixed":"position-absolute":"";var p=document.createElement("div");if(p=$(p).addClass("MetricalContainer").css("visibility","hidden").addClass(position_type).addClass(c).addClass(l),$("body").append(p),this.container=p,$(e).length>0)$(e).hasClass("Metrical")||$(e).addClass("Metrical"),$(e).addClass(u),this.el=$(e);else{p=document.createElement("div");p=$(p).addClass("Metrical").addClass(u),$("body").append(p),this.el=p}if($(t).length>0)$(t).html(),$(t).hasClass("MetricalTab")||$(t).addClass("MetricalTab"),$(t).addClass(d),this.elTab=$(t);else{p=document.createElement("div");p=$(p).addClass("MetricalTab").addClass(d).addClass("hidden"),$("body").append(p),this.elTab=p}this.el.appendTo(this.container),this.elTab.appendTo(this.container),"mobile"==MetricalApp.determineIdentifier()&&(SurveyMdl.widgetObj.avoidviewportformobile||$("body").append('<meta name="viewport" content="width=device-width, initial-scale=1">'))}},setTransitionalCookie:function(e){var t=MetricalApp.transitialCookeName,i=null;if(docCookies.hasItem(t)&&(i=docCookies.getItem(t)),"answered"!=i){var r,n=!1;void 0!==SurveyMdl.widgetObj.returningbehaviorclosetimeframe&&"dismissed"==e?n=SurveyMdl.widgetObj.returningbehaviorclosetimeframe:void 0!==SurveyMdl.widgetObj.returningbehaviorsubmittimeframe&&"answered"==e?n=SurveyMdl.widgetObj.returningbehaviorsubmittimeframe:"nointeraction"==e&&(n=void 0!==SurveyMdl.widgetObj.returningbehaviornointeractiontimeout?SurveyMdl.widgetObj.returningbehaviornointeractiontimeout:2592e3),n?(r=new Date).setTime(r.getTime()+1e3*n):r="",docCookies.setItem(t,e,r,"/",docCookies.rootDomain())}},getFullDateUTC:function(e){var t=""+e.getUTCFullYear(),i=""+(e.getUTCMonth()+1);1==i.length&&(i="0"+i);var r=""+e.getUTCDate();1==r.length&&(r="0"+r);var n=""+e.getUTCHours();1==n.length&&(n="0"+n);var o=""+e.getUTCMinutes();1==o.length&&(o="0"+o);var a=""+e.getUTCSeconds();return 1==a.length&&(a="0"+a),t+"-"+i+"-"+r+" "+n+":"+o+":"+a},updatePageLoads:function(){if(null!=SurveyMdl.widgetObj.openafterxloads)if(docCookies.hasItem("_Metrical_PageViewCount")){var e=parseInt(docCookies.getItem("_Metrical_PageViewCount"));docCookies.setItem("_Metrical_PageViewCount",e+1,"","/",docCookies.rootDomain())}else docCookies.setItem("_Metrical_PageViewCount",1,"","/",docCookies.rootDomain())},getInteractionData:function(){var e="";return void 0!==SurveyMdl.widgetObj.sitedelaybeforedisplay&&(e=SurveyMdl.widgetObj.sitedelaybeforedisplay),MetricalApp.initTimestamp?timeOnPage=Date.now()-MetricalApp.initTimestamp:timeOnPage=0,uuid=docCookies.hasItem("_MetricalObject_did")?docCookies.getItem("_MetricalObject_did"):"",sessionid=docCookies.hasItem("_MetricalObject_sessionid")?docCookies.getItem("_MetricalObject_sessionid"):"",selectedStartingBehavior=SurveyMdl.widgetObj.startingbehavior,ClientWidget.widgetObj.isReturningBehaviorAnswered()?selectedStartingBehavior=SurveyMdl.widgetObj.returningbehaviorsubmit:ClientWidget.widgetObj.isReturningBehaviorDismissed()?selectedStartingBehavior=SurveyMdl.widgetObj.returningbehaviorclose:ClientWidget.widgetObj.isReturningBehaviorNoInteraction()&&(selectedStartingBehavior=SurveyMdl.widgetObj.returningbehaviornointeraction),interactionData={uuid:uuid,usermeta:MetricalApp.properties.usermeta,survey_id:Metrical_options.survey,cookies:MetricalApp.getCookies(),url:window.location.href,device:MetricalApp.determineIdentifier(),instance_id:MetricalApp.instanceId,session_id:sessionid,timestamp:MetricalApp.getFullDateUTC(new Date),widget_init_timestamp:MetricalApp.properties.widgetinitializationtimestamp,isactive:SurveyMdl.widgetObj.isactive,survey_revision:SurveyMdl.widgetObj.revision,selected_starting_behavior:selectedStartingBehavior,is_returning_behavior:SurveyMdl.widgetObj.isReturningBehavior(),positiontype:MetricalApp.properties.positiontype,position:MetricalApp.properties.position,totalactivequestions:MetricalApp.properties.randomdisplaycount+MetricalApp.properties.nonrandomdisplaycount,randomdisplaycount:MetricalApp.properties.randomdisplaycount,nonrandomdisplaycount:MetricalApp.properties.nonrandomdisplaycount,emailisactivestatus:MetricalApp.properties.emailisactivestatus,"startingbehavior-nodisplay":SurveyMdl.widgetObj["startingbehavior-nodisplay"],"startingbehavior-closedonstart":SurveyMdl.widgetObj["startingbehavior-closedonstart"],"startingbehavior-openedonstart":SurveyMdl.widgetObj["startingbehavior-openedonstart"],sitedelaybeforedisplay:e,timeonpage:timeOnPage},interactionData},setupInteractions:function(){null!=MetricalApp.properties.captureinteractions&&(SurveyMdl.widgetObj.captureinteractions=MetricalApp.properties.captureinteractions),null!=MetricalApp.properties.gacaptureinteraction&&(SurveyMdl.widgetObj.gacaptureinteraction=MetricalApp.properties.gacaptureinteraction),null!=MetricalApp.properties.captureallinteractions&&(SurveyMdl.widgetObj.captureallinteractions=MetricalApp.properties.captureallinteractions),SurveyMdl.widgetObj.ipblacklist_enabled&&(SurveyMdl.widgetObj.captureinteractions=!0),properties={apiendpoint:MetricalApp.properties.cxinteractionendpoint,captureinteractions:SurveyMdl.widgetObj.captureinteractions,captureallinteractions:SurveyMdl.widgetObj.captureallinteractions,capturescrollinteractions:SurveyMdl.widgetObj.capturescrollinteractions,norecordonsubmitifempty:SurveyMdl.widgetObj.norecordonsubmitifempty,gacaptureinteraction:SurveyMdl.widgetObj.gacaptureinteraction,heartbeatisactive:SurveyMdl.widgetObj.heartbeatisactive,interactions:[]},null!=SurveyMdl.widgetObj.custominteractions&&(properties.interactions=properties.interactions.concat(SurveyMdl.widgetObj.custominteractions)),_MetricalInteractions.init($,properties,this.getInteractionData,this.setTransitionalCookie)},updateTimeOnSite:function(){var e=0;return MetricalApp.initTimestamp&&(timeOnPage=Date.now()-MetricalApp.initTimestamp,e=MetricalApp.pageLoadTimeOnSite+timeOnPage,docCookies.setItem("_Metrical_TimeOnSite",e,"","/",docCookies.rootDomain())),e},handleTimeOnSiteEvent:function(timeOnSite){null!=SurveyMdl.widgetObj.timeonsiteevent&&timeOnSite>SurveyMdl.widgetObj.timeonsiteevent.timespentonsite&&(MetricalApp.logging.logInfo("Triggering the time on site event"),null!=SurveyMdl.widgetObj.timeonsiteevent.filter?(MetricalApp.logging.logInfo("filter present, evaluating the filter "+SurveyMdl.widgetObj.timeonsiteevent.filter),result=eval(SurveyMdl.widgetObj.timeonsiteevent.filter)):result=!0,result?(openWidget=null==SurveyMdl.widgetObj.timeonsiteevent.openwidget||SurveyMdl.widgetObj.timeonsiteevent.openwidget,_Metrical.showWidget(),!jQuery(".MetricalContainer").hasClass("is-popped")&&openWidget&&jQuery(".MetricalTab").click()):MetricalApp.logging.logInfo("the filter configured filter for the time on site event didn't passed"),clearInterval(MetricalApp.timeOnSiteTimer))},startupTimedQuestion:function(){var e=MetricalApp.timedQuestionDelay,t=SurveyMdl.widgetObj.titletext,i=$(".form-list .ratings")[0].innerHTML;null==MetricalApp.tabCloserTimer&&($(".lb-wrapper div.MetricalHeader")[0].innerHTML=t.replace("{{timer}}",e),$(".form-list .ratings")[0].innerHTML=i.replace(/\{{timer}}/g,e),e--,MetricalApp.tabCloserTimer=setInterval(function(){$(".lb-wrapper div.MetricalHeader")[0].innerHTML=t.replace("{{timer}}",e),$(".form-list .ratings")[0].innerHTML=i.replace(/\{{timer}}/g,e),-1==--e&&(clearInterval(MetricalApp.tabCloserTimer),jQuery(".close-widget").click(),setTimeout(function(){jQuery(".MetricalContainer").hide()},200))},1e3))},ADATrap:function(e){var t=$(e).find(":tabbable"),i=!1,r=t.eq(0),n=t.eq(t.length-1);r.focus(),$(e).keyup(function(e){16===e.keyCode&&(i=!1)}),$(e).keydown(function(e){if(16===e.keyCode&&(i=!0),9===e.keyCode){if(e.target===n[0]&&!i)return r.focus(1),!1;if(e.target===r[0]&&i)return n.focus(1),!1}})},setFocusToMetricalTabButton:function(){document.getElementById("MetricalTabButton").focus()}};rootMetricalObj.app=MetricalApp;var docCookies={rootDomain:function(){var e=location.hostname.split(".").reverse();return e.length>1?"."+e[1]+"."+e[0]:"."+e[0]},getItem:function(e){return decodeURIComponent(document.cookie.replace(new RegExp("(?:(?:^|.*;)\\s*"+encodeURIComponent(e).replace(/[\-\.\+\*]/g,"\\$&")+"\\s*\\=\\s*([^;]*).*$)|^.*$"),"$1"))||null},setItem:function(e,t,i,r,n,o,a){if(!e||/^(?:expires|max\-age|path|domain|secure)$/i.test(e))return!1;var s="";if(i)switch(i.constructor){case Number:s=i===1/0?"; expires=Fri, 31 Dec 9999 23:59:59 GMT":"; max-age="+i;break;case String:s="; expires="+i;break;case Date:s="; expires="+i.toUTCString()}var l=location.protocol;return o||"https:"!=l||(o="secure"),a||(a="Lax"),document.cookie=encodeURIComponent(e)+"="+encodeURIComponent(t)+s+(n?"; domain="+n:"")+(r?"; path="+r:"")+(o?"; secure":"")+"; SameSite="+a,!0},removeItem:function(e,t,i){return!(!e||!this.hasItem(e))&&(document.cookie=encodeURIComponent(e)+"=; expires=Thu, 01 Jan 1970 00:00:00 GMT"+(i?"; domain="+i:"")+(t?"; path="+t:""),!0)},hasItem:function(e){return new RegExp("(?:^|;\\s*)"+encodeURIComponent(e).replace(/[\-\.\+\*]/g,"\\$&")+"\\s*\\=").test(document.cookie)},keys:function(){for(var e=document.cookie.replace(/((?:^|\s*;)[^\=]+)(?=;|$)|^\s*|\s*(?:\=[^;]*)?(?:\1|$)/g,"").split(/\s*(?:\=[^;]*)?;\s*/),t=0;t<e.length;t++)e[t]=decodeURIComponent(e[t]);return e}},WidgetExceptions={exception:function(e){log(e)}},Widget={el:null,containerTextboxActivated:new Array,bottomValue:-20,defaultBottomValue:-20,tabBottomValue:$.support.leadingWhitespace?143:208,defaultTabBottomValue:$.support.leadingWhitespace?143:208,shouldDisplay:!0,initiWasCalled:!1,init:function(e,t,i){var r=this;if(this.el=e,MetricalApp.logging.logInfo("widget.init el: ",this.el),r.initiWasCalled=!0,null!==r.el)if(i){if(Widget.isThankYouImageView())n=setTimeout(function(){$(".close-widget-thank").click()},Widget.getThankYouImageCloseTimeout());else var n=setTimeout(function(){r.resetForm()},2e3);$(".Metrical").data("closeTimeout",n),MetricalApp.properties.iframe?setTimeout(function(){r.renderWidgedAfterReset()},3500):$(".Metrical").data("closeBehavior",SurveyMdl.widgetObj.returningbehaviorclose)}else this.questionEvent(),this.submit(),this.slider(),r.renderWidget();now=new Date;var o=MetricalApp.getFullDateUTC(now);MetricalApp.initTimestamp=now,MetricalApp.properties.widgetinitializationtimestamp=o,MetricalApp.logging.logInfo("Registered the widget initialization timestamp",MetricalApp.properties.widgetinitializationtimestamp),$(document).trigger("setWidthAfterLoad")},renderElTab:function(){if(additionaParams=location.search,additionaParams=additionaParams.substr(1),widgetUrl=MetricalApp.properties.apiendpointhost+"/display/"+SurveyMdl.widgetObj.surveyid+"?mobile=1&customersite="+encodeURIComponent(document.URL)+"&"+additionaParams,additionaParams&&(widgetUrl+="&"),MetricalApp.properties.mobilecss){var e="css="+MetricalApp.properties.mobilecss+"&";widgetUrl+=e}if(MetricalApp.properties.mobilejs){var t="js="+MetricalApp.properties.mobilejs+"&";widgetUrl+=t}$(".MetricalTab").html('<a aria-label="'+SurveyMdl.widgetObj.tabtext+'" style="text-align:center" class = "mobile-tab mobile-link"  href = "'+widgetUrl+'" target="_blank">'+SurveyMdl.widgetObj.tabtext+"</a>"),!SurveyMdl.widgetObj.visibleonmobile||null==SurveyMdl.widgetObj.getReturningBehavior()&&SurveyMdl.widgetObj.startingbehavior==StartingBehavior.noDisplayBehavior||SurveyMdl.widgetObj.getReturningBehavior()==StartingBehavior.noDisplayBehavior||($(".MetricalTab").removeClass("hidden"),$(".MetricalTab a.mobile-link").click(function(e){_MetricalInteractions.recordInteraction("dismissed")}))},renderWidget:function(){if(MetricalApp.properties.iframe)void 0!==SurveyMdl.widgetObj.surveyid&&(this.el.html(WidgetView.widgetMarkup(SurveyMdl.widgetObj)),Widget.setupLastElement());else{cookieName=MetricalApp.transitialCookeName,startingbehavior=SurveyMdl.widgetObj.startingbehavior;if(docCookies.hasItem(cookieName)&&(cookie=docCookies.getItem(cookieName),void 0!==SurveyMdl.widgetObj.returningbehaviorclose&&"dismissed"==cookie&&(startingbehavior=SurveyMdl.widgetObj.returningbehaviorclose,!0),void 0!==SurveyMdl.widgetObj.returningbehaviorsubmit&&"answered"==cookie&&(startingbehavior=SurveyMdl.widgetObj.returningbehaviorsubmit,!0),void 0!==SurveyMdl.widgetObj.returningbehaviornointeraction&&"nointeraction"==cookie&&(startingbehavior=SurveyMdl.widgetObj.returningbehaviornointeraction,!0)),MetricalApp.logging.logInfo("computed startingbehavior in renderWidget: ",startingbehavior),void 0!==SurveyMdl.widgetObj.surveyid){for(MetricalApp.logging.logInfo("starting domain check"),domainCheck=!1,i=0;i<SurveyMdl.widgetObj.domains.length;i++){if(document.domain.toLowerCase()==SurveyMdl.widgetObj.domains[i].toLowerCase()){domainCheck=!0;break}if("*"==SurveyMdl.widgetObj.domains[i]){domainCheck=!0;break}if("*."==SurveyMdl.widgetObj.domains[i].substring(0,2)&&(realDomainSplited=document.domain.toLowerCase().split("."),definedDomainSplited=SurveyMdl.widgetObj.domains[i].toLowerCase().split("."),realDomainSplited.length==definedDomainSplited.length)){for(arrayEquals=!0,j=1;j<realDomainSplited.length;j++)realDomainSplited[j]!=definedDomainSplited[j]&&(arrayEquals=!1);if(arrayEquals){domainCheck=!0;break}}}MetricalApp.logging.logInfo("document domain",document.domain),MetricalApp.logging.logInfo("comparison domains",SurveyMdl.widgetObj.domains),1==domainCheck?MetricalApp.logging.logInfo("domain check PASSED"):MetricalApp.logging.logInfo("domain check FAILED"),startingbehaviorDisplayCheck=!0,startingbehavior==SurveyMdl.startingbehaviorNoDisplay&&(startingbehaviorDisplayCheck=!1),tabletCheck=!0,device=MetricalApp.determineIdentifier(),"tabletvertical"!=device&&"tablethorizontal"!=device||(SurveyMdl.widgetObj.visibleontablet?tabletCheck=!0:tabletCheck=!1),mobileCheck=!0,"mobile"==device&&(!SurveyMdl.widgetObj.visibleonmobile||null==SurveyMdl.widgetObj.getReturningBehavior()&&SurveyMdl.widgetObj.startingbehavior==StartingBehavior.noDisplayBehavior||SurveyMdl.widgetObj.getReturningBehavior()==StartingBehavior.noDisplayBehavior)&&(mobileCheck=!1),mobileCheck&&tabletCheck&&domainCheck&&startingbehaviorDisplayCheck?this.show():this.shouldDisplay=!1,Widget.checkActivateSubmit()}}"lightbox"===MetricalApp.properties.rendertype&&$(".lb-wrapper").each(function(){this.style.setProperty("box-shadow","none","important")})},show:function(){$(".Metrical").html(WidgetView.widgetMarkup(SurveyMdl.widgetObj)),Widget.setupLastElement(),SurveyMdl.widgetObj.offerimage||null==MetricalApp.timedQuestionDelay||(MetricalApp.logging.logInfo("Starting up the timed question timer"),MetricalApp.startupTimedQuestion());$(".Metrical form").outerHeight(),MetricalApp.determineIdentifier();$(".MetricalTab").html('<button id="MetricalTabButton" style="text-align:center">'+SurveyMdl.widgetObj.tabtext+"</button>"),null!=SurveyMdl.widgetObj.wiggleeffect&&(1==SurveyMdl.widgetObj.wiggleeffect.enableonstart&&0==isReturningBehavior||1==SurveyMdl.widgetObj.wiggleeffect.enableonreturn&&1==isReturningBehavior)&&WiggleTab(4e3,SurveyMdl.widgetObj.wiggleeffect.effect),SurveyMdl.widgetObj.returningbehaviornointeraction&&MetricalApp.setTransitionalCookie("nointeraction"),SurveyMdl.widgetObj.displayfeedbacktab?$(".MetricalTab").hasClass("hidden")&&$(".MetricalTab").removeClass("hidden"):$(".MetricalTab").addClass("hidden"),"undefined"!=typeof startingbehavior&&startingbehavior==SurveyMdl.startingbehaviorOpen?("lightbox"===MetricalApp.properties.rendertype&&$(".MetricalTab").addClass("hidden"),"slideout"===MetricalApp.properties.rendertype&&$(".MetricalContainer").addClass("metrical-widths"),"bottom-right"!=MetricalApp.properties.position&&"bottom-middle"!=MetricalApp.properties.position&&"bottom-left"!=MetricalApp.properties.position||$(".MetricalContainer").hasClass("widget-size-no-autoheight")||($(".MetricalContainer").height("auto"),$(".MetricalContainer").hasClass("is-popped")||$(".MetricalContainer").height("0")),setTimeout(function(){$(".MetricalTab").click()},100)):"bottom-right"!=MetricalApp.properties.position&&"bottom-middle"!=MetricalApp.properties.position&&"bottom-left"!=MetricalApp.properties.position?"lightbox"!=MetricalApp.properties.rendertype&&($(".MetricalContainer").css("width","0px"),$(document).on("setWidthAfterLoad",{},function(e){$(".MetricalContainer").css("width","0px"),MetricalApp.logging.logInfo("Setting the width of MetricalContainer to 0 after the widget is completely loaded")})):$(".MetricalContainer").addClass("metrical-widths")},submit:function(){$(document).on("click","input#metrical-confirm-button.metrical-button-enabled, input#metrical-timedquestion-button",function(e){e.stopImmediatePropagation(),e.preventDefault();try{if(_MetricalCoupon.couponDriver&&(_Metrical.ClientWidget.widgetObj.displaythankyou||($(".Metrical_lightbox").hide(),$(".MetricalContainer").hide())),Validator.form(void 0),SurveyAnswersMdl.postQuestionAnswer($(this).hasClass("mobile-submit-button"),"metrical-timedquestion-button"==e.target.id),void 0!==MetricalApp.properties.clicktrack&&""!=MetricalApp.properties.clicktrack)(new Image).src=MetricalApp.properties.clicktrack}catch(e){WidgetExceptions.exception(e.toString()),MetricalApp.logging.logError(e)}MetricalApp.setFocusToMetricalTabButton()}),$(document).on("click","input#metrical-confirm-button.metrical-button-disabled",function(e){e.preventDefault()})},checkToggleConditionalQuestions:function(){for(var e=0;e<SurveyAnswersMdl.qaToggleQuestions.length;e++){var t=SurveyAnswersMdl.qaToggleQuestions[e],i=!1;for(let e=0;e<t.answers.length;e++){const o=t.answers[e];var r=SurveyAnswersMdl.questionsAnswers[t.questionToCheck],n=o;if("object"==typeof o&&(r=SurveyAnswersMdl.questionsAnswers[t.questionToCheck+"-"+n.id],n=o.value),n==r){i=!0;break}}if(i)$("#question_"+t.questionToToggle).removeClass("metrical-hidden-question");else{$("#question_"+t.questionToToggle).find("input[type='checkbox']").each(function(e,t){$(t).prop("checked")&&$(t).click()}),$("#question_"+t.questionToToggle).find("input[type='radio']").each(function(e,t){$(t).prop("checked")&&$(t).prop("checked",!1)}),$("#question_"+t.questionToToggle).find(".metrical-question-customvalue").each(function(e,t){$(t).hide()});var o=t.questionToToggle;Object.keys(SurveyAnswersMdl.questionsAnswers).filter(function(e){return 0===e.indexOf(o)}).forEach(function(e){delete SurveyAnswersMdl.questionsAnswers[e]}),$("#question_"+t.questionToToggle).addClass("metrical-hidden-question")}}},checkActivateSubmit:function(){for(key in this.checkToggleConditionalQuestions(),passRequired=!0,0==SurveyAnswersMdl.hasAnswers()&&SurveyMdl.requiredList.length>0&&(passRequired=!1),$.each(SurveyMdl.requiredList,function(e,t){SurveyAnswersMdl.questionsAnswers[t]?$.each(SurveyMdl.widgetObj.questions,function(e,i){i.id==t&&void 0!==i.valuesarray&&(""==i.valuesarray[SurveyAnswersMdl.questionsAnswers[t]]?passRequired=!1:null!=i.customvaluesarray&&$.each(i.customvaluesarray,function(e,i){optionsWithRequiredCustomValues=SurveyMdl.customValuesRequiredList[i.customvalueid],optionsWithRequiredCustomValues instanceof Array&&optionsWithRequiredCustomValues.indexOf(parseInt(SurveyAnswersMdl.questionsAnswers[t]))>-1&&(null!=SurveyAnswersMdl.questionsAnswers[i.customvalueid]&&""!=SurveyAnswersMdl.questionsAnswers[i.customvalueid]||(passRequired=!1))}))}):passRequired=!1}),$.each(SurveyMdl.widgetObj.questions,function(e,t){t.customvaluesarray&&SurveyAnswersMdl.questionsAnswers[t.id]&&$.each(t.customvaluesarray,function(e,i){optionsWithRequiredCustomValues=SurveyMdl.customValuesRequiredList[i.customvalueid],optionsWithRequiredCustomValues instanceof Array&&optionsWithRequiredCustomValues.indexOf(SurveyAnswersMdl.questionsAnswers[t.id])>-1&&(SurveyAnswersMdl.questionsAnswers[i.customvalueid]||(passRequired=!1))})}),passValidator=!0,SurveyMdl.validatorList)value=SurveyMdl.validatorList[key],SurveyAnswersMdl.questionsAnswers[key]&&""!=SurveyAnswersMdl.questionsAnswers[key]&&(eval(value),"function"==typeof checkValidity&&(checkValidity(SurveyAnswersMdl.questionsAnswers[key])||(passValidator=!1)));return passRequired&&passValidator?this.activateSubmit():this.deactivateSubmit(),passValidator},fixFocusLightboxMobile:function(){setTimeout(function(){container=$(".Metrical_lightbox"),o=$(":focus").offset(),null!=o&&container.animate({scrollTop:o.top-container.offset().top+container.scrollTop()-100}),$(":focus").click()},.01)},oneClickSubmit:function(e){totalActiveQuestions=MetricalApp.properties.randomdisplaycount+MetricalApp.properties.nonrandomdisplaycount,null!=SurveyMdl.widgetObj.oneclicksubmit&&1==SurveyMdl.widgetObj.oneclicksubmit&&(1==totalActiveQuestions?setTimeout(function(){MetricalApp.logging.logInfo("oneclicksubmit enabled. There is only one question. Submitting the survey..."),e&&(e.parent("div").find("input").attr("disabled"),e.parent("div").append('<div class="overlay"><div class="loader"></div></div>')),$("#metrical-confirm-button").click()},400):MetricalApp.logging.logInfo("oneclicksubmit is enabled, but there are more than one question. The survey will not be submitted"))},questionEvent:function(){var e=this;$(document).on("click","a.star",function(t){t.preventDefault();var i=$(this).parents().children(".metrical-question-quid").val(),r=$(this).attr("value");$(this).parents().children("a.star").removeClass("active");for(var n=0;n<=r;n++)$(this).parents().children('a.star[value="'+n+'"]').addClass("active");SurveyAnswersMdl.questionsAnswers[i]=r,passValidator=e.checkActivateSubmit(),passValidator&&$("#metrical-confirm-button").is(":visible"),e.oneClickSubmit($(this))}),$(document).on("click","a.large-star",function(t){t.preventDefault();var i=$(this).parents().children(".metrical-question-quid").val(),r=$(this).attr("value");$(this).parents().children("a.large-star").removeClass("active");for(var n=0;n<=r;n++)$(this).parents().children('a.large-star[value="'+n+'"]').addClass("active");SurveyAnswersMdl.questionsAnswers[i]=r,passValidator=e.checkActivateSubmit(),passValidator&&$("#metrical-confirm-button").is(":visible"),e.oneClickSubmit($(this))}),$(document).on("click","a.medium-star",function(t){t.preventDefault();var i=$(this).parents().children(".metrical-question-quid").val(),r=$(this).attr("value");$(this).parents().children("a.medium-star").removeClass("active");for(var n=0;n<=r;n++)$(this).parents().children('a.medium-star[value="'+n+'"]').addClass("active");SurveyAnswersMdl.questionsAnswers[i]=r,passValidator=e.checkActivateSubmit(),passValidator&&$("#metrical-confirm-button").is(":visible"),e.oneClickSubmit($(this))}),$(document).on("click","a.small-star",function(t){t.preventDefault();var i=$(this).parents().children(".metrical-question-quid").val(),r=$(this).attr("value");$(this).parents().children("a.small-star").removeClass("active");for(var n=0;n<=r;n++)$(this).parents().children('a.small-star[value="'+n+'"]').addClass("active");SurveyAnswersMdl.questionsAnswers[i]=r,passValidator=e.checkActivateSubmit(),passValidator&&$("#metrical-confirm-button").is(":visible"),e.oneClickSubmit($(this))}),$(document).on("click","a.face",function(t){t.preventDefault();var i=$(this).parents().children(".metrical-question-quid").val(),r=$(this).attr("value");$(this).parents().children("a.face").removeClass("active"),$(this).parents().children('a.face[value="'+r+'"]').addClass("active"),SurveyAnswersMdl.questionsAnswers[i]=r,passValidator=e.checkActivateSubmit(),passValidator&&$("#metrical-confirm-button").is(":visible"),e.oneClickSubmit($(this))}),$(document).on("change","select.widget-select",function(t){t.preventDefault();var i=$(this).parents().children(".metrical-question-quid").val(),r=$(this).val();""!=r?SurveyAnswersMdl.questionsAnswers[i]=r:delete SurveyAnswersMdl.questionsAnswers[i],passValidator=e.checkActivateSubmit(),passValidator&&$("#metrical-confirm-button").is(":visible"),e.oneClickSubmit($(this))}),$(document).on("click","input[type=radio]",function(t){if($(this).hasClass("disable-click"))t.preventDefault();else{$(this).parents().children("label").removeClass("active-label");var i="#label-"+$(this).attr("id");$(this).hasClass("radio-buttons-input")||$(i).addClass("active-label");var r=$(this).parents().children(".metrical-question-quid").val(),n=$(this).attr("value");SurveyAnswersMdl.questionsAnswers[r]=n,passValidator=e.checkActivateSubmit(),passValidator&&$("#metrical-confirm-button").is(":visible")}e.oneClickSubmit($(this))}),$(document).on("mouseover","a.star",function(e){var t=$(this).attr("value");$(this).parents().children("a.star").removeClass("star-hover");for(var i=0;i<=t;i++)$(this).parents().children('a.star[value="'+i+'"]').addClass("star-hover")}),$(document).on("mouseout","a.star",function(e){$(this).parents().children("a.star").removeClass("star-hover")}),$(document).on("mouseover","a.large-star",function(e){var t=$(this).attr("value");$(this).parents().children("a.large-star").removeClass("star-hover");for(var i=0;i<=t;i++)$(this).parents().children('a.large-star[value="'+i+'"]').addClass("star-hover")}),$(document).on("mouseout","a.large-star",function(e){$(this).parents().children("a.large-star").removeClass("star-hover")}),$(document).on("mouseover","a.medium-star",function(e){var t=$(this).attr("value");$(this).parents().children("a.medium-star").removeClass("star-hover");for(var i=0;i<=t;i++)$(this).parents().children('a.medium-star[value="'+i+'"]').addClass("star-hover")}),$(document).on("mouseout","a.medium-star",function(e){$(this).parents().children("a.medium-star").removeClass("star-hover")}),$(document).on("mouseover","a.small-star",function(e){var t=$(this).attr("value");$(this).parents().children("a.small-star").removeClass("star-hover");for(var i=0;i<=t;i++)$(this).parents().children('a.small-star[value="'+i+'"]').addClass("star-hover")}),$(document).on("mouseout","a.small-star",function(e){$(this).parents().children("a.small-star").removeClass("star-hover")}),$(document).on("keyup",".metrical-question-answer",function(t){var i=$(this).parents().children(".metrical-question-quid").val(),r=$(this).val();if(!$(this).hasClass("resized")){var n=Widget.getMaxWidgetStretch($(".container-bottom").length>0),o=$(this).height();o+n>150?o=150:o+=n,$(this).height(o+"px");var a=-1;$.each(Widget.containerTextboxActivated,function(e,t){t==i&&(a=1)}),-1==a&&(Widget.containerTextboxActivated.push(i),$(".MetricalContainer").hasClass("widget-size-no-autoheight")||$(".MetricalContainer").height("auto"),Widget.tabBottomValue=parseInt(Widget.tabBottomValue),Widget.tabBottomValue=parseInt(Widget.tabBottomValue)+120,$(".container-bottom .MetricalTab").css("bottom",Widget.tabBottomValue+"px"),Widget.bottomValue<0?Widget.bottomValue=parseInt(Widget.bottomValue):Widget.bottomValue=parseInt(Widget.bottomValue)-120,$(".container-bottom ").css("bottom",Widget.bottomValue+"px")),$(".metrical-question-answer").addClass("resized")}""!=r?SurveyAnswersMdl.questionsAnswers[i]=r:delete SurveyAnswersMdl.questionsAnswers[i];passValidator=e.checkActivateSubmit(),passValidator&&$("#metrical-confirm-button").is(":visible")}),$(document).on("blur",".mqa-textbox",function(t){var i=$(this).parents().children(".metrical-question-quid").val(),r=$(this).val();""!=r?SurveyAnswersMdl.questionsAnswers[i]=r:delete SurveyAnswersMdl.questionsAnswers[i];(passValidator=e.checkActivateSubmit())?($(this).removeClass("field-error"),$(this).prev("span.error").hide(),$("#metrical-confirm-button").is(":visible")):($(this).addClass("field-error"),$(this).prev("span.error").show())}),$(document).on("click",".close-widget",function(e){"lightbox"==MetricalApp.properties.rendertype?($(".Metrical").data("closeBehavior",SurveyMdl.widgetObj.returningbehaviorclose),$(".MetricalTab").hasClass("hidden")&&$(".MetricalTab").removeClass("hidden"),Widget.isThankYouImageView()||$(".MetricalContainer").append($(".Metrical_lightbox_center .Metrical")[0]),$(".Metrical_lightbox_center .Metrical").replaceWith('<div class="Metrical_lightbox_content">'),$(".Metrical_lightbox").fadeOut("100"),$(".MetricalTab").fadeIn("100"),void 0!==e.originalEvent&&_MetricalInteractions.recordInteraction("dismissed"),MetricalApp.setTransitionalCookie("dismissed"),$("body").css("overflow-y",""),"mobile"==MetricalApp.determineIdentifier()&&$("html, body").removeClass("ios-fix")):($(".Metrical").data("closeBehavior",SurveyMdl.widgetObj.returningbehaviorclose),$(".MetricalTab").click(),_MetricalInteractions.recordInteraction("dismissed"),MetricalApp.setTransitionalCookie("dismissed")),SurveyMdl.widgetObj.hidetabafterclose&&$(".MetricalTab").hide(),MetricalApp.setFocusToMetricalTabButton()}),$(window).on("resize",function(e){Widget.setWidgetPosition()}),$(document).on("click","#metrical-confirm-button.metrical-button-enabled",function(t){e.buttonSubmited()}),$(document).on("click","#metrical-confirm-button.metrical-button-disabled",function(e){e.preventDefault()}),$(document).on("click",".mqa-checkbox",function(e){var t=$(this).parents().children(".metrical-question-quid").val(),i=$(".mqa-checkbox-default").val();1==$(this).prop("checked")?""!=i?$(this).val(i):$(this).val("1"):$(this).val("0"),SurveyAnswersMdl.questionsAnswers[t]=$(this).val(),Widget.checkActivateSubmit()}),$(document).on("click",".multi-checkbox",function(e){var t=$(this).parents().children(".metrical-question-quid").val(),i=$(e.currentTarget),r=t+"-"+i.val();i.prop("checked")?SurveyAnswersMdl.questionsAnswers[r]=1:SurveyAnswersMdl.questionsAnswers[r]=0,Widget.checkToggleConditionalQuestions()}),$(document).on("click",".multi-checkbox.exclusive-option",function(e){if(e.target.checked){var t=$("#"+e.target.id).parent().parent().find(".multi-checkbox");$.each(t,function(t,i){i.id!=e.target.id&&i.checked&&i.click()})}}),$(document).on("click",".multi-checkbox",function(e){if(e.target.checked){var t=$("#"+e.target.id).parent().parent().find(".multi-checkbox.exclusive-option");$.each(t,function(t,i){i.id!=e.target.id&&i.checked&&i.click()})}})},recordInteractionAsDisplayed:function(e){void 0!==e.originalEvent?_MetricalInteractions.recordInteraction("opened",null,!0,!1):_MetricalInteractions.recordInteraction("visible",null,!0,!1)},slider:function(){$(document).on("click",".MetricalTab",function(e){void 0!==e.originalEvent&&($(this).parent().hasClass("is-popped")||(CustomerEvents.userClickedTab=!0))}),$(document).on("click",".MetricalTab.elTab-left",function(e){$(".Metrical").data("closeTimeout")&&(clearTimeout($(".Metrical").data("closeTimeout")),$(".Metrical").data("closeTimeout",null));var t=$(this).parent(),i={width:"0px",maxWidth:o};if($(".Metrical").data("closeBehavior",null),"lightbox"==MetricalApp.properties.rendertype){var r=$(".Metrical");$(".MetricalTab").hide(),$(".Metrical_lightbox_content").replaceWith(r),$(".Metrical_lightbox").fadeIn("100"),$(".Metrical_lightbox").css("display","block"),$("body").css("overflow-y","hidden"),$(".close-widget").show(),$(".close-widget").css("display","block"),Widget.recordInteractionAsDisplayed(e),"mobile"==MetricalApp.determineIdentifier()&&($("html, body").addClass("ios-fix"),$("textarea").blur(function(e){Widget.fixFocusLightboxMobile()}))}else if($(this).parent().hasClass("is-popped")){var n="270px";t.css("width")&&(n=t.css("width"));var o="270px";t.css("maxWidth")&&(o=t.css("maxWidth")),$(".MetricalContainer").width(n),$(".MetricalContainer").css("maxWidth",o),$(this).parent().removeClass("metrical-widths"),$(this).parent().animate(i,{queue:!1,duration:500,complete:function(){$(".Metrical").data("closeBehavior",SurveyMdl.widgetObj.returningbehaviorclose),void 0!==e.originalEvent&&_MetricalInteractions.recordInteraction("dismissed"),$(this).removeClass("is-popped"),$(this).removeClass("metrical-widths")}}),MetricalApp.setTransitionalCookie("dismissed")}else MetricalApp.properties.overridesurveywidth?(n=MetricalApp.properties.overridesurveywidth.width,o=MetricalApp.properties.overridesurveywidth.maxWidth):(n="340px",o="340PX"),$(this).parent().animate({width:n,maxWidth:o},{queue:!1,duration:500,complete:function(){$(this).addClass("is-popped"),$(this).addClass("metrical-widths"),Widget.recordInteractionAsDisplayed(e)},start:function(){$(".MetricalTab").removeClass("MetricalTabWiggle")}})}),$(document).on("click",".MetricalTab.elTab-right",function(e){$(".Metrical").data("closeTimeout")&&(clearTimeout($(".Metrical").data("closeTimeout")),$(".Metrical").data("closeTimeout",null));var t=$(this).parent(),i={width:"0px",maxWidth:o};if($(".Metrical").data("closeBehavior",null),"lightbox"==MetricalApp.properties.rendertype){var r=$(".Metrical");$(".MetricalTab").hide(),$(".Metrical_lightbox_content").replaceWith(r),$(".Metrical_lightbox").fadeIn("100"),$(".Metrical_lightbox").css("display","block"),$("body").css("overflow-y","hidden"),$(".close-widget").show(),$(".close-widget").css("display","block"),Widget.recordInteractionAsDisplayed(e),void 0!==e.originalEvent&&(_Metrical.disableExitIntentCX=!0),"mobile"==MetricalApp.determineIdentifier()&&($("html, body").addClass("ios-fix"),$("textarea").blur(function(e){Widget.fixFocusLightboxMobile()}))}else if($(this).parent().hasClass("is-popped")){var n="270px";t.css("width")&&(n=t.css("width"));var o="270px";t.css("maxWidth")&&(o=t.css("maxWidth")),$(".MetricalContainer").width(n),$(".MetricalContainer").css("maxWidth",o),$(this).parent().removeClass("metrical-widths"),$(this).parent().animate(i,{queue:!1,duration:500,complete:function(){$(".Metrical").data("closeBehavior",SurveyMdl.widgetObj.returningbehaviorclose),void 0!==e.originalEvent&&_MetricalInteractions.recordInteraction("dismissed"),$(this).removeClass("is-popped"),$(this).removeClass("metrical-widths")}}),MetricalApp.setTransitionalCookie("dismissed")}else MetricalApp.properties.overridesurveywidth?(n=MetricalApp.properties.overridesurveywidth.width,o=MetricalApp.properties.overridesurveywidth.maxWidth):(n="340px",o="340PX"),$(this).parent().animate({width:n,maxWidth:o},{queue:!1,duration:500,complete:function(){$(this).addClass("is-popped"),$(this).addClass("metrical-widths"),Widget.recordInteractionAsDisplayed(e)},start:function(){$(".MetricalTab").removeClass("MetricalTabWiggle")}})}),$(document).on("click",".MetricalTab.elTab-top",function(e){$(".Metrical").data("closeTimeout")&&(clearTimeout($(".Metrical").data("closeTimeout")),$(".Metrical").data("closeTimeout",null));if($(".Metrical").data("closeBehavior",null),"lightbox"==MetricalApp.properties.rendertype){var t=$(".Metrical");$(".MetricalTab").hide(),$(".Metrical_lightbox_content").replaceWith(t),$(".Metrical_lightbox").fadeIn("100"),$(".Metrical_lightbox").css("display","block"),$("body").css("overflow-y","hidden"),$(".close-widget").show(),$(".close-widget").css("display","block"),Widget.recordInteractionAsDisplayed(e),"mobile"==MetricalApp.determineIdentifier()&&($("html, body").addClass("ios-fix"),$("textarea").blur(function(e){Widget.fixFocusLightboxMobile()}))}else if($(this).parent().hasClass("is-popped"))$(this).parent().animate({height:"80px"},{queue:!1,duration:500,complete:function(){$(".Metrical").data("closeBehavior",SurveyMdl.widgetObj.returningbehaviorclose),void 0!==e.originalEvent&&_MetricalInteractions.recordInteraction("dismissed"),$(this).removeClass("is-popped")}}),MetricalApp.setTransitionalCookie("dismissed");else{var i=$(".lb-wrapper").offset().top,r=$("#check-offset").offset().top-i+80;$(this).parent().animate({height:r+"px"},{queue:!1,duration:500,complete:function(){$(this).addClass("is-popped"),$(".MetricalContainer").hasClass("widget-size-no-autoheight")||$(".MetricalContainer").height("auto"),Widget.recordInteractionAsDisplayed(e)},start:function(){$(".MetricalTab").removeClass("MetricalTabWiggle")}})}}),$(document).on("mouseover","#metrical-confirm-button.metrical-button-disabled",function(e){$("#metrical-confirm-button.metrical-button-disabled").focus()}),$(document).on("click","#metrical-confirm-button.metrical-button-disabled",function(e){$("div.required").hide(),requiredElements=Validator.formValidation(),$.each(requiredElements,function(e,t){elId="#span-"+t+"-message",$(elId).show()})})},setupLastElement:function(){$(".MetricalContainer .field").last().addClass("last")},activateSubmit:function(){$(".MetricalContainer input[type=radio]").removeClass("disable-click"),$("#metrical-confirm-button").removeClass("metrical-button-disabled"),$("#metrical-confirm-button").addClass("metrical-button-enabled")},deactivateSubmit:function(){$("#metrical-confirm-button").removeClass("metrical-button-enabled"),$("#metrical-confirm-button").addClass("metrical-button-disabled")},buttonSubmited:function(){$(".MetricalContainer input[type=radio]").addClass("disable-click"),$("#metrical-confirm-button").removeClass("metrical-button-enabled"),$("#metrical-confirm-button").addClass("metrical-button-disabled"),$("#metrical-confirm-button").attr("disabled","disabled")},resetForm:function(){that=this,MetricalApp.properties.iframe||("lightbox"==MetricalApp.properties.rendertype?$(".close-widget").click():$(".MetricalTab").click(),Widget.containerTextboxActivated=new Array)},renderWidgedAfterReset:function(){void 0!==SurveyMdl.widgetObj.surveyid&&(MetricalApp.properties.iframe?($(".Metrical").html(WidgetView.widgetMarkup(SurveyMdl.widgetObj)),Widget.setupLastElement(),Widget.setWidgetPosition(),Widget.checkActivateSubmit()):(MetricalApp.el.html(WidgetView.widgetMarkup(SurveyMdl.widgetObj)),Widget.setupLastElement(),Widget.setWidgetPosition(),Widget.checkActivateSubmit()),that.tabBottomValue=that.defaultTabBottomValue,$(".container-bottom .MetricalTab").css("bottom",that.defaultTabBottomValue+"px"),$(".container-bottom ").css("bottom",Widget.defaultBottomValue+"px"),$(".MetricalContainer").hasClass("widget-size-no-autoheight")||$(".MetricalContainer").css("height","auto"),$(".MetricalContainer.bottom-container-right, .MetricalContainer.bottom-container-left, .MetricalContainer.bottom-container-middle ").css("height","80px"))},setWidgetPosition:function(){MetricalApp.logging.logInfo("setting widget position"),$(".Metrical_lightbox_center").removeClass("MetricalContainer");var e=window.innerHeight,t=$(".MetricalContainer").length?$(".MetricalContainer").position().top:null,i=$("#check-offset").length?$("#check-offset").position().top:null,r=!!$(".container-bottom").length;if("mobile"==MetricalApp.determineIdentifier())return $("div.MetricalContainer").hasClass("position-fixed")&&$(".MetricalContainer").css("height",window.innerHeight+"px"),$(".Metrical_lightbox_center").addClass("MetricalContainer"),$(".Metrical_lightbox_center").addClass("mobile"),1==MetricalApp.identifierIsIOS()&&$(".Metrical_lightbox_center").addClass("ios"),void $(".Metrical_lightbox_center").addClass("display-widget-page");i>e||r&&t<0?($("div.MetricalContainer").hasClass("position-fixed")&&($("div.MetricalContainer").removeClass("position-fixed"),$("div.MetricalContainer").addClass("position-absolute")),r&&t<0&&($("div.MetricalContainer").removeClass("container-bottom"),$("div.MetricalContainer").addClass("container-top"))):("fixed"===MetricalApp.properties.positiontype||"lightbox"===MetricalApp.properties.rendertype&&"fixed"===MetricalApp.properties.positiontype)&&($("div.MetricalContainer").hasClass("position-absolute")&&($("div.MetricalContainer").removeClass("position-absolute"),$("div.MetricalContainer").addClass("position-fixed")),MetricalApp.properties.position.indexOf("bottom")>-1&&$("div.MetricalContainer").hasClass("container-top")&&($("div.MetricalContainer").removeClass("container-top"),$("div.MetricalContainer").addClass("container-bottom"))),$(".Metrical_lightbox_center").addClass("MetricalContainer")},getMaxWidgetStretch:function(e){var t=window.innerHeight,i=$("#check-offset").offset(),r=$(".lb-wrapper .close-widget").offset();return null!=i&&(i=i.top),null!=r&&(r=r.top),r-10>0&&e?r-10:i<t-10?t-i-10:0},isThankYouImageView:function(){return res=!1,null!=SurveyMdl.widgetObj.offerimage&&SurveyMdl.widgetObj.offerimage&&null!=SurveyMdl.widgetObj.couponconfig&&null!=SurveyMdl.widgetObj.couponconfig.thankyouimageurl&&("desktop"==MetricalApp.determineIdentifier()&&null!=SurveyMdl.widgetObj.couponconfig.thankyouimageurl.desktop?res=!0:"desktop"!=MetricalApp.determineIdentifier()&&null!=SurveyMdl.widgetObj.couponconfig.thankyouimageurl.mobile&&(res=!0)),res},getThankYouImageCloseTimeout:function(){return res=3e3,null!=SurveyMdl.widgetObj.offerimage&&SurveyMdl.widgetObj.offerimage&&null!=SurveyMdl.widgetObj.couponconfig&&null!=SurveyMdl.widgetObj.couponconfig.thankyouclosetimeout&&(res=SurveyMdl.widgetObj.couponconfig.thankyouclosetimeout),res}},Validator={blacklist:[],widgetAllowed:function(e){return survey=void 0!==e.survey&&e.survey,!!survey&&(!!$.inArray(e.survey,this.blacklist)||void 0)},userdata:function(e){var t={name:"Client error",level:"Show Stopper",message:"",toString:function(){return this.name+": "+this.message}};if(e==={})throw t.message="Client data are missing",t;if(!e.survey)throw t.message="Error found. SurveyID is missing.",t;return!0},properties:function(e){var t={name:"Property error",level:"Show Stopper",message:"",toString:function(){return this.name+": "+this.message}};if(!e.staticendpointhost)throw t.message="Server URL not defined.",t;return!0},widget:function(e){var t={name:"Widget error",level:"Show Stopper",message:"",toString:function(){return this.name+": "+this.message}};if(!e.surveyid)throw t.message="Widget not found.",t;if(!e.offerimage&&!e.titletext)throw t.message="Widget title is missing.",t;if(!e.offerimage&&!e.buttontext&&!e.submitbuttontext)throw t.message="Widget buttontext or submitbuttontext is missing.",t;if(!e.offerimage&&!e.questions)throw t.message="Widget questions not exist.",t;return e.questions&&$.each(e.questions,function(e,t){Validator.question(t)}),!0},question:function(e){var t={name:"Question error",level:"Show Stopper",message:"",toString:function(){return this.name+": "+this.message}};if(!e.id)throw t.message="Question not found",t;if("scale"===!e.questiontype||"openended"===!e.questiontype||"customlist"===!e.questiontype||"customarray"===!e.questiontype)throw t.message="Wrong question type: "+e.questiontype,t;return!0},form:function(e){var t={name:"Form error",level:"Show Stopper",message:"",toString:function(){return this.name+": "+this.message}};return $.each(SurveyMdl.questionGuids,function(e,i){if("scale"===SurveyMdl.questionType[i]){var r=SurveyMdl.widgetObj.questions[e].numberofstars||defaultStarsForScale;if(SurveyAnswersMdl.questionsAnswers[i]<1||SurveyAnswersMdl.questionsAnswers[i]>r)throw t.message="Scaled question value must be between 1 and "+r,t}}),!0},formValidation:function(){var e=[],t={};$.each(SurveyMdl.questionGuids,function(i,r){valueNotEmpty=!0,$.each(SurveyMdl.widgetObj.questions,function(e,i){i.id==r&&void 0!==i.valuesarray&&(""==i.valuesarray[SurveyAnswersMdl.questionsAnswers[r]]?valueNotEmpty=!1:null!=i.customvaluesarray&&$.each(i.customvaluesarray,function(e,i){optionsWithRequiredCustomValues=SurveyMdl.customValuesRequiredList[i.customvalueid],optionsWithRequiredCustomValues instanceof Array&&optionsWithRequiredCustomValues.indexOf(parseInt(SurveyAnswersMdl.questionsAnswers[r]))>-1&&(null!=SurveyAnswersMdl.questionsAnswers[i.customvalueid]&&""!=SurveyAnswersMdl.questionsAnswers[i.customvalueid]||(valueNotEmpty=!1,t[r]=i.customvalueid))}))}),valueNotEmpty&&null!=SurveyAnswersMdl.questionsAnswers[r]&&e.push(r)});var i=[];return $.grep(SurveyMdl.requiredList,function(r){-1==$.inArray(r,e)&&(null!=t[r]?i.push(t[r]):i.push(r))}),$.each(SurveyMdl.customValuesRequiredList,function(r){-1==$.inArray(r,e)&&(null!=t[r]?i.push(t[r]):i.push(r))}),i}},Misc={urlParamsToJSON:function(e){for(var t=e.split("&"),i=0,r="{";i<t.length;i++){var n=t[i].split("=");i<t.length-1?r+='"'+n[0]+'":"'+n[1]+'",':r+='"'+n[0]+'":"'+n[1]+'"'}return r+="}"},urldecode:function(e){return decodeURIComponent(e.replace(/\+/g," "))},union_arrays:function(e,t){for(var i={},r=e.length-1;r>=0;--r)i[e[r]]=e[r];for(r=t.length-1;r>=0;--r)i[t[r]]=t[r];var n=[];for(var o in i)i.hasOwnProperty(o)&&n.push(i[o]);return n.sort()}},ClientWidget={surveyId:null,configLocation:null,json:null,surveyKeys:["surveyid","domains","esid","name","titletext","cancelbutton","cancelbuttontext","submitbutton","submitbuttontext","buttontext","thankyoumessages","tabtext","questions","footer","css","js","iframesubmitredirect","returningbehaviorclose","returningbehaviorclosetimeframe","returningbehaviorsubmit","returningbehaviorsubmittimeframe","wiggleeffect","isactive","numberofstars","widgetreloaded","sitedelaybeforedisplay","delaybeforedisplaythreshold","position","positiontype","rendertype","specificexperience","delaybeforeopeningclosedtab","filter","answercountisactive","revision","openafterxloads","leadboxerisactive","thankyouviewclass","oneclicksubmit","custominteractions","timeonsiteevent","returningbehaviornointeraction","returningbehaviornointeractiontimeout","hidesubmitbutton","couponconfig","offerimage","heartbeatisactive","exitintentisactive","supportie9","overridesurveywidth","gacaptureinteraction"],questionKeys:["id","questiontext","questiontype","leadertext","valueslist","valuesarray","customvaluesarray","scalestyle","isrequired","validationroutine","viewtype","validationerrormsg","defaultvalue","filter","answerquota","requiredmsg","viewtypecssclass","customhtmlbeforelabel","customhtmlafterlabel","customhtmlbeforecontrols","customhtmlaftercontrols","customhtmlbetweencontrols"],surveyData:{},widgetObj:{},init:function(e,t){this.surveyId=e,this.configLocation=t,this.json=this.configLocation+this.surveyId+".json",MetricalApp.logging.logInfo("SurveyID "+this.surveyId),MetricalApp.logging.logInfo("JSON location "+this.json)},getWidget:function(e){var t=this;this.widgetObj={isReturningBehavior:function(){return!(!this.isReturningBehaviorDismissed()&&!this.isReturningBehaviorAnswered())},isReturningBehaviorDismissed:function(){var e=!1,t=this.getTransitionalValue();return void 0!==SurveyMdl.widgetObj.returningbehaviorclose&&"dismissed"==t&&(e=!0),e},isReturningBehaviorAnswered:function(){var e=!1,t=this.getTransitionalValue();return void 0!==SurveyMdl.widgetObj.returningbehaviorsubmit&&"answered"==t&&(e=!0),e},isReturningBehaviorNoInteraction:function(){var e=!1,t=this.getTransitionalValue();return void 0!==SurveyMdl.widgetObj.returningbehaviornointeraction&&"nointeraction"==t&&(e=!0),e},getTransitionalValue:function(){var e=!1;return cookieName=MetricalApp.transitialCookeName,docCookies.hasItem(cookieName)&&(e=docCookies.getItem(cookieName)),e},getReturningBehavior:function(){var e=null;return this.isReturningBehaviorAnswered()&&(e=this.returningbehaviorsubmit),this.isReturningBehaviorDismissed()&&(e=this.returningbehaviorclose),this.isReturningBehaviorNoInteraction()&&(e=this.returningbehaviornointeraction),e}},MetricalApp.logging.logInfo("making call for JSON survey"),$.ajax({crossDomain:!0,url:this.json,dataType:"json",ContentType:"application/json;charset=utf-8",success:function(i){try{if(MetricalApp.logging.logInfo("successfully received JSON survey, here is raw data: ",i),t.surveyData=i,MetricalApp.logging.logInfo("setting up widget keys"),t.setupWidgetKeys(i),MetricalApp.logging.logInfo("setting up questions"),null!=i.questions&&t.setupQuestions(i),MetricalApp.setJS(),null!=i.questions&&MetricalApp.setSliderCSSJS(),null!=i.ipblacklist&&null!=i.ipblacklist.enabled&&1==i.ipblacklist.enabled&&t.widgetObj.startingbehavior!=StartingBehavior.noDisplayBehavior){MetricalApp.logging.logInfo("ipblacklist is enabled and executing"),t.widgetObj.ipblacklist_enabled=!0;var r=t.determineBlacklistMatchingKeys(i.ipblacklist.matchingkeys,MetricalApp.properties.usermeta);MetricalApp.logging.logInfo("blacklist object ",r),t.isBlacklisted(i.surveyid,r,i.ipblacklist.timeframe,function(i){0==i?(MetricalApp.logging.logInfo("request was not blacklisted, running callback"),e(t.widgetObj)):(MetricalApp.setTransitionalCookie("answered"),setTimeout(function(){"lightbox"==MetricalApp.properties.rendertype?$(".close-widget").click():$(".MetricalTab").click()},2e3))})}else MetricalApp.logging.logInfo("ipblacklist is not enabled and running the callback"),t.widgetObj.ipblacklist_enabled=!1,e(t.widgetObj)}catch(e){MetricalApp.logging.logError(e),WidgetExceptions.exception(e.toString())}},error:function(e,t,i){log(i+" : "+e.statusText)}})},getWidgetForReevaluation:function(e){this.widgetObj={},this.widgetObj={isReturningBehavior:function(){return!(!this.isReturningBehaviorDismissed()&&!this.isReturningBehaviorAnswered())},isReturningBehaviorDismissed:function(){var e=!1,t=this.getTransitionalValue();return void 0!==SurveyMdl.widgetObj.returningbehaviorclose&&"dismissed"==t&&(e=!0),e},isReturningBehaviorAnswered:function(){var e=!1,t=this.getTransitionalValue();return void 0!==SurveyMdl.widgetObj.returningbehaviorsubmit&&"answered"==t&&(e=!0),e},isReturningBehaviorNoInteraction:function(){var e=!1,t=this.getTransitionalValue();return void 0!==SurveyMdl.widgetObj.returningbehaviornointeraction&&"nointeraction"==t&&(e=!0),e},getTransitionalValue:function(){var e=!1;return cookieName=MetricalApp.transitialCookeName,docCookies.hasItem(cookieName)&&(e=docCookies.getItem(cookieName)),e},getReturningBehavior:function(){var e=null;return this.isReturningBehaviorAnswered()&&(e=this.returningbehaviorsubmit),this.isReturningBehaviorDismissed()&&(e=this.returningbehaviorclose),this.isReturningBehaviorNoInteraction()&&(e=this.returningbehaviornointeraction),e}};try{MetricalApp.logging.logInfo("re-setting widget keys"),this.setupWidgetKeys(this.surveyData),MetricalApp.logging.logInfo("reevaluating questions"),null!=this.widgetObj.questions&&this.setupQuestions(this.widgetObj),MetricalApp.setJS(),null!=this.widgetObj.questions&&MetricalApp.setSliderCSSJS(),e(this.widgetObj)}catch(e){MetricalApp.logging.logError(e),WidgetExceptions.exception(e.toString())}},determineBlacklistMatchingKeys:function(e,t){for(var i={},r=0;r<e.length;r++){var n=e[r];null!=t[n]&&(i[n]=t[n])}return i},isBlacklisted:function(e,t,i,r){var n=[];n.push("surveyid="+encodeURI(e)),n.push("timeframe="+encodeURI(i)),n.push("data="+encodeURI(JSON.stringify(t)));var o=n.join("&"),a=MetricalApp.properties.apiendpointhost+"/index.php/blacklist/check?"+o;MetricalApp.logging.logInfo("calling blacklist url "+a),$.ajax({crossDomain:!0,url:a,dataType:"json",ContentType:"application/json;charset=utf-8",success:function(e){try{MetricalApp.logging.logInfo("successful response to blacklist check ",e),"function"==typeof r&&r(e.isblacklisted)}catch(e){MetricalApp.logging.logError(e),WidgetExceptions.exception(e.toString())}}})},setupWidgetKeys:function(e){for(MetricalApp.logging.logInfo("trying to process specific experiences"),this.processSpecificExperience(e),i=0;i<this.surveyKeys.length;i++){var t=this.surveyKeys[i];this.widgetObj[t]=e[t],MetricalApp.logging.logInfo("adding key "+t+" to this.widgetObj")}null==this.widgetObj.answercountisactive&&(this.widgetObj.answercountisactive=!1),null==this.widgetObj.leadboxerisactive&&(this.widgetObj.leadboxerisactive=!1),MetricalApp.logging.logInfo("this.widgetObj after processing keys ",this.widgetObj),this.widgetObj.visibleonmobile=!0,null!=e.visibleonmobile&&(e.visibleonmobile?this.widgetObj.visibleonmobile=!0:this.widgetObj.visibleonmobile=!1),MetricalApp.logging.logInfo("visibleonmobile value ",this.widgetObj.visibleonmobile),e.avoidviewportformobile?this.widgetObj.avoidviewportformobile=!0:this.widgetObj.avoidviewportformobile=!1,MetricalApp.logging.logInfo("avoidviewportformobile value ",this.widgetObj.avoidviewportformobile),null!=e.displayfeedbacktab?this.widgetObj.displayfeedbacktab=e.displayfeedbacktab:this.widgetObj.displayfeedbacktab=!0,MetricalApp.logging.logInfo("displayfeedbacktab value ",this.widgetObj.displayfeedbacktab),this.widgetObj.visibleontablet=!0,null!=e.visibleontablet&&(e.visibleontablet?this.widgetObj.visibleontablet=!0:this.widgetObj.visibleontablet=!1),MetricalApp.logging.logInfo("visibleontablet value ",this.widgetObj.visibleontablet),this.widgetObj["startingbehavior-nodisplay"]="",this.widgetObj["startingbehavior-closedonstart"]="",this.widgetObj["startingbehavior-openedonstart"]="",e.startingbehavior?(MetricalApp.logging.logInfo("determining starting behavior"),this.widgetObj.startingbehavior=StartingBehavior.getStartingBehavior(e.startingbehavior),MetricalApp.logging.logInfo("calculated starting behavior ",this.widgetObj.startingbehavior),void 0!==e.startingbehavior.closed_on_start&&(this.widgetObj["startingbehavior-closedonstart"]=e.startingbehavior.closed_on_start),void 0!==e.startingbehavior.opened_on_start&&(this.widgetObj["startingbehavior-openedonstart"]=e.startingbehavior.opened_on_start),void 0!==e.startingbehavior.nodisplay&&(this.widgetObj["startingbehavior-nodisplay"]=e.startingbehavior.nodisplay)):(MetricalApp.logging.logInfo("using default starting behavior"),this.widgetObj.startingbehavior=StartingBehavior.defaultStartingBehavior),e.position&&(MetricalApp.properties.position=e.position,MetricalApp.logging.logInfo("setting position from JSON survey ",MetricalApp.properties.position)),e.positiontype&&(MetricalApp.properties.positiontype=e.positiontype,MetricalApp.logging.logInfo("setting positiontype from JSON survey ",MetricalApp.properties.positiontype)),e.rendertype&&(MetricalApp.properties.rendertype=e.rendertype,MetricalApp.logging.logInfo("setting rendertype from JSON survey ",MetricalApp.properties.rendertype)),e.supportie9&&(MetricalApp.properties.supportie9=e.supportie9,MetricalApp.logging.logInfo("setting supportie9 from JSON survey ",MetricalApp.properties.supportie9)),e.gacaptureinteraction&&(MetricalApp.properties.gacaptureinteraction=e.gacaptureinteraction,MetricalApp.logging.logInfo("setting gacaptureinteraction from JSON survey ",MetricalApp.properties.gacaptureinteraction)),e.overridesurveywidth&&(MetricalApp.properties.overridesurveywidth=e.overridesurveywidth,MetricalApp.logging.logInfo("setting overridesurveywidth from JSON survey ",MetricalApp.properties.overridesurveywidth)),null==MetricalApp.properties.rendertype&&("desktop"!=MetricalApp.determineIdentifier()?MetricalApp.properties.rendertype="lightbox":MetricalApp.properties.rendertype="slideout",MetricalApp.logging.logInfo("setting the default value for rendertype",MetricalApp.properties.rendertype)),null!=e.questions&&$.each(e.questions,function(e,t){if("timedquestion"==t.questiontype)return MetricalApp.properties.rendertype="lightbox",MetricalApp.timedQuestionDelay=t.timetoclose,null!=t.buttonaction&&(MetricalApp.timedQuestionButtonAction=t.buttonaction),MetricalApp.logging.logInfo("For timedquestion questions only the lightbox rendertype is admitted. Setting the value for rendertype ",MetricalApp.properties.rendertype),!1}),1==e.offerimage&&(MetricalApp.properties.rendertype="lightbox"),null!=e.captureinteractions?this.widgetObj.captureinteractions=e.captureinteractions:this.widgetObj.captureinteractions=!1,MetricalApp.logging.logInfo("captureinteractions value ",this.widgetObj.captureinteractions),null!=e.captureallinteractions?this.widgetObj.captureallinteractions=e.captureallinteractions:this.widgetObj.captureallinteractions=!1,MetricalApp.logging.logInfo("captureallinteractions value ",this.widgetObj.captureallinteractions),null!=e.capturescrollinteractions?this.widgetObj.capturescrollinteractions=e.capturescrollinteractions:this.widgetObj.capturescrollinteractions=!1,MetricalApp.logging.logInfo("capturescrollinteractions value ",this.widgetObj.capturescrollinteractions),null!=e.norecordonsubmitifempty?this.widgetObj.norecordonsubmitifempty=e.norecordonsubmitifempty:this.widgetObj.norecordonsubmitifempty=!1,MetricalApp.logging.logInfo("norecordonsubmitifempty value ",this.widgetObj.norecordonsubmitifempty),null!=e.custominteractions&&(this.widgetObj.custominteractions=e.custominteractions),null!=e.displaythankyou?this.widgetObj.displaythankyou=e.displaythankyou:this.widgetObj.displaythankyou=!1,null!=e.hidetabaftersubmit?this.widgetObj.hidetabaftersubmit=e.hidetabaftersubmit:this.widgetObj.hidetabaftersubmit=!1,null!=e.hidetabafterclose?this.widgetObj.hidetabafterclose=e.hidetabafterclose:this.widgetObj.hidetabafterclose=!1,e.defaultstylesheet&&(MetricalApp.properties.defaultstylesheet=e.defaultstylesheet,MetricalApp.logging.logInfo("setting defaultstylesheet from JSON survey ",MetricalApp.properties.defaultstylesheet)),e.email&&(MetricalApp.properties.emailisactivestatus=e.email.isactive,MetricalApp.logging.logInfo("setting emailisactivestatus from JSON survey ",MetricalApp.properties.emailisactivestatus)),null!=e.postanswerisactive?this.widgetObj.postanswerisactive=e.postanswerisactive:this.widgetObj.postanswerisactive=!0,this.widgetObj.heartbeatisactive=e.heartbeatisactive||!1,MetricalApp.logging.logInfo("hidetabaftersubmit value ",this.widgetObj.hidetabaftersubmit),MetricalApp.logging.logInfo("hidetabafterclose value ",this.widgetObj.hidetabafterclose),MetricalApp.logging.logInfo("displaythankyou value ",this.widgetObj.displaythankyou),MetricalApp.logging.logInfo("getReturningBehavior ",this.widgetObj.getReturningBehavior()),MetricalApp.logging.logInfo("getTransitionalValue ",this.widgetObj.getTransitionalValue()),MetricalApp.logging.logInfo("isReturningBehavior ",this.widgetObj.isReturningBehavior()),MetricalApp.logging.logInfo("isReturningBehaviorAnswered ",this.widgetObj.isReturningBehaviorAnswered()),MetricalApp.logging.logInfo("isReturningBehaviorDismissed ",this.widgetObj.isReturningBehaviorDismissed())},processSpecificExperience:function(surveyObj){var that=this;null!=surveyObj.specificexperience&&"[object Array]"===Object.prototype.toString.call(surveyObj.specificexperience)&&(MetricalApp.logging.logInfo("specificexperience config detected ",surveyObj.specificexperience),$.each(surveyObj.specificexperience,function(key,value){if(null!=value.filter){MetricalApp.logging.logInfo("evaluating the filter "+value.filter);var result=eval(value.filter);if(MetricalApp.logging.logInfo("the filter result is "+result),result)return MetricalApp.logging.logInfo("applying replacements now"),null!=value.replacements&&(MetricalApp.logging.logInfo("processing the replacements",value.replacements),$.each(value.replacements,function(e,t){"questions"==e?(MetricalApp.logging.logInfo("replacing values on these questions",t),that.replaceQuestionsValues(surveyObj,t)):(MetricalApp.logging.logInfo("replacing the value for the key "+e+" with this one: "+t),surveyObj[e]=t)})),!1}}))},replaceQuestionsValues:function(e,t){var i=this;$.each(t,function(t,r){var n=i.getQuestionById(e,r.id);null!=n&&$.each(r,function(e,t){n[e]=t})})},getQuestionById:function(e,t){var i;return $.each(e.questions,function(e,r){if(t==r.id)return i=r,!1}),i},setupQuestions:function(survey){var shuffle=function(e){for(var t,i,r=e.length;0!==r;)i=Math.floor(Math.random()*r),t=e[r-=1],e[r]=e[i],e[i]=t;return e},randomDisplayCount=survey.randomdisplaycount,questions=survey.questions,randomQuestionIds=[];questions.sort(function(e,t){return parseInt(e.order)-parseInt(t.order)});var idLookup={};MetricalApp.properties.nonrandomdisplaycount=0,MetricalApp.properties.randomdisplaycount=0;for(var newQuestions=[],i=0;i<questions.length;i++){var question=questions[i];if(1==question.isactive){var filterResult=!0;if(null!=question.filter&&(filterResult=eval(question.filter),MetricalApp.logging.logInfo("filter result for question "+question.id,filterResult)),1==filterResult)MetricalApp.logging.logInfo("question in loop: ",question),0==question.israndom?(newQuestions.push(question),MetricalApp.logging.logInfo("adding non-random question to newQuestions ",question),"statictext"!=question.questiontype&&MetricalApp.properties.nonrandomdisplaycount++):(randomQuestionIds.push(question.id),MetricalApp.logging.logInfo("adding random question to randomQuestionId array",question));else{var filterText=null!=question.filter?question.filter:"empty";MetricalApp.logging.logInfo("skipping question because it failed the filter "+filterText,question)}question.customhtmlbeforelabel=question.customhtmlbeforelabel||void 0,question.customhtmlafterlabel=question.customhtmlafterlabel||void 0,question.customhtmlbeforecontrols=question.customhtmlbeforecontrols||void 0,question.customhtmlaftercontrols=question.customhtmlaftercontrols||void 0,question.customhtmlbetweencontrols=question.customhtmlbetweencontrols||void 0}else MetricalApp.logging.logInfo("question is not active",question);idLookup[question.id]=i}randomQuestionIds.length<randomDisplayCount&&(randomDisplayCount=randomQuestionIds.length),MetricalApp.logging.logInfo("randomDisplayCount value ",randomDisplayCount);var selectedRandomQuestionIds=shuffle(randomQuestionIds).slice(0,randomDisplayCount);MetricalApp.logging.logInfo("randomly selected question ids ",selectedRandomQuestionIds),MetricalApp.properties.randomdisplaycount=selectedRandomQuestionIds.length;for(var i=0;i<selectedRandomQuestionIds.length;i++){var randomQuestionId=selectedRandomQuestionIds[i];MetricalApp.logging.logInfo("random question ID value: ",randomQuestionId);var questionIndex=idLookup[randomQuestionId];MetricalApp.logging.logInfo("random question index value: ",questionIndex);var question=questions[questionIndex];newQuestions.push(question),MetricalApp.logging.logInfo("adding random question to tempQuestions ",question)}questions=newQuestions,questions.sort(function(e,t){return parseInt(e.order)-parseInt(t.order)}),this.widgetObj.questions=questions,MetricalApp.logging.logInfo("questions ",questions)}};rootMetricalObj.ClientWidget=ClientWidget;var StartingBehavior={openBehavior:"opened_on_start",closeBehavior:"closed_on_start",noDisplayBehavior:"nodisplay",defaultStartingBehavior:"nodisplay",getStartingBehavior:function(e){if("object"==typeof e){var t=[],i=[];for(var r in e)t.push(e[r]),i.push(r);return MetricalApp.logging.logInfo("starting behavior weights ",t),MetricalApp.logging.logInfo("starting behavior keys ",i),this.getRandomItem(i,t)}return this.defaultStartingBehavior},getRandomItem:function(e,t){for(var i,r,n=t.reduce(function(e,t,i,r){return e+t}),o=(i=0,r=n,Math.random()*(r-i)+i),a=0,s=0;s<e.length;s++)if(o<=(a=+(a+=t[s]).toFixed(4)))return e[s]}};rootMetricalObj.StartingBehavior=StartingBehavior;var SurveyMdl={questionGuids:[],questionType:[],requiredList:[],customValuesRequiredList:{},validatorList:[],defaultValuesList:[],widgetObj:{},startingbehaviorOpen:"opened_on_start",startingbehaviorNoDisplay:"nodisplay",surveyData:null,setWidget:function(e){void 0===e.thankyoumessages&&(e.thankyoumessages="Thank you for your feedback."),void 0===e.thankyouviewclass&&(e.thankyouviewclass="default"),this.widgetObj=e,null!=MetricalApp.properties.iframesubmitredirect&&""!=MetricalApp.properties.iframesubmitredirect&&(this.widgetObj.iframesubmitredirect=MetricalApp.properties.iframesubmitredirect)},setCSS:function(e){MetricalApp.logging.logInfo("Loading additional CSS",e.css);var t=[];(MetricalApp.properties.defaultstylesheet?(MetricalApp.logging.logInfo("Loading the default stylesheet",MetricalApp.properties.staticendpointhost+MetricalApp.properties.defaultstylesheet),t.push(MetricalApp.properties.staticendpointhost+MetricalApp.properties.defaultstylesheet)):MetricalApp.logging.logInfo("Skipping the default stylesheet"),void 0!==e.css)&&(Array.isArray(e.css)?e.css:[e.css]).forEach(function(e){t.push(e)});var i=t.map(function(e){return MetricalApp.loadAsset("link",e)});return Promise.all(i)},init:function(e){this.getSurvey(e)},reinit:function(render_callback){var that=this;MetricalApp.logging.logInfo("running getSurvey in SurveyMdl while reinit"),ClientWidget.getWidgetForReevaluation(function(data){if(MetricalApp.logging.logInfo("running ClientWidget.getWidget() callback",data),void 0===data.isactive||null===data.isactive||1==data.isactive){MetricalApp.logging.logInfo("isactive is true, continuing execution",data);var filterResult=!0,filterText=void 0!==data.filter?data.filter:"empty";void 0!==data.filter&&(filterResult=eval(data.filter),MetricalApp.logging.logInfo("checking survey filter "+filterText,data)),1==filterResult?(Validator.widget(data),that.setWidget(data),that.setParams(),render_callback()):MetricalApp.logging.logInfo("survey filter "+filterText+" did not match, stopping execution",data)}else MetricalApp.logging.logInfo("isactive is false, stopping execution",data);if(0==data.isactive&&0==data.succeed)var closeTimeout=setTimeout(function(){$(".Metrical").data("closeBehavior",SurveyMdl.widgetObj.returningbehaviorsubmit),"lightbox"==MetricalApp.properties.rendertype?$(".close-widget").click():$(".MetricalTab").click()},2e3)})},getSurvey:function(render_callback){var that=this;MetricalApp.logging.logInfo("running getSurvey in SurveyMdl"),uuid=docCookies.hasItem("_MetricalObject_did")?docCookies.getItem("_MetricalObject_did"):"",usermeta=encodeURIComponent(JSON.stringify(MetricalApp.properties.usermeta));var configLocation=null;configLocation=null!=MetricalApp.properties.configendpoint?url_protocol()+MetricalApp.properties.configendpoint:MetricalApp.properties.staticendpointhost+"/survey_files/",ClientWidget.init(Metrical_options.survey,configLocation),ClientWidget.getWidget(function(data){if(MetricalApp.logging.logInfo("running ClientWidget.getWidget() callback",data),void 0===data.isactive||null===data.isactive||1==data.isactive){MetricalApp.logging.logInfo("isactive is true, continuing execution",data);var filterResult=!0,filterText=void 0!==data.filter?data.filter:"empty";void 0!==data.filter&&(filterResult=eval(data.filter),MetricalApp.logging.logInfo("checking survey filter "+filterText,data)),1==filterResult?(Validator.widget(data),that.setWidget(data),that.setParams(),that.setCSS(data).then(function(e){render_callback()}).catch(function(e){throw e})):MetricalApp.logging.logInfo("survey filter "+filterText+" did not match, stopping execution",data)}else MetricalApp.logging.logInfo("isactive is false, stopping execution",data);if(0==data.isactive&&0==data.succeed)var closeTimeout=setTimeout(function(){$(".Metrical").data("closeBehavior",SurveyMdl.widgetObj.returningbehaviorsubmit),"lightbox"==MetricalApp.properties.rendertype?$(".close-widget").click():$(".MetricalTab").click()},2e3)})},setParams:function(){for(var e in properties=[],MetricalApp.properties.usermeta)properties[e]=MetricalApp.properties.usermeta[e];this.widgetObj.questions&&$.each(this.widgetObj.questions,function(e,t){SurveyMdl.questionGuids.push(t.id),SurveyMdl.questionType[t.id]=t.questiontype,t.isrequired&&SurveyMdl.requiredList.push(t.id),t.validationroutine&&(SurveyMdl.validatorList[t.id]=t.validationroutine),t.defaultvalue&&(SurveyMdl.defaultValuesList[t.id]=t.defaultvalue),properties[t.id]&&(SurveyMdl.defaultValuesList[t.id]=properties[t.id]),t.customvaluesarray&&$.each(t.customvaluesarray,function(e,t){SurveyMdl.questionGuids.push(t.customvalueid),t.isrequired&&(SurveyMdl.customValuesRequiredList[t.customvalueid]=t.optionswithcustomvalue),t.validationroutine&&(SurveyMdl.validatorList[t.customvalueid]=t.validationroutine)})})},getQuestionType:function(e){var t=void 0;return $.each(this.widgetObj.questions,function(i,r){r.id==e&&(t=r.questiontype)}),t}};rootMetricalObj.isVisibleOnStart=function(){return null!=SurveyMdl.widgetObj.startingbehavior&&SurveyMdl.widgetObj.startingbehavior==StartingBehavior.openBehavior};var SurveyAnswersMdl={questionsAnswers:[],qaToggleQuestions:[],hasAnswers:function(){var e=!1;return $.each(SurveyMdl.questionGuids,function(t,i){void 0!==SurveyAnswersMdl.questionsAnswers[i]&&(e=!0)}),e},getMultiCheckboxGuids:function(e){for(var t=[],i=Object.keys(this.questionsAnswers),r=0;r<i.length;r++){var n=i[r];-1!==n.indexOf(e)&&t.push(n)}return t},postQuestionAnswer:function(e,t){var i=this;time=$.now();var r=new Object;r.survey_guid=Metrical_options.survey,r.esid=SurveyMdl.widgetObj.esid,r.timestamp=time,r.referrer_ip="ip",r.cors=$.support.cors?1:0;var n=[];$.each(SurveyMdl.questionGuids,function(e,t){if("multicheckbox"==SurveyMdl.getQuestionType(t)){var r=i.getMultiCheckboxGuids(t);$.each(r,function(e,t){n.push({question_guid:t,value:SurveyAnswersMdl.questionsAnswers[t]})})}else null!=SurveyAnswersMdl.questionsAnswers[t]&&n.push({question_guid:t,value:SurveyAnswersMdl.questionsAnswers[t]})}),0==n.length&&0==SurveyMdl.requiredList.length&&null!=SurveyMdl.questionGuids[0]&&(first_guid=SurveyMdl.questionGuids[0],n.push({question_guid:first_guid,value:""})),r.score=n,$device=MetricalApp.determineIdentifier(),"desktop"==$device?$deviceObj={desktopsubmit:!0}:"tabletvertical"==$device||"tablethorizontal"==$device?$deviceObj={tabletsubmit:!0}:"mobile"==$device&&($deviceObj={mobilesubmit:!0}),r.usermeta=this.properties=$.extend({},Metrical_options.usermeta,$deviceObj),i.setCookie(),r.usermeta.cookies=MetricalApp.getCookies(),void 0!==MetricalApp.properties.customersite?r.usermeta.url=MetricalApp.properties.customersite:r.usermeta.url=document.URL,r.opening_state=SurveyMdl.widgetObj.startingbehavior,ClientWidget.widgetObj.isReturningBehaviorAnswered()?r.opening_state=SurveyMdl.widgetObj.returningbehaviorsubmit:ClientWidget.widgetObj.isReturningBehaviorDismissed()?r.opening_state=SurveyMdl.widgetObj.returningbehaviorclose:ClientWidget.widgetObj.isReturningBehaviorNoInteraction()&&(r.opening_state=SurveyMdl.widgetObj.returningbehaviornointeraction),r.events=CustomerEvents,r.survey_revision=SurveyMdl.widgetObj.revision,r.instance_id=MetricalApp.instanceId,sessionid=docCookies.hasItem("_MetricalObject_sessionid")?docCookies.getItem("_MetricalObject_sessionid"):"",r.session_id=sessionid,containerHeight=$("div.lb-wrapper div#form-container").height(),MetricalApp.logging.logInfo("posting answer submission",r);var o=!0;if(1==SurveyMdl.widgetObj.norecordonsubmitifempty){var a=SurveyMdl.questionGuids;$.each(a,function(e,t){"statictext"==SurveyMdl.getQuestionType(t)&&a.splice(e,1)});for(var s=!1,l=0;l<n.length;l++){var c=n[l];if(a.indexOf(c.question_guid)>-1){s=!0;break}}0==s&&(o=!1)}i=this;if(0==o){var u=ThankYouView;null!=SurveyMdl.widgetObj.thankyouviewclass&&"default"!=SurveyMdl.widgetObj.thankyouviewclass&&"altthankyou"!=SurveyMdl.widgetObj.thankyouviewclass&&(u=window[SurveyMdl.widgetObj.thankyouviewclass]),AnswersDictionary.init(SurveyMdl.widgetObj.questions,SurveyAnswersMdl.questionsAnswers),SurveyMdl.widgetObj.displaythankyou?MetricalApp.properties.iframe?($("div.lb-wrapper div#form-container").height(containerHeight),$(".Metrical form").replaceWith(u.thankYouMarkup(AnswersDictionary))):($("div.lb-wrapper div#form-container").height(containerHeight),MetricalApp.el.find("form").replaceWith(u.thankYouMarkup(AnswersDictionary))):MetricalApp.logging.logInfo("displaythankyou property is false, so the ThankYou page will not be displayed"),SurveyAnswersMdl.questionsAnswers=[],SurveyMdl.questionGuids=[]}else _MetricalInteractions.recordInteraction("answered"),SurveyMdl.widgetObj.postanswerisactive?$.ajax({type:"POST",dataType:"json",data:r,traditional:!1,url:MetricalApp.properties.surveyanswerendpoint,success:function(e){MetricalApp.logging.logInfo("posting succeeded",e),i.doAfterPostActions(t)},error:function(e,t,i){SurveyMdl.getSurvey(function(){Widget.init(MetricalApp.el,SurveyMdl.widgetObj,!0)}),log(i+" : "+e.statusText)}}):i.doAfterPostActions(r,t)},doAfterPostActions:function(dataQA,timedQuestion){"lightbox"==MetricalApp.properties.rendertype&&$(".MetricalTab").hasClass("hidden")&&$(".MetricalTab").removeClass("hidden"),SurveyMdl.widgetObj.hidetabaftersubmit&&setInterval(function(){$(".MetricalTab").hide()},2e3),"function"==typeof MetricalApp.properties.postCallback&&(MetricalApp.logging.logInfo("executing post callback"),MetricalApp.properties.postCallback(dataQA));var thankYouViewClass=ThankYouView;null!=SurveyMdl.widgetObj.thankyouviewclass&&"default"!=SurveyMdl.widgetObj.thankyouviewclass&&"altthankyou"!=SurveyMdl.widgetObj.thankyouviewclass&&(thankYouViewClass=window[SurveyMdl.widgetObj.thankyouviewclass]),AnswersDictionary.init(SurveyMdl.widgetObj.questions,SurveyAnswersMdl.questionsAnswers),SurveyMdl.widgetObj.displaythankyou?MetricalApp.properties.iframe?($("div.lb-wrapper div#form-container").height(containerHeight),$(".Metrical form").replaceWith(thankYouViewClass.thankYouMarkup(AnswersDictionary))):($("div.lb-wrapper div#form-container").height(containerHeight),MetricalApp.el.find("form").replaceWith(thankYouViewClass.thankYouMarkup(AnswersDictionary))):MetricalApp.logging.logInfo("displaythankyou property is false, so the ThankYou page will not be displayed"),SurveyAnswersMdl.questionsAnswers=[],SurveyMdl.questionGuids=[],$(".MetricalContainer").hasClass("widget-size-no-autoheight")||$(".MetricalContainer").css("height","auto"),$(".container-bottom .MetricalTab").css("bottom",Widget.defaultTabBottomValue+"px"),$(".container-bottom ").css("bottom",Widget.defaultBottomValue+"px"),MetricalApp.properties.iframe&&null!=SurveyMdl.widgetObj.iframesubmitredirect&&""!=SurveyMdl.widgetObj.iframesubmitredirect&&(window.location.href=SurveyMdl.widgetObj.iframesubmitredirect),void 0!==SurveyMdl.widgetObj.widgetreloaded&&1!=SurveyMdl.widgetObj.widgetreloaded||(SurveyMdl.widgetObj={},SurveyMdl.getSurvey(function(){Widget.init(MetricalApp.el,SurveyMdl.widgetObj,!0)})),timedQuestion&&(null!=MetricalApp.timedQuestionButtonAction&&eval(MetricalApp.timedQuestionButtonAction),clearInterval(MetricalApp.tabCloserTimer),setTimeout(function(){jQuery(".MetricalContainer").hide()},2e3))},setCookie:function(){var e=this,t=MetricalApp.cookieName[0],i=[],r=[];if(docCookies.hasItem(t)){var n=docCookies.getItem(t);if(n){var o=n.split("; ");$.each(o,function(e,t){var n=t.split("=");r.push(n[0]),i[n[0]]=n[1]})}}var a=Misc.union_arrays(SurveyMdl.questionGuids,r),s="";$.each(a,function(t,r){addToCookie=!0,r in SurveyMdl.questionType&&"openended"==SurveyMdl.questionType[r]&&(addToCookie=!1);var n=void 0!==e.questionsAnswers[r]?e.questionsAnswers[r]:i[r];void 0===n&&(addToCookie=!1),"undefined"==n&&(addToCookie=!1),addToCookie&&(s+=r+"="+n+"; ")}),s=s.substring(0,s.length-1);var l=new Date;l.setTime(l.getTime()+15768e7),docCookies.setItem(t,s,l)}},WidgetView={questionMarkup:function(e,t,i){var r,n=t.questiontext,o="",a=!1,s="",l=t.labelspanclass||"";if(null!=t.displayconditions&&t.displayconditions.length>0){s="metrical-hidden-question";for(let e=0;e<t.displayconditions.length;e++){const i=t.displayconditions[e];SurveyAnswersMdl.qaToggleQuestions.push({questionToCheck:i.questionid,answers:i.answers,questionToToggle:t.id})}}if(null==n||""==n)o="noQuestionText";var c="";null!=t.viewtypecssclass&&(c=t.viewtypecssclass);var u="";if("dropdown"==t.viewtype&&(u="select-item"),"statictext"===t.questiontype)return html='<li class="field statictext '+o+" "+c+" "+s+'" id="question_'+t.id+'">',t.customhtmlbeforelabel&&(html+=t.customhtmlbeforelabel),null!=n&&""!=n&&(html+="<p>"+n+"</p>"),t.customhtmlafterlabel&&(html+=t.customhtmlafterlabel),html+='<div class = "clear-float"></div>',html+="</li>",html;if("slider"===t.questiontype)return html='<li class="field '+o+" "+c+" "+s+'" id="question_'+t.id+'">',html+='<input type = "hidden" aria-hidden="true" class = "metrical-question-quid" value = "'+t.id+'" name = "metrical-question-guid-'+e+'"/>',t.customhtmlbeforelabel&&(html+=t.customhtmlbeforelabel),null!=n&&""!=n&&(html+='<label for = "'+t.id+'">'+n+"</label>"),t.customhtmlafterlabel&&(html+=t.customhtmlafterlabel),t.customhtmlbeforecontrols&&(html+=t.customhtmlbeforecontrols),html+='<div style="text-align: center;">',html+='<span class="slider-container" style="display: inline-block; width: 80%; padding: 30px 5px 30px 5px;">',html+='<input aria-label="'+t.id+'" id = "'+t.id+'" type="slider" value="0"/>',html+="</span>",html+="</div>",t.customhtmlaftercontrols&&(html+=t.customhtmlaftercontrols),html+='<div class = "clear-float"></div>',html+="</li>",html;var d="";void 0===t.leftsidedescription&&void 0===t.rightsidedescription||(void 0!==t.leftsidedescription&&null==t.rightsidedescription?chars=t.leftsidedescription.length:null==t.leftsidedescription&&null!=t.rightsidedescription?chars=t.rightsidedescription.length:chars=t.leftsidedescription.length>t.rightsidedescription.length?t.leftsidedescription.length:t.rightsidedescription.length,paddingRows=Math.floor(chars/8),d="field-with-legend-"+paddingRows),html='<li class="field '+o+" "+d+" "+c+" "+s+" "+u+'" id="question_'+t.id+'">',html+='<input type = "hidden" aria-hidden="true" class = "metrical-question-quid" value = "'+t.id+'" name = "metrical-question-guid-'+e+'"/>',t.customhtmlbeforelabel&&(html+=t.customhtmlbeforelabel);var p=["checkbox","multicheckbox","customlist","customarray"];null!=n&&""!=n&&(p.includes(t.questiontype)&&"dropdown"!=t.viewtype?html+="<fieldset><legend>"+n+"</legend>":(html+='<label for="metrical-question-'+e+'">'+n+"</label>",t.customhtmlafterlabel&&(html+=t.customhtmlafterlabel)));var h="";if("checkbox"===t.questiontype?h="container-checkbox-left":"radiobuttons"==t.viewtype?h="container-options-left":"box"==t.viewtype&&(h="container-options-boxed"),controlwrappercssclass=null!=t.controlwrappercssclass?t.controlwrappercssclass:"",t.customhtmlbeforecontrols&&(html+=t.customhtmlbeforecontrols),html+='<div class="ratings '+h+" "+controlwrappercssclass+'">',null==t.requiredmsg&&(t.requiredmsg="*This field is required"),t.isrequired&&(html+='<div class = "required error" style="display:none" id = "span-'+t.id+'-message">'+t.requiredmsg+"</div>"),"openended"===t.questiontype)void 0!==SurveyMdl.defaultValuesList[t.id]?(defaultVal=SurveyMdl.defaultValuesList[t.id],SurveyAnswersMdl.questionsAnswers[t.id]=defaultVal):defaultVal="",html+='<textarea name="message" rows="10" wrap="soft" placeholder="'+t.leadertext+'" class = "metrical-question-answer" id = "metrical-question-'+e+'" name = "metrical-question-'+e+'" >'+defaultVal+"</textarea>",t.customhtmlbetweencontrols&&(html+=t.customhtmlbetweencontrols);else if("textbox"===t.questiontype)void 0!==SurveyMdl.defaultValuesList[t.id]?(defaultVal=SurveyMdl.defaultValuesList[t.id],SurveyAnswersMdl.questionsAnswers[t.id]=defaultVal):defaultVal="",null==t.validationerrormsg&&(t.validationerrormsg="Wrong format"),html+='<span class = "error">'+t.validationerrormsg+'</span><input type = "text" name="textbox"  placeholder="'+t.leadertext+'"  class = "mqa-textbox" id = "metrical-question-'+e+'" name = "metrical-question-'+e+'"  value = "'+defaultVal+'" />',t.customhtmlbetweencontrols&&(html+=t.customhtmlbetweencontrols);else if("checkbox"===t.questiontype)void 0!==SurveyMdl.defaultValuesList[t.id]&&(defaultVal=SurveyMdl.defaultValuesList[t.id]),1!=t.isrequired&&(SurveyAnswersMdl.questionsAnswers[t.id]="0"),html+='<input type="checkbox" name="checkbox" class="mqa-checkbox" id = "metrical-question-'+e+'" name = "metrical-question-'+e+'"  /><label for="metrical-question-'+e+'">'+t.leadertext+"</label>",html+='<input aria-label="'+(t.arialabel?t.arialabel:defaultVal)+'" type = "hidden" aria-hidden="true" class = "mqa-checkbox-default" value = "'+defaultVal+'"/>',t.customhtmlbetweencontrols&&(html+=t.customhtmlbetweencontrols);else if("multicheckbox"===t.questiontype){a=!0,b="",y="",null!=t.valuesorder?valueskeys=t.valuesorder:valueskeys=Object.keys(t.valueslist);for(var g=0;g<valueskeys.length;g++)if(key=valueskeys[g],val=t.valueslist[key],-1!==key.indexOf("randomize"))WidgetView.getOptionsRandomOrder(val,function(i,r){var n="";null!=t.exclusiveoptions&&-1!==t.exclusiveoptions.indexOf(r)&&(n="exclusive-option");var o="metrical-question-"+e+"-"+r;html+='<div class="checkbox-row container-checkbox-left"><input type="checkbox" name="checkbox" class="multi-checkbox '+n+'" id="'+o+'" name="'+o+'" value="'+r+'" /><label for="'+o+'">'+val[r]+"</label></div>",t.customhtmlbetweencontrols&&(html+=t.customhtmlbetweencontrols);var a=t.id+"-"+r;SurveyAnswersMdl.questionsAnswers[a]=0});else{var f="";null!=t.exclusiveoptions&&-1!==t.exclusiveoptions.indexOf(key)&&(f="exclusive-option");var m="metrical-question-"+e+"-"+key;html+='<div class="checkbox-row container-checkbox-left"><input type="checkbox" name="checkbox" class="multi-checkbox '+f+'" id="'+m+'" name="'+m+'" value="'+key+'" /><label for="'+m+'">'+val+"</label></div>",t.customhtmlbetweencontrols&&(html+=t.customhtmlbetweencontrols);var v=t.id+"-"+key;SurveyAnswersMdl.questionsAnswers[v]=0}}else if("customlist"===t.questiontype){a=!0,SurveyAnswersMdl.questionsAnswers[t.id]=void 0,void 0!==SurveyMdl.defaultValuesList[t.id]?(defaultVal=SurveyMdl.defaultValuesList[t.id],SurveyAnswersMdl.questionsAnswers[t.id]=defaultVal):defaultVal="","dropdown"==t.viewtype&&(html+='<select aria-label="'+(t.arialabel?t.arialabel:t.id)+'" name = "metrical-question-'+e+'" class="widget-select">'),null!=t.valuesorder?valueskeys=t.valuesorder:valueskeys=Object.keys(t.valueslist);for(g=0;g<valueskeys.length;g++)if(key=valueskeys[g],val=t.valueslist[key],"dropdown"==t.viewtype)defaultVal===key?chkd=" selected = 'SELECTED'":chkd="",-1!==key.indexOf("randomize")?WidgetView.getOptionsRandomOrder(val,function(e,t){html+='<option value="'+t+'"  '+chkd+">"+val[t]+"</options>"}):html+='<option value="'+key+'"  '+chkd+">"+val+"</options>";else{defaultVal===key?chkd=" checked = 'CHECKED'":chkd="";var b="",y="";b="";"boxstacked"==t.viewtype?(b="box-stacked",y="radio-box-stacked"):"box"==t.viewtype?(b="box",y="radio-box"):"radiobuttons"==t.viewtype&&(b="radio-buttons",y="radio-buttons-input"),-1!==key.indexOf("randomize")?WidgetView.getOptionsRandomOrder(val,function(t,i){html+="<input "+chkd+' type="radio" class = "'+y+'" id = "radio'+e+i+'" name = "metrical-question-'+e+'" value="'+i+'"><label class = "'+b+'" id = "label-radio'+e+i+'" for="radio'+e+i+'"><span class="'+l+'">'+val[i]+"</span></label>"}):html+="<input "+chkd+' type="radio" class = "'+y+'" id = "radio'+e+key+'" name = "metrical-question-'+e+'" value="'+key+'"><label class = "'+b+'" id = "label-radio'+e+key+'" for="radio'+e+key+'"><span class="'+l+'">'+val+"</span></label>",t.customhtmlbetweencontrols&&(html+=t.customhtmlbetweencontrols)}"dropdown"==t.viewtype&&(html+="</select>",t.customhtmlbetweencontrols&&(html+=t.customhtmlbetweencontrols))}else if("customarray"===t.questiontype)a=!0,SurveyAnswersMdl.questionsAnswers[t.id]=void 0,void 0!==SurveyMdl.defaultValuesList[t.id]?(defaultVal=SurveyMdl.defaultValuesList[t.id],SurveyAnswersMdl.questionsAnswers[t.id]=defaultVal):defaultVal="","dropdown"==t.viewtype&&(html+='<select aria-label="'+(t.arialabel?t.arialabel:t.id)+'" id = "metrical-question-'+e+'" name = "metrical-question-'+e+'" class="widget-select">'),null!=t.valuesarray&&$.each(t.valuesarray,function(i,r){if("dropdown"==t.viewtype)defaultVal===r?chkd=" selected = 'SELECTED'":chkd="",html+='<option value="'+i+'"  '+chkd+">"+r+"</options>";else{defaultVal===r?chkd=" checked = 'CHECKED'":chkd="";var n="",o="";"boxstacked"==t.viewtype?(n="box-stacked",o="radio-box-stacked"):"box"==t.viewtype?(n="box",o="radio-box"):"radiobuttons"==t.viewtype&&(n="radio-buttons",o="radio-buttons-input"),"radiobuttons"==t.viewtype&&(html+='<div class="radiolabelrow">'),html+="<input "+chkd+'  type="radio" class = "'+o+'" id = "radio'+e+i+'" name = "metrical-question-'+e+'" value="'+i+'"><label class = "'+n+'" id = "label-radio'+e+i+'" for="radio'+e+i+'"><span class="'+l+'">'+r+"</span></label>","radiobuttons"==t.viewtype&&(html+="</div>"),t.customhtmlbetweencontrols&&(html+=t.customhtmlbetweencontrols)}}),"dropdown"==t.viewtype&&(html+="</select>",t.customhtmlbetweencontrols&&(html+=t.customhtmlbetweencontrols));else if("scalestyle"===t.questiontype)void 0!==SurveyMdl.defaultValuesList[t.id]?(defaultVal=SurveyMdl.defaultValuesList[t.id],SurveyAnswersMdl.questionsAnswers[t.id]=defaultVal):defaultVal="",numElements=t.valuesarray.length,first="first",last="",$.each(t.valuesarray,function(e,i){e==numElements-1&&(last="last"),i<=defaultVal?active=" active ":active="",leftLegend="",rightLegend="";var r=t.leftsidedescription?t.leftsidedescription:"";r=r+t.rightsidedescription?t.rightsidedescription:"",""!=first&&void 0!==t.leftsidedescription&&(leftLegend='<div class="scale-legend left '+t.scalestyle.replace("-star","")+'">'+t.leftsidedescription+"</div>"),""!=last&&void 0!==t.rightsidedescription&&(rightLegend='<div class="scale-legend right '+t.scalestyle.replace("-star","")+'">'+t.rightsidedescription+"</div>"),html+='<a aria-label="'+r+'" href="#"  class="'+t.scalestyle+" "+first+" "+last+" "+active+' " value = "'+i+'">'+leftLegend+rightLegend+"</a>",first="",t.customhtmlbetweencontrols&&(html+=t.customhtmlbetweencontrols)});else if("faces2"===t.questiontype)void 0!==SurveyMdl.defaultValuesList[t.id]?(defaultVal=SurveyMdl.defaultValuesList[t.id],SurveyAnswersMdl.questionsAnswers[t.id]=defaultVal):defaultVal="",faces={1:"face_fair",2:"face_great"},html+=this.getFacesQuestionMarkup(faces,2);else if("faces3"===t.questiontype)void 0!==SurveyMdl.defaultValuesList[t.id]?(defaultVal=SurveyMdl.defaultValuesList[t.id],SurveyAnswersMdl.questionsAnswers[t.id]=defaultVal):defaultVal="",faces={1:"face_fair",2:"face_good",3:"face_great"},html+=this.getFacesQuestionMarkup(faces,3);else if("faces5"===t.questiontype)void 0!==SurveyMdl.defaultValuesList[t.id]?(defaultVal=SurveyMdl.defaultValuesList[t.id],SurveyAnswersMdl.questionsAnswers[t.id]=defaultVal):defaultVal="",faces={1:"face_poor",2:"face_fair",3:"face_good",4:"face_great",5:"face_excellent"},html+=this.getFacesQuestionMarkup(faces,5);else if("timedquestion"===t.questiontype){void 0!==SurveyMdl.defaultValuesList[t.id]?(defaultVal=SurveyMdl.defaultValuesList[t.id],SurveyAnswersMdl.questionsAnswers[t.id]=defaultVal):defaultVal="yes",lineCounter=1,$.each(t.questioncontentlines,function(e,i){null!=t.linessurroundedbyclock&&1==lineCounter&&(html+='<div class="clock">'),lineStyles="",null!=i.styles&&(lineStyles='style="'+i.styles+'"'),lineClasses="",null!=i.classes&&(lineClasses='class="'+i.classes+'"'),html+="<p "+lineStyles+" "+lineClasses+">"+i.text+"</p>",null!=t.linessurroundedbyclock&&parseInt(t.linessurroundedbyclock)==lineCounter&&(html+="</div>"),lineCounter++}),html+='</div><div class="ratings">';var M="";if(null!=t.cancelbutton&&1==t.cancelbutton){var w="Cancel";null!=t.cancelbuttontext&&(w=t.cancelbuttontext),html+='<input aria-label="'+w+'" type="button" id="metrical-cancel-button" name = "'+w+'" value = "'+w+'"   class = "cancel-button col-half enabled">',M="col-half"}if(null!=t.buttontext)var k=t.buttontext;if(null!=t.submitbuttontext)k=t.submitbuttontext;html+='<input aria-label="'+k+'" type="submit" id="metrical-timedquestion-button" name = "'+k+'" value = "'+k+'"   class = "enabled '+M+'">'}else{void 0!==SurveyMdl.defaultValuesList[t.id]?(defaultVal=SurveyMdl.defaultValuesList[t.id],SurveyAnswersMdl.questionsAnswers[t.id]=defaultVal):defaultVal="";var I=1,_=i.numberofstars||defaultStarsForScale;for(htmlArray=[];I<=_;){first=1==I?"first":"",last=I==_?"last":"",active=I<=defaultVal?"active":"",leftLegend="",rightLegend="";var S=t.leftsidedescription?t.leftsidedescription:"";S=S+t.rightsidedescription?t.rightsidedescription:"",""!=first&&void 0!==t.leftsidedescription&&(leftLegend='<div class="scale-legend left">'+t.leftsidedescription+"</div>"),""!=last&&void 0!==t.rightsidedescription&&(rightLegend='<div class="scale-legend right">'+t.rightsidedescription+"</div>"),htmlArray.push('<a aria-label="'+S+'" href="#"  class="star '+first+" "+last+" "+active+' " value = "'+I+'">'+leftLegend+rightLegend+"</a>"),t.customhtmlbetweencontrols&&htmlArray.push(t.customhtmlbetweencontrols),I++}html+=htmlArray.join("")}if(html+="</div>",p.includes(t.questiontype)&&"dropdown"!=t.viewtype&&(html+="</fieldset>"),t.customhtmlaftercontrols&&(html+=t.customhtmlaftercontrols),html+='<div class = "clear-float"></div>',a&&(null!=t.valuesarray||null!=t.valueslist)&&null!=t.customvaluesarray){var A={};$.each(t.customvaluesarray,function(i,r){1==r.isactive&&(html+='<div class="metrical-question-customvalue" id="customvalue-'+r.customvalueid+'">',html+='<input type = "hidden" aria-hidden="true" class = "metrical-question-quid" value = "'+r.customvalueid+'" name = "metrical-question-guid-'+e+"-"+i+'" id="customvalue-'+r.customvalueid+'-input"/>',customValueRequiredMsg=t.requiredmsg,r.isrequired&&null!=r.requiredmsg&&(customValueRequiredMsg=r.requiredmsg),r.isrequired&&(html+='<div class = "required error" style="display:none" id = "span-'+r.customvalueid+'-message">'+customValueRequiredMsg+"</div>"),r.customhtmlbeforelabel&&(html+=r.customhtmlbeforelabel),null!=r.questiontext&&""!=r.questiontext&&(html+='<label for="customvalue-'+r.customvalueid+"-"+e+'">'+r.questiontext+"</label>"),r.customhtmlafterlabel&&(html+=r.customhtmlafterlabel),r.customhtmlbeforecontrols&&(html+=r.customhtmlbeforecontrols),controlwrappercssclass=null!=r.controlwrappercssclass?r.controlwrappercssclass:"",html+='<div class="ratings '+controlwrappercssclass+'">',placeHolder="",r.leadertext&&(placeHolder=r.leadertext),r.validationerrormsg&&(html+='<span class = "error">'+r.validationerrormsg+"</span>"),"openended"==r.optioncustomvaluetype?(html+='<textarea aria-label="'+(t.arialabel?t.arialabel:t.id)+'" name="message" rows="5" wrap="soft" placeholder="'+placeHolder+'" class="metrical-question-answer" id="customvalue-'+r.customvalueid+"-"+e+'" name="metrical-question-'+e+"-"+i+'" ></textarea>',r.customhtmlbetweencontrols&&(html+=r.customhtmlbetweencontrols)):"textbox"==r.optioncustomvaluetype?(html+='<input type="text" name="textbox"  placeholder="'+placeHolder+'"  class="mqa-textbox" id="customvalue-'+r.customvalueid+"-"+e+'" name="metrical-question-'+e+"-"+i+'"  value="" />',r.customhtmlbetweencontrols&&(html+=r.customhtmlbetweencontrols)):"dropdown"==r.optioncustomvaluetype&&(html+='<select name = "metrical-question-'+e+'" class="widget-select" id="customvalue-'+r.customvalueid+"-"+e+'" name="metrical-question-'+e+"-"+i+'" >',$.each(r.valuesarray,function(e,t){chkd="",html+='<option value="'+e+'"  '+chkd+">"+t+"</options>"}),html+="</select>",r.customhtmlbetweencontrols&&(html+=r.customhtmlbetweencontrols)),html+="</div>",r.customhtmlaftercontrols&&(html+=r.customhtmlaftercontrols),html+='<div class = "clear-float"></div>',html+="</div>",$.each(r.optionswithcustomvalue,function(e,t){A[t.toString()]=r.customvalueid}))}),r=A;var x="[name=metrical-question-"+e+"]";"multicheckbox"==t.questiontype?(x="input[id^=metrical-question-"+e+"-]",$(document).on("change",x,function(t){""!=this.id&&$(this).is("select")||($("#customvalue-"+r[this.value]).fadeIn("slow"),t.target.checked||($("#customvalue-"+r[this.value]).fadeOut("fast"),delete SurveyAnswersMdl.questionsAnswers[r[this.value]],customValueElement=$("#customvalue-"+r[this.value]+"-"+e),customValueElement.val(""),customValueElement.is("select")&&customValueElement.val(0)),Widget.setWidgetPosition())})):$(document).on("change",x,function(t){if(""==this.id||!$(this).is("select")){for(var i in $("#customvalue-"+r[this.value]).fadeIn("slow"),r)r[i]!=r[this.value]&&(delete SurveyAnswersMdl.questionsAnswers[r[i]],$("#customvalue-"+r[i]).fadeOut("fast"),customValueElement=$("#customvalue-"+r[i]+"-"+e),customValueElement.val(""),customValueElement.is("select")&&customValueElement.val(0));Widget.setWidgetPosition()}})}return html+="</li>",$(document).on("click","#metrical-cancel-button",function(){$(".close-widget").trigger("click"),MetricalApp.setFocusToMetricalTabButton()}),html},getOptionsRandomOrder:function(e,t){var i=Object.keys(e);i.sort(function(){return.5-Math.random()}),$.each(i,t)},getFacesQuestionMarkup:function(e,t){htmlArray=[];for(var i=1;i<=t;)face=e[i],first=1==i?"first":"",last=i==t?"last":"",active=i==defaultVal?"active":"",htmlArray.push('<a aria-label="'+i+'" href="#"  class="face '+face+" "+first+" "+last+" "+active+' " value = "'+i+'"></a>'),i++;return htmlArray.join("")},widgetMarkup:function(e){var t=this;html="";var i=null==e.cancelbutton||e.cancelbutton,r=null==e.submitbutton||e.submitbutton;if(i=1==r&&i,1!=e.oneclicksubmit||1!=r&&1!=i||(i=!1,r=!1,MetricalApp.logging.logInfo("Hiding submitbutton and cancelbutton because oneclicksubmit is true")),null!=e.offerimage&&e.offerimage){var n=MetricalApp.determineIdentifier(),o=e.couponconfig.closemap,a=e.couponconfig.submitmap,s=e.couponconfig.imageurl;if("mobile"==n&&null!=s.mobile){s=s.mobile;var l=o.mobile.shape,c=o.mobile.coordinates,u=a.mobile.shape,d=a.mobile.coordinates}else{s=s.desktop;l=o.desktop.shape,c=o.desktop.coordinates,u=a.desktop.shape,d=a.desktop.coordinates}var p=$(window).width(),h=$(window).height(),g=new Image;if(g.src=s,html+='<div style="background-color: transparent;" class="lb-wrapper">',html+='<button class="close-widget hidden"></button>',html+='<div id="form-container">',html+='<form id="metrical-widget-form" novalidate>',html+='<input id="metrical-surveyid" type = "hidden" aria-hidden="true" value = "'+e.surveyid+'" />',html+='<img usemap="#promomap" src="'+s+'">',null!=e.couponconfig.additionalinfotextmap){var f=null!=e.couponconfig.additionalinfotextmap.css?e.couponconfig.additionalinfotextmap.css:"additionalTextBox",m=null!=e.couponconfig.additionalinfotextmap.style?e.couponconfig.additionalinfotextmap.style:"",v=e.couponconfig.additionalinfotextmap;if("mobile"==n&&null!=v.mobile)var b=v.mobile.shape,y=v.mobile.coordinates;else b=v.desktop.shape,y=v.desktop.coordinates;html+='<div id="met_promo_additional_text" class="'+f+'" style="display: none; '+m+'" ><div><span class="metrical_chevron"></span></div>'+e.couponconfig.additionalinfotextmap.text+"</div>"}html+='<map name="promomap"><area shape="'+l+'" coords="'+c+'" id="close-widget" alt="Close" style="display: block; cursor: pointer;">',html+='<area id="submit-widget" shape="'+u+'" coords="'+d+'" alt="Submit" style="display: block; cursor: pointer;">',html+=null!=b&&null!=y?'<area id="metrical-display-additional-text" shape="'+b+'" coords="'+y+'" alt="Show Additional Text" style="display: block; cursor: pointer;"></map>':"</map>",html+='<ul class="form-list">',html+='<li class="actions"><input aria-hidden="true" type="submit" id="metrical-confirm-button" name ="" value="" class="enable hidden"></li>',html+="</ul>",html+="</form>",html+="</div>",g.onload=function(){var t=(h-g.height)/3,i=(p-g.width)/2;$("#metrical-widget-form img").css({position:"fixed",top:t,left:i}),null!=e.couponconfig.additionalinfotextmap&&($("#met_promo_additional_text").css({position:"fixed",top:t+g.height,left:i}),-1===$("#met_promo_additional_text").attr("style").indexOf("width")&&$("#met_promo_additional_text").css({width:g.width}),$("#metrical-widget-form div>div").css({"text-align":"center",width:g.width-20}),$(document).on("click","#metrical-display-additional-text",function(e){$("#metrical-widget-form div").fadeIn()}),$(document).on("click","#met_promo_additional_text .metrical_chevron",function(e){$("#metrical-widget-form div").slideUp()}))},$(document).on("click","#close-widget",function(e){$(".MetricalTab").css("visibility","hidden"),$(".close-widget").click(),$("#metrical-widget-form img").hide(),$("#metrical-widget-form div").hide()}),$(document).on("click","#submit-widget",function(e){$("#metrical-confirm-button").click(),$("#metrical-widget-form div").hide()})}else{if(html+='<div class="lb-wrapper">',MetricalApp.properties.iframe||(html+='<button class="close-widget"><span class="sr-only-metrical">Close</span></button>'),null!=MetricalApp.timedQuestionDelay?html+='<div class="MetricalHeader">'+e.titletext.replace("{{timer}}",MetricalApp.timedQuestionDelay)+"</div>":html+='<div class="MetricalHeader">'+e.titletext+"</div>",html+='<div id = "form-container">',html+='<form id = "metrical-widget-form" novalidate>',html+='<input id="metrical-surveyid" type = "hidden" aria-hidden="true" value = "'+e.surveyid+'" />',html+='<ul class="form-list">',$.each(e.questions,function(i,r){html+=t.questionMarkup(i,r,e)}),additionalSubmitClass="mobile"==MetricalApp.determineIdentifier()?"mobile-submit-button":"",hideSubmitButton="",(null!=e.hidesubmitbutton&&1==e.hidesubmitbutton||0==r)&&(hideSubmitButton="hidden"),1==i){html+='<li class="actions relative">';var M="Cancel";null!=e.cancelbuttontext&&(M=e.cancelbuttontext),html+='<input type="button" id="metrical-cancel-button" name = "'+M+'" value = "'+M+'" class = "cancel-button col-half">',additionalSubmitClass+=" col-half"}else html+='<li class="actions">';if(null!=e.buttontext)var w=e.buttontext;if(null!=e.submitbuttontext)w=e.submitbuttontext;if(html+='<input type="submit" id="metrical-confirm-button" name = "'+w+'" value = "'+w+'"   class = "metrical-button-disabled '+additionalSubmitClass+" "+hideSubmitButton+'">',html+="</li></ul>",html+="</form>",html+="</div>",html+='<div class="lb-footer">',html+="<ul>",void 0!==e.footer){var k=1;$.each(e.footer,function(t,i){var r=i.targetblank?' target="_blank" ':"";if(void 0!==i.link)var n='<a aria-label="'+i.text+'" href="'+i.link+'"'+r+">"+i.text+"</a>";else n="<span>"+i.text+"</span>";k<e.footer.length?html+="<li>"+n+'<span class="separator">|</span></li>':html+="<li>"+n+"</li>",k++})}html+="</ul>"}return html+="</div>",html+='<div id = "check-offset"><div>',html}},WidgetExceptionView={render:function(e){return"<div>"+e+"</div>"}},AnswersDictionary={questions:{},answers:{},questionHash:{},init:function(e,t){this.questions=e,this.answers=t,this.buildQuestionHash()},buildQuestionHash:function(){if(this.questions)for(var e=0;e<this.questions.length;e++){var t=this.questions[e];this.questionHash[t.id]=t}},hasAnswer:function(e){return e in this.answers},getRaw:function(e){return this.answers[e]},get:function(e){var t=this.getRaw(e);if(e in this.questionHash){var i=this.questionHash[e];if("valuesarray"in i){var r=i.valuesarray[t];void 0!==r&&(t=r)}}return t},keys:function(){var e=[];for(var t in this.answers)e.push(t);return e}},ThankYouView={thankYouMarkup:function(e){if(Widget.isThankYouImageView())$("div.lb-wrapper div#form-container").removeAttr("style"),html=this.thankYouImageMarkup();else{var t=SurveyMdl.widgetObj.thankyouviewclass;"default"==t?html='<div class = "thank-you-message">'+SurveyMdl.widgetObj.thankyoumessages+"</div>":"altthankyou"==t&&($(".MetricalContainer div.MetricalHeader").replaceWith('<div class="MetricalHeader"></div><div class="thank-you-message">Thank You!</div>'),"lightbox"==MetricalApp.properties.rendertype?$("#form-container").css("height","auto"):$("#form-container").css("height","500px"),$(".Metrical_lightbox").animate({scrollTop:"0px"},300),html='<div class="ty-content">',html+='\t<div class="ty-set">',html+='\t\t<div class="ty-type">',html+='\t\t\t<div class="ty-item">',html+=SurveyMdl.widgetObj.thankyoumessages,html+="\t\t\t</div>",html+="\t\t</div>",html+="\t</div>",html+='\t<div class="ty-footer">',html+='\t\t<div class="ty-button-bar"></div>',html+="\t</div>",html+="</div>")}return html},thankYouImageMarkup:function(){var e=MetricalApp.determineIdentifier(),t=SurveyMdl.widgetObj.couponconfig.closemap;null!=SurveyMdl.widgetObj.couponconfig.thankyouclosemap&&(t=SurveyMdl.widgetObj.couponconfig.thankyouclosemap);var i=SurveyMdl.widgetObj.couponconfig.thankyouimageurl;if("mobile"==e&&null!=i.mobile){i=i.mobile;var r=t.mobile.shape,n=t.mobile.coordinates}else{i=i.desktop;r=t.desktop.shape,n=t.desktop.coordinates}var o=$(window).width()-15,a=$(window).height(),s=new Image;return s.src=i,html='<form id="metrical-widget-form" novalidate>',html='<button class="close-widget-thank hidden"></button>',html+='<div id="thankyou-container">',html+='<img usemap="#thankyoumap" src="'+i+'">',html+='<map name="thankyoumap"><area shape="'+r+'" coords="'+n+'" id="close-widget" alt="Close" style="display: block; cursor: pointer;">',html+="</map>",html+="</div>",html+="</form>",s.onload=function(){$("#thankyou-container img").css({position:"fixed",top:(a-s.height)/3,left:(o-s.width)/2})},$(document).on("click",".close-widget-thank",function(e){$(".MetricalTab").css("visibility","hidden"),$(".close-widget").click(),$("#thankyou-container img").hide()}),html}},ErrorView={errorMarkup:function(){return html='<div class = "error-message">An error occurred. Please try again later</div>',html}},WiggleTab=function(e,t){var i=$;setTimeout(function(){var e=i(".MetricalTab");i(".MetricalContainer").hasClass("is-popped")?WiggleTab(4e3,t):1==e.hasClass(t)?(e.removeClass(t),WiggleTab(5e3,t)):(e.addClass(t),WiggleTab(2e3,t))},e)},WidgetDelayer={timeToSurveyDisplays:0,delayBeforeDisplay:0,sitedelaybeforedisplay:0,thresholdValue:null,delaytick:0,delaytickCookieName:"_Metrical_delaytick",metricalApp:null,widgetObj:null,overrideKey:"overridesitedelaybeforedisplay",callback:function(){},init:function(e,t,i,r){this.widgetObj=t,WidgetDelayer.setCookies(i),MetricalApp.logging.logInfo("delay: ",this.delayBeforeDisplay),null!=this.timeToSurveyDisplays&&(this.delayBeforeDisplay=1e3*this.timeToSurveyDisplays),MetricalApp.logging.logInfo("delay: ",this.delayBeforeDisplay),MetricalApp.logging.logInfo("resume key present: ",docCookies.hasItem("_Metrical_resumetick")),MetricalApp.logging.logInfo("delay key present: ",docCookies.hasItem("_Metrical_delaytick")),this.metricalApp=r,1==this.isSiteDelayOverridden()&&(this.delayBeforeDisplay=0),MetricalApp.logging.logInfo("resume key present: ",docCookies.hasItem("_Metrical_resumetick")),MetricalApp.logging.logInfo("delay key present: ",docCookies.hasItem("_Metrical_delaytick")),MetricalApp.logging.logInfo("delay: ",this.delayBeforeDisplay),this.callback=e;var n=this.delayBeforeDisplay;this.startDelayTimerForCallback(n)},startDelayTimerForCallback:function(e){var t=this;setTimeout(function(){t.callback()},e)},isSiteDelayOverridden:function(){return null!=this.metricalApp.properties[this.overrideKey]&&1==this.metricalApp.properties[this.overrideKey]||(1==this.widgetObj.isReturningBehavior()||!(!docCookies.hasItem("_Metrical_resumetick")||!docCookies.hasItem("_Metrical_thresholdreached"))&&(MetricalApp.logging.logInfo("Cookie override to delay metrical running"),!0))},setCookies:function(e){var t,i,r,n,o,a=this,s=!1;void 0!==e.delaybeforedisplaythreshold&&(o=parseInt(e.delaybeforedisplaythreshold),isNaN(o)&&(o=0),o&&(s=!0),docCookies.hasItem("_Metrical_resumetick")||(s=!0,(i=new Date).setTime(i.getTime()+1e3*o),docCookies.setItem("_Metrical_resumetick",o,i,"/",docCookies.rootDomain())),a.thresholdValue=o),void 0!==e.sitedelaybeforedisplay&&(this.sitedelaybeforedisplay=parseInt(e.sitedelaybeforedisplay),isNaN(this.sitedelaybeforedisplay)&&(this.sitedelaybeforedisplay=0),this.timeToSurveyDisplays=this.sitedelaybeforedisplay,s&&(t=void 0!==o?o:this.sitedelaybeforedisplay,docCookies.hasItem("_Metrical_delaytick")?(r=parseInt(docCookies.getItem("_Metrical_delaytick")),this.delaytick=r,this.timeToSurveyDisplays-=r):((i=new Date).setTime(i.getTime()+1e3*t),docCookies.setItem("_Metrical_delaytick",0,i,"/",docCookies.rootDomain()),this.delaytick=0),n=setInterval(function(){a.updateDelaytickCookie(t,n)},1e3)))},updateDelaytickCookie:function(e,t){var i;this.delaytick<this.sitedelaybeforedisplay-1?(this.delaytick=docCookies.getItem("_Metrical_delaytick"),this.delaytick++,(i=new Date).setTime(i.getTime()+1e3*(e-this.delaytick)),docCookies.setItem("_Metrical_delaytick",this.delaytick,i,"/",docCookies.rootDomain())):(clearInterval(t),(i=new Date).setTime(i.getTime()-1e3),docCookies.setItem("_Metrical_delaytick",this.delaytick,i,"/",docCookies.rootDomain()),(i=new Date).setTime(i.getTime()+1e3*this.thresholdValue),docCookies.setItem("_Metrical_thresholdreached",1,i,"/",docCookies.rootDomain()))}};rootMetricalObj.delay=WidgetDelayer;var CustomerEvents={userClickedTab:!1},executeMetrical=function(){};rootMetricalObj.reevaluateMetrical=function(){SurveyMdl.widgetObj={},MetricalApp.logging.logInfo("reevaluating metrical"),MetricalApp.reinit(function(){MetricalApp.logging.logInfo("reevaluating SurveyMdl"),SurveyMdl.reinit(function(){var e;MetricalApp.logging.logInfo("running postSurveyInit() after reevaluation"),MetricalApp.postSurveyInit(),null!=SurveyMdl.widgetObj.openafterxloads&&docCookies.hasItem("_Metrical_PageViewCount")&&(e=parseInt(docCookies.getItem("_Metrical_PageViewCount"))),(null==e||e>=SurveyMdl.widgetObj.openafterxloads)&&(MetricalApp.logging.logInfo("initializing WidgetDisplayer"),WidgetDelayer.init(function(){if(MetricalApp.logging.logInfo("WidgetDisplayer callback fired"),MetricalApp.logging.logInfo("initializing Widget",Widget.initiWasCalled),Widget.init(MetricalApp.el,SurveyMdl.widgetObj,!1),"function"==typeof MetricalApp.properties.postWidgetRender&&MetricalApp.properties.postWidgetRender(MetricalApp),rootMetricalObj.makeVisible(),null!=SurveyMdl.widgetObj.delaybeforeopeningclosedtab&&SurveyMdl.widgetObj.startingbehavior==StartingBehavior.closeBehavior&&0==SurveyMdl.widgetObj.isReturningBehavior()&&"mobile"!=MetricalApp.determineIdentifier()){var e=1e3*parseInt(SurveyMdl.widgetObj.delaybeforeopeningclosedtab);MetricalApp.logging.logInfo("delaying opening the closed tab for "+e+" seconds"),MetricalApp.tabOpenerTimer=setTimeout(function(){jQuery(".MetricalContainer").hasClass("is-popped")||(MetricalApp.logging.logInfo("clicking open the widget"),jQuery(".MetricalTab").click(),MetricalApp.properties.afterDelayOpenedHook(MetricalApp))},e),jQuery(".MetricalTab").on("click",function(){null!=MetricalApp.tabOpenerTimer&&(clearTimeout(MetricalApp.tabOpenerTimer),MetricalApp.tabOpenerTimer=null)}),jQuery(".close-widget").on("click",function(){"lightbox"==MetricalApp.properties.rendertype&&null!=MetricalApp.tabOpenerTimer&&(clearTimeout(MetricalApp.tabOpenerTimer),MetricalApp.tabOpenerTimer=null)})}else MetricalApp.logging.logInfo("skipping the startup of delaybeforeopeningclosedtab");Widget.setWidgetPosition(),setTimeout(function(){Widget.setWidgetPosition()},500)},SurveyMdl.widgetObj,ClientWidget.widgetObj,MetricalApp))})})},$(document).ready(function(){try{_MetricalObject_did_cookie(),_MetricalObject_sessionid(),are_cookies_enabled()?Validator.widgetAllowed(Metrical_options)&&(Validator.userdata(Metrical_options),MetricalApp.logging.logInfo("initializing MetricalApp"),MetricalApp.init(Metrical_options,function(){executeMetrical(),MetricalApp.logging.logInfo("initializing SurveyMdl"),SurveyMdl.init(function(){var e;MetricalApp.logging.logInfo("running postSurveyInit()"),MetricalApp.postSurveyInit(),rootMetricalObj.showWidget=function(){0==Widget.initiWasCalled?Widget.init(MetricalApp.el,SurveyMdl.widgetObj,!1):null!=MetricalApp.timedQuestionDelay&&Widget.init(MetricalApp.el,SurveyMdl.widgetObj,!1),Widget.show(),jQuery(".MetricalContainer").css("visibility","visible")},rootMetricalObj.makeVisible=function(){Widget.shouldDisplay&&(MetricalApp.properties.makeVisibleHook(MetricalApp),Widget.setWidgetPosition(),jQuery(".MetricalContainer").css("visibility","visible")),1==MetricalApp.properties.echolog&&rootMetricalObj.echoLog()},null!=SurveyMdl.widgetObj.openafterxloads&&docCookies.hasItem("_Metrical_PageViewCount")&&(e=parseInt(docCookies.getItem("_Metrical_PageViewCount"))),(null==e||e>=SurveyMdl.widgetObj.openafterxloads)&&(MetricalApp.logging.logInfo("initializing WidgetDisplayer"),WidgetDelayer.init(function(){if(MetricalApp.logging.logInfo("WidgetDisplayer callback fired"),MetricalApp.logging.logInfo("initializing Widget",SurveyMdl.widgetObj),0==Widget.initiWasCalled&&(Widget.init(MetricalApp.el,SurveyMdl.widgetObj,!1),"function"==typeof MetricalApp.properties.postWidgetRender&&MetricalApp.properties.postWidgetRender(MetricalApp)),rootMetricalObj.makeVisible(),null!=SurveyMdl.widgetObj.delaybeforeopeningclosedtab&&SurveyMdl.widgetObj.startingbehavior==StartingBehavior.closeBehavior&&0==SurveyMdl.widgetObj.isReturningBehavior()&&"mobile"!=MetricalApp.determineIdentifier()){var e=1e3*parseInt(SurveyMdl.widgetObj.delaybeforeopeningclosedtab);MetricalApp.logging.logInfo("delaying opening the closed tab for "+e+" seconds"),MetricalApp.tabOpenerTimer=setTimeout(function(){jQuery(".MetricalContainer").hasClass("is-popped")||(MetricalApp.logging.logInfo("clicking open the widget"),jQuery(".MetricalTab").click(),MetricalApp.properties.afterDelayOpenedHook(MetricalApp))},e),jQuery(".MetricalTab").on("click",function(){null!=MetricalApp.tabOpenerTimer&&(clearTimeout(MetricalApp.tabOpenerTimer),MetricalApp.tabOpenerTimer=null)}),jQuery(".close-widget").on("click",function(){"lightbox"==MetricalApp.properties.rendertype&&null!=MetricalApp.tabOpenerTimer&&(clearTimeout(MetricalApp.tabOpenerTimer),MetricalApp.tabOpenerTimer=null)})}else MetricalApp.logging.logInfo("skipping the startup of delaybeforeopeningclosedtab");Widget.setWidgetPosition(),setTimeout(function(){Widget.setWidgetPosition()},500)},SurveyMdl.widgetObj,ClientWidget.widgetObj,MetricalApp))})})):log("Cookies are disabled")}catch(e){MetricalApp.logging.logError(e)}})}(jQuery)},reevaluate:function(){var e;(e=document.querySelectorAll('div[class^="Metrical"]'))&&e.length>0&&e.forEach(function(e){e.remove()}),_Metrical.reevaluateMetrical()}};_MetricalGA=function(e){var t={logger:new _MetricalLogger({extra:{module:"ga"}}),isactive:!1,dataLayerKey:"dataLayer"};this.properties=Object.assign({},t,e||{}),this.dataLayerPresent=!!window[this.properties.dataLayerKey],this.logger=this.properties.logger},_MetricalGA.prototype.event=function(e,t){var i={presented:function(){return _MetricalPresented(e,t)},interaction:function(){return _MetricalInteraction(e,t)},default:function(){return _MetricalDefault(e,t)}};return(i[e]||i.default)()},_MetricalGA.prototype.record=function(e,t){if(this.properties.isactive&&this.dataLayerPresent){var i=this.event(e,t);window[this.properties.dataLayerKey].push(i),this.logger.debug("pushed to GA",{obj:i})}else this.logger.debug("GA record() is disabled",{isactive:this.properties.isactive,dataLayerPresent:this.dataLayerPresent})},_MetricalDefault=function(e,t){var i=Object.assign({},{event:"",data:{}});return i.event="metrical_default",i.data=t,i},_MetricalInteraction=function(e,t){if(!e)throw new Error("An event is required to pass");if(!t)throw new Error("Interaction Object is required");var i=Object.assign({},{event:"",interaction:{}});return i.event=e+"_"+t.action,i.interaction=t,i},_MetricalPresented=function(e,t){if(!e)throw new Error("An event is required to pass");if(!t)throw new Error("Data Object is required");return Object.assign({},{event:"metrical_presented"},t)};var _MetricalInteractions={apiendpoint:_MetricalHosts.endpoints.interaction,interactionsSourceID:"InteractionsModule",captureinteractions:!1,captureallinteractions:!1,capturescrollinteractions:!1,norecordonsubmitifempty:!1,capturescrollinteractionsthreshold:0,interactions:[],interactionsHandlers:[],interactionsObserver:null,interactionsIframeHandlers:[],interactionsIframeObservers:{},postRecordAction:null,scrollThresholdReachedTimes:0,scrollInteractionsRecordingLimit:2,originalDocumentHeight:0,intProcessedTimestamps:{},limitInteractionsProcessingRate:!0,recordInteractionCallback:null,recordInteractionObservers:[],observersCalled:[],interactionModificationCallback:void 0,customEventsList:["element closed","element opened","text changed","attribute changed","elements added","elements removed"],getBasicInteractionData:function(){return uuid=this.Util.makeUUID(),{uuid:uuid,survey_id:this.interactionsSourceID}},getInteractionData:function(){return{}},init:function(e,t,i,r,n){if(jqInt=e,_MetricalInteractions.Log.info("Initializing the _MetricalInteractions module"),null!=t.apiendpoint&&(this.apiendpoint=t.apiendpoint),null!=t.captureinteractions&&(this.captureinteractions=t.captureinteractions),null!=t.captureallinteractions&&(this.captureallinteractions=t.captureallinteractions),null!=t.capturescrollinteractions&&(this.capturescrollinteractions=t.capturescrollinteractions),null!=t.limitinteractionsprocessingrate&&(this.limitInteractionsProcessingRate=t.limitinteractionsprocessingrate),null!=t.norecordonsubmitifempty&&(this.norecordonsubmitifempty=t.norecordonsubmitifempty),null!=t.interactionModificationCallback&&(this.interactionModificationCallback=t.interactionModificationCallback),null!=t.capturescrollinteractionsthreshold&&(this.capturescrollinteractionsthreshold=t.capturescrollinteractionsthreshold,Array.isArray(this.capturescrollinteractionsthreshold))){this.scrollThresholdReachedTimes={};for(var o=0;o<this.capturescrollinteractionsthreshold.length;o++)this.scrollThresholdReachedTimes[100*this.capturescrollinteractionsthreshold[o]+"%"]=0}if(null!=t.interactions&&(this.interactions=this.interactions.concat(t.interactions)),i&&"function"==typeof i&&(this.getInteractionData=i),r&&"function"==typeof r&&(this.postRecordAction=r),1==_MetricalInteractions.captureinteractions&&1==_MetricalInteractions.captureallinteractions){null!=n&&"function"==typeof n&&(this.recordInteractionCallback=n);try{this.setupInteractions(),this.setupIframeInteractions(),this.setupLoadUnloadInteractions(),this.setupScrollInteractions(),this.processURLInteractions()}catch(e){console.log("Skipping custom interactions, due to error %s",e)}}else _MetricalInteractions.Log.info("Did not set up the interactions capture, since captureinteractions or captureallinteractions is/are set to false");_MetricalInteractions.Log.info("Finished the initialization of the _MetricalInteractions module",this)},setupLoadUnloadInteractions:function(){this.recordInteraction("",null,!0,!1)},relinkBasicInteractions:function(){jqInt.each(_MetricalInteractions.interactions,function(e,t){if(jqInt(t.selector).length>0&&!_MetricalInteractions.isCustomEvent(t.event)){var i=t.event+".Metrical";jqInt(t.selector).off(i),customHandler=jqInt(t.selector).on(i,null,null,function(e){void 0!==e.originalEvent&&_MetricalInteractions.processInteraction(t,e)})}})},setupInteractions:function(){jqInt.each(_MetricalInteractions.interactions,function(key,interaction){if(!_MetricalInteractions.isInteractionAlreadyRegistered(interaction)){var interactionEventHandler=function(e){void 0!==e.originalEvent&&_MetricalInteractions.processInteraction(interaction,e)},customEventInteractionEventHandler=function(event){switch(interaction.event){case"element closed":recordInteraction=_MetricalInteractions.isElementClosedInteraction(event),fieldKey=interaction.fieldkey,fieldVal=eval(interaction.fieldeval);break;case"element opened":recordInteraction=_MetricalInteractions.isElementOpenedInteraction(event),fieldKey=interaction.fieldkey,fieldVal=eval(interaction.fieldeval);break;case"text changed":recordInteraction=!0,fieldKey=interaction.fieldkey?interaction.fieldkey:"text_changed",fieldValString=interaction.fieldeval?interaction.fieldeval:"event[0].target.textContent",fieldVal=eval(fieldValString);break;case"attribute changed":recordInteraction=_MetricalInteractions.isAttributeChangedInteraction(event,interaction.observedattributes),fieldKey=interaction.fieldkey?interaction.fieldkey:"attribute_changed",fieldValString=interaction.fieldeval?interaction.fieldeval:"event[0].attributeName",fieldVal=eval(fieldValString);break;case"elements added":recordInteraction=_MetricalInteractions.isElementsAddedInteraction(event),fieldKey=interaction.fieldkey?interaction.fieldkey:"elements_added",fieldValString=interaction.fieldeval?interaction.fieldeval:"JSON.stringify(event[0].addedNodes)",fieldVal=eval(fieldValString);break;case"elements removed":recordInteraction=_MetricalInteractions.isElementsRemovedInteraction(event),fieldKey=interaction.fieldkey?interaction.fieldkey:"elements_removed",fieldValString=interaction.fieldeval?interaction.fieldeval:"JSON.stringify(event[0].removedNodes)",fieldVal=eval(fieldValString);break;default:recordInteraction=!1,fieldKey=interaction.fieldkey,fieldVal=eval(interaction.fieldeval)}recordInteraction&&_MetricalInteractions.processInteraction(interaction,event,fieldKey,fieldVal)};if(jqInt(interaction.selector).length>0)if(_MetricalInteractions.Log.info("Registering the event handler for the custom interaction",interaction),_MetricalInteractions.isCustomEvent(interaction.event))jqInt.each(jqInt(interaction.selector),function(e,t){_MetricalInteractions.Log.info("Registering an observer for '"+interaction.event+"' interactions on the element",t),elementObserver=new MutationObserver(customEventInteractionEventHandler),elementObserver.observe(t,_MetricalInteractions.getObserverConfigForCustomEvent(interaction.event))}),_MetricalInteractions.interactionsHandlers.push({selector:interaction.selector,event:interaction.event,handlerFunction:customEventInteractionEventHandler});else{var eventNamespace=interaction.event+".Metrical";jqInt(interaction.selector).off(eventNamespace,null,null,interactionEventHandler),customHandler=jqInt(interaction.selector).on(eventNamespace,null,null,interactionEventHandler),_MetricalInteractions.interactionsHandlers.push({selector:interaction.selector,event:interaction.event,handlerFunction:interactionEventHandler})}}}),null==_MetricalInteractions.interactionsObserver&&(_MetricalInteractions.Log.info("Setting up an observer for the elements with interactions"),_MetricalInteractions.interactionsObserver=new MutationObserver(_MetricalInteractions.setupInteractions),_MetricalInteractions.interactionsObserver.observe(document.documentElement,{childList:!0,subtree:!0}))},checkInteractionProcessingLimit:function(e){var t=!1;if(this.limitInteractionsProcessingRate){var i=e.selector.replace(/ /g,"_")+"_"+e.event.replace(/ /g,"_"),r=+new Date;null==_MetricalInteractions.intProcessedTimestamps[i]&&(_MetricalInteractions.intProcessedTimestamps[i]=r);var n=r-_MetricalInteractions.intProcessedTimestamps[i],o=!0;if("element opened"==e.event||"element closed"==e.event){var a="element opened"==e.event?"element_closed":"element_opened",s=e.selector.replace(/ /g,"_")+"_"+a;if(null!=_MetricalInteractions.intProcessedTimestamps[s])r-_MetricalInteractions.intProcessedTimestamps[s]<1e3&&(o=!1);else _MetricalInteractions.intProcessedTimestamps[s]=r;_MetricalInteractions.intProcessedTimestamps[i]>_MetricalInteractions.intProcessedTimestamps[s]&&(o=!1)}(0==n||n>=1e3)&&o&&(_MetricalInteractions.intProcessedTimestamps[i]=+new Date,t=!0)}else t=!0;return t},processInteraction:function(interaction,event,fieldKey,fieldVal){if(_MetricalInteractions.checkInteractionProcessingLimit(interaction)){targetToRecord=null,null!=interaction.recordtarget&&1==interaction.recordtarget&&(null==fieldKey&&(fieldKey=interaction.fieldkey),null==fieldVal&&(fieldVal=eval(interaction.fieldeval)),targetToRecord={field_key:fieldKey,target:fieldVal}),null!=interaction.chainedinteraction&&"before"==interaction.chainedinteraction.chainorder&&_MetricalInteractions.processInteraction(_MetricalInteractions.interactions[interaction.chainedinteraction.interactionindex],event);var isAsync="isasync"in interaction?interaction.isasync:void 0;_MetricalInteractions.recordInteraction(interaction.action,targetToRecord,isAsync),null!=interaction.chainedinteraction&&"after"==interaction.chainedinteraction.chainorder&&_MetricalInteractions.processInteraction(_MetricalInteractions.interactions[interaction.chainedinteraction.interactionindex],event)}},indicatorNotPresent:function(e){return 1!=jqInt(e).data("_MetricalInteractionIsSet")},isCustomEvent:function(e){return this.customEventsList.indexOf(e)>-1},getObserverConfigForCustomEvent:function(e){switch(e){case"element closed":case"element opened":config={attributes:!0,subtree:!1,childList:!1,characterData:!1};break;case"text changed":config={attributes:!1,subtree:!0,childList:!1,characterData:!0};break;case"attribute changed":config={attributes:!0,subtree:!1,childList:!1,characterData:!1};break;case"elements added":case"elements removed":config={attributes:!1,subtree:!1,childList:!0,characterData:!1};break;default:config={subtree:!0,childList:!0}}return config},isElementClosedInteraction:function(e){return elementClosedInteractionPerformed=!1,element=e[0].target,"none"!=element.style.display&&"0px"!=element.style.width&&"hidden"!=element.style.visibility||(elementClosedInteractionPerformed=!0),elementClosedInteractionPerformed},isElementOpenedInteraction:function(e){return elementOpenedInteractionPerformed=!1,element=e[0].target,"none"!=element.style.display&&"0px"!=element.style.width&&"hidden"!=element.style.visibility&&(elementOpenedInteractionPerformed=!0),elementOpenedInteractionPerformed},isAttributeChangedInteraction:function(e,t){return attributeChangedInteractionPerformed=!1,t.indexOf(e[0].attributeName)>-1&&(attributeChangedInteractionPerformed=!0),attributeChangedInteractionPerformed},isElementsAddedInteraction:function(e){elementsAddedInteractionPerformed=!1;for(var t=0;t<e.length;t++)if(e[t].addedNodes.length>0){elementsAddedInteractionPerformed=!0;break}return elementsAddedInteractionPerformed},isElementsRemovedInteraction:function(e){elementsRemovedInteractionPerformed=!1;for(var t=0;t<e.length;t++)if(e[t].removedNodes.length>0){elementsRemovedInteractionPerformed=!0;break}return elementsRemovedInteractionPerformed},processURLInteractions:function(){jqInt.each(_MetricalInteractions.interactions,function(e,t){"url"==t.event&&(patt=new RegExp(t.urlmatch),urlMatches=patt.test(window.location.href),urlMatches&&_MetricalInteractions.processInteraction(t,null,null!=t.fieldkey?t.fieldkey:"",_MetricalInteractions.Util.getURLParameterByName(t.urlparameter,window.location.href)))})},isInteractionAlreadyRegistered:function(e){for(var t=0;t<_MetricalInteractions.interactionsHandlers.length;t++)if(rInteraction=_MetricalInteractions.interactionsHandlers[t],e.selector==rInteraction.selector&&e.event==rInteraction.event)return!0;return!1},setupIframeInteractions:function(){null!=jqInt("iframe")&&jqInt("iframe").on("load",null,null,function(){_MetricalInteractions.Log.info("Iframe loaded. Configuring the custom interactions...",this);var e=this.src;if(_MetricalInteractions.isSameOrigin(e)){var t=this.contentWindow.document,i=this.contentWindow;null!=_MetricalInteractions.interactionsIframeObservers[e]&&_MetricalInteractions.interactionsIframeObservers[e].disconnect(),observer=new MutationObserver(function(){jqInt.each(_MetricalInteractions.interactions,function(r,n){var o=function(e){void 0!==e.originalEvent&&_MetricalInteractions.processInteraction(n,e,n.fieldkey,i.eval(n.fieldeval))},a=function(e){switch(n.event){case"element closed":recordInteraction=_MetricalInteractions.isElementClosedInteraction(e),fieldKey=n.fieldkey,fieldVal=i.eval(n.fieldeval);break;case"element opened":recordInteraction=_MetricalInteractions.isElementOpenedInteraction(e),fieldKey=n.fieldkey,fieldVal=i.eval(n.fieldeval);break;case"text changed":recordInteraction=!0,fieldKey=n.fieldkey?n.fieldkey:"text_changed",fieldValString=n.fieldeval?n.fieldeval:"event[0].target.textContent",fieldVal=i.eval(fieldValString);break;case"attribute changed":recordInteraction=_MetricalInteractions.isAttributeChangedInteraction(e,n.observedattributes),fieldKey=n.fieldkey?n.fieldkey:"attribute_changed",fieldValString=n.fieldeval?n.fieldeval:"event[0].attributeName",fieldVal=i.eval(fieldValString);break;case"elements added":recordInteraction=_MetricalInteractions.isElementsAddedInteraction(e),fieldKey=n.fieldkey?n.fieldkey:"elements_added",fieldValString=n.fieldeval?n.fieldeval:"JSON.stringify(event[0].addedNodes)",fieldVal=i.eval(fieldValString);break;case"elements removed":recordInteraction=_MetricalInteractions.isElementsRemovedInteraction(e),fieldKey=n.fieldkey?n.fieldkey:"elements_removed",fieldValString=n.fieldeval?n.fieldeval:"JSON.stringify(event[0].removedNodes)",fieldVal=i.eval(fieldValString);break;default:recordInteraction=!1,fieldKeyValue=n.fieldkey,fieldVal=i.eval(n.fieldeval)}recordInteraction&&_MetricalInteractions.processInteraction(n,e,fieldKey,fieldVal)};_MetricalInteractions.isCustomInteractionIframeAlreadyRegistered(e,n)&&jqInt(n.selector,t).unbind(n.event),jqInt(n.selector,t).length>0&&(_MetricalInteractions.Log.info("Registering the event handler for the custom interaction on the iframe",n),_MetricalInteractions.isCustomEvent(n.event)?(jqInt.each(jqInt(n.selector),function(e,t){_MetricalInteractions.Log.info("Registering an observer for '"+n.event+"' interactions on the iframe on the element",t),elementObserver=new MutationObserver(a),elementObserver.observe(t,_MetricalInteractions.getObserverConfigForCustomEvent(n.event))}),_MetricalInteractions.interactionsIframeHandlers.push({ifrSrc:e,selector:n.selector,event:n.event,handlerFunction:a})):(jqInt(n.selector,t).off(n.event,null,null,o),customHandler=jqInt(n.selector,t).on(n.event,null,null,o),_MetricalInteractions.interactionsIframeHandlers.push({ifrSrc:e,selector:n.selector,event:n.event,handlerFunction:o})))}),_MetricalInteractions.Log.info("Ending custom interactions iframe setup")}),observer.observe(t.documentElement,{childList:!0,subtree:!0}),_MetricalInteractions.interactionsIframeObservers[e]=observer}})},isCustomInteractionIframeAlreadyRegistered:function(e,t){for(var i=0;i<_MetricalInteractions.interactionsIframeHandlers.length;i++)if(rInteraction=_MetricalInteractions.interactionsIframeHandlers[i],t.selector==rInteraction.selector&&t.event==rInteraction.event&&e==rInteraction.ifrSrc)return!0;return!1},setupScrollInteractions:function(){this.originalDocumentHeight=jqInt(document).height();var e,t=jqInt(window),i=(t.scrollTop(),this);1==this.capturescrollinteractions?(scrollHandler=function(){i.originalDocumentHeight==t.height()&&(i.originalDocumentHeight=jqInt(document).height());var r=100*t.scrollTop()/(i.originalDocumentHeight-t.height());if(!isNaN(r)&&isFinite(r)&&(scrollThresholdData=i.getScrollThresholdReached(r),(null==scrollThresholdData.thresholdReached||scrollThresholdData.thresholdReached)&&scrollThresholdData.recordInteraction)){r=r.toFixed()+"%";var n=t.scrollTop();e&&clearTimeout(e),e=setTimeout(function(){i.shouldScrollInteractionBeRecorded(scrollThresholdData)&&(percent=null!=scrollThresholdData.thresholdReached?scrollThresholdData.thresholdReached:r,_MetricalInteractions.recordInteraction("scroll to "+percent,null,!0))},1e3),n}},t.off("scroll",scrollHandler),t.on("scroll",scrollHandler)):_MetricalInteractions.Log.info("Did not set up the scroll interactions capture, since capturescrollinteractions is set to false")},getScrollThresholdReached:function(e){if(thresholdData={recordInteraction:!1,thresholdReached:null},Array.isArray(this.capturescrollinteractionsthreshold))for(var t=0;t<this.capturescrollinteractionsthreshold.length;t++){if(null!=this.capturescrollinteractionsthreshold[t+1]&&e>100*this.capturescrollinteractionsthreshold[t]&&e<=100*this.capturescrollinteractionsthreshold[t+1]){thresholdData.thresholdReached=100*this.capturescrollinteractionsthreshold[t]+"%",thresholdData.recordInteraction=!0;break}if(null==this.capturescrollinteractionsthreshold[t+1]&&e>100*this.capturescrollinteractionsthreshold[t]){thresholdData.thresholdReached=100*this.capturescrollinteractionsthreshold[t]+"%",thresholdData.recordInteraction=!0;break}}else 0==this.capturescrollinteractionsthreshold?thresholdData.recordInteraction=!0:e>=100*this.capturescrollinteractionsthreshold&&(thresholdData.thresholdReached=100*this.capturescrollinteractionsthreshold+"%",thresholdData.recordInteraction=!0);return thresholdData},shouldScrollInteractionBeRecorded:function(e){return shouldBeRecorded=!1,e.recordInteraction&&(thresholdReached=e.thresholdReached,null==thresholdReached&&(shouldBeRecorded=!0),null!=thresholdReached&&Number.isInteger(this.scrollThresholdReachedTimes)&&this.scrollThresholdReachedTimes<this.scrollInteractionsRecordingLimit&&(shouldBeRecorded=!0,this.scrollThresholdReachedTimes++),null!=thresholdReached&&"object"==typeof this.scrollThresholdReachedTimes&&this.scrollThresholdReachedTimes[thresholdReached]<this.scrollInteractionsRecordingLimit&&(shouldBeRecorded=!0,this.scrollThresholdReachedTimes[thresholdReached]++)),shouldBeRecorded},isIframeOnSameDomain:function(e){return ifrDomain=this.extractHostname(e),currentDomain=this.extractHostname(window.location.href),ifrDomain==currentDomain},isSameOrigin:function(e){var t=window.location.protocol+"//"+window.location.hostname;return 0==e.split("?")[0].indexOf(t)},extractHostname:function(e){return(e.indexOf("://")>-1?e.split("/")[2]:e.split("/")[0]).split(":")[0].split("?")[0]},extractRootDomain:function(e){var t=this.extractHostname(e),i=t.split("."),r=i.length;return r>2&&(t=i[r-2]+"."+i[r-1],2==i[r-1].length&&2==i[r-1].length&&(t=i[r-3]+"."+t)),t},registerRecordInteractionObserver:function(e,t){0==this.recordInteractionObservers.map(function(e){return e.key}).includes(e)&&this.recordInteractionObservers.push({key:e,callback:t})},recordInteraction:function(e,t,i,r){if(this.captureinteractions){var n=this;n.observersCalled=[],i=void 0===i||i,r=void 0===r||r;var o=function(t){for(var o in t.usermeta)void 0===t.usermeta[o]&&(t.usermeta[o]=null);if("heartbeat"==t.action){var a=_MetricalStorage.SessionStorage.getItem("lastUserMeta");if(_MetricalUtils.isEqual(t.usermeta,a))return}_MetricalStorage.SessionStorage.setItem("lastUserMeta",t.usermeta),jqInt.ajax({type:"POST",dataType:"json",data:t,traditional:!1,async:i,url:n.apiendpoint,success:function(t){jqInt("body")&&(jqInt("#metrical_interaction").remove(),jqInt("body").append("<input type='hidden' id='metrical_interaction' name='metrical_interaction_"+e.split(" ").join("_")+"' value='succeed'>"))},error:function(e,t,i){console.log(e),console.log(t),console.log(i)}});for(var s=0;s<n.recordInteractionObservers.length;s++){var l=n.recordInteractionObservers[s];"function"==typeof l.callback&&l.callback(t)}null!=n.postRecordAction&&r&&n.postRecordAction(e),"function"==typeof n.recordInteractionCallback&&n.recordInteractionCallback(t)};if("assign"in Object==0?interactionData=jqInt.extend(this.getBasicInteractionData(),this.getInteractionData()):interactionData=Object.assign(this.getBasicInteractionData(),this.getInteractionData()),interactionData.action=e,null!=t&&(interactionData[t.field_key]=t.target),"function"==typeof this.interactionModificationCallback)this.interactionModificationCallback(jqInt,interactionData,o,i);else o(interactionData)}else _MetricalInteractions.Log.info("Interactions capture disabled")},Log:{logs:new Array,buffer:!0,info:function(){var e=Array.prototype.slice.call(arguments);jqInt.each(e,function(e,t){});var t={type:"info",timestamp:this.timeStamp(),echoed:!1,data:e};this.logs.push(t),this.buffer||this.echo()},error:function(){var e=Array.prototype.slice.call(arguments);jqInt.each(e,function(e,t){});var t={type:"error",timestamp:this.timeStamp(),echoed:!1,data:e};this.logs.push(t),this.buffer||this.echo()},echo:function(){var e=this;return window.console&&jqInt.each(this.logs,function(t,i){i.echoed||(e.printOutData(i),i.echoed=!0)}),"End of logs"},echoAll:function(){var e=this;return window.console&&jqInt.each(this.logs,function(t,i){e.printOutData(i)}),"End of logs"},printOutData:function(e){"info"==e.type?console.info(e.timestamp+": ",e.data):"error"==e.type&&jqInt.each(e.data,function(t,i){i instanceof Error?console.error(e.timestamp+" - "+i.name+" - "+i.message+": ",i.stack):console.error(e.timestamp+": ",i)})},timeStamp:function(){var e=new Date,t=[e.getMonth()+1,e.getDate(),e.getFullYear()],i=[e.getHours(),e.getMinutes(),e.getSeconds()],r=i[0]<12?"AM":"PM";i[0]=i[0]<12?i[0]:i[0]-12,i[0]=i[0]||12;for(var n=1;n<3;n++)i[n]<10&&(i[n]="0"+i[n]);return t.join("/")+" "+i.join(":")+" "+r}},Util:{makeUUID:function(){var e=Date.now();return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(t){var i=(e+16*Math.random())%16|0;return e=Math.floor(e/16),("x"==t?i:7&i|8).toString(16)})},identifierIsIOS:function(){return!!/iPhone|iPad|iPod/i.test(navigator.userAgent)},getURLParameterByName:function(e,t){t||(t=window.location.href),e=e.replace(/[\[\]]/g,"\\$&");var i=new RegExp("[?&]"+e+"(=([^&#]*)|&|#|$)").exec(t);return i?i[2]?decodeURIComponent(i[2].replace(/\+/g," ")):"":null}}},jqInt=null;_MetricalIdentity={pubsub:new _MetricalUtils.PubSub,pubsubTopics:{"reset-session-id":"reset-session-id"},topic:"event/reset-session-id",keyUuid:"uuid",keySessionId:"session_id",properties:{},instanceId:null,timerToken:null,resetInterval:18e5,init:function(e){this.properties=Object.assign({},{storage:null,bus:null,utils:null},e||{}),this.storage=this.properties.storage,this.utils=this.properties.utils,this.bus=this.properties.bus,this.initializeInstanceId(),this.initializeDeviceId(),this.initializeSessionId()},initializeInstanceId:function(){this.instanceId=this.utils.makeUUID()},initializeDeviceId:function(){this.storage.hasItem(this.keyUuid)||this.storage.setItem(this.keyUuid,this.utils.makeUUID())},initializeSessionId:function(){this.storage.hasItem(this.keySessionId)||this.resetSessionId()},resetSessionId:function(){var e=this.utils.makeUUID();this.storage.setItem(this.keySessionId,e,{expiresAfter:1800}),this.bus.publish(this.topic,{sessionId:e})},getSessionId:function(){var e=this.storage.getItem(this.keySessionId);return null===e&&(this.resetSessionId(),e=this.storage.getItem(this.keySessionId)),e},getDeviceId:function(){var e=this.storage.getItem(this.keyUuid);return e&&this.storage.setItem(this.keyUuid,e),e},getInstanceId:function(){return this.instanceId},getLastTimestamp:function(){return this.storage.getItem("_Metrical_lastTimestamp")},setLastTimestamp:function(){this.storage.setItem("_Metrical_lastTimestamp",Date.now())}};var _MetricalBrowserHistory={key:"urlHistory",history:[],init:function(){var e=window.location.href;this.history=this.getHistoryFromStorage(),this.history.unshift(e),this.saveHistoryToStorage()},storageHasKey:function(){for(var e=!1,t=this.key,i=0;i<window.sessionStorage.length;i++)window.sessionStorage.key(i)==t&&(e=!0);return e},getHistoryFromStorage:function(){var e=[];return this.storageHasKey()&&(e=JSON.parse(window.sessionStorage.getItem(this.key))),e},saveHistoryToStorage:function(){window.sessionStorage.setItem(this.key,JSON.stringify(this.history))},getCurrentUrl:function(){return this.history.length>0?this.history[0]:null},getLastUrl:function(){return this.history.length>1?this.history[1]:null}},_MetricalTestMode={storage:null,key:"testMode",init:function(e){this.storage=e},enable:function(){return this.storage.setItem(this.key,1),"Test Mode is enabled"},disable:function(){return this.storage.setItem(this.key,0),"Test Mode is disabled"},isInTestMode:function(){return"1"==this.storage.getItem(this.key)}};_MetricalCoupon=function(e){var t={couponConfig:{},browser:new _MetricalBrowser,logger:new _MetricalLogger({extra:{module:"coupon"}})};if(this.properties=Object.assign({},t,e||{}),this.browser=this.properties.browser,this.logger=this.properties.logger,0==!!this.properties.couponConfig.coupondriver)throw this.logger.error("couponConfig requires a coupondriver property",{couponConfig:this.properties.couponConfig}),new Error("couponConfig requires a coupondriver property");this.properties.couponConfig.forceredirect=!!this.properties.couponConfig.forceredirect},_MetricalCoupon.prototype.driver=function(e,t){var i=e||this.properties.couponConfig.coupondriver;this.logger.debug("selected coupon driver",{couponDriver:i});var r=Object.assign({},{browser:this.browser,logger:this.logger},this.properties.couponConfig,t||{},{metricalCoupon:this});switch(this.logger.debug("properties for coupon driver",{properties:r}),i){case"Actions":case"ActionsDriver":return new _MetricalCouponDriverActions(r);case"Applier":case"ApplierDriver":return new _MetricalCouponDriverApplier(r);case"CallBridge":case"CallBridgeDriver":return new _MetricalCouponDriverCallBridge(r);case"Eval":case"EvalDriver":return new _MetricalCouponDriverEval(r);case"Fetch":case"FetchDriver":return new _MetricalCouponDriverFetch(r);case"JcpCoupon":case"JcpCouponDriver":return new _MetricalCouponDriverJcp(r);case"Redirect":case"RedirectDriver":return new _MetricalCouponDriverRedirect(r);case"ShopifyRecharge":case"ShopifyRechargeDriver":return new _MetricalCouponDriverShopifyRecharge(r);case"ApplyCoupon":case"ApplyCouponDriver":return new _MetricalCouponDriverApplyCoupon(r);default:throw new Error("Could not find a matching driver case for "+i)}};