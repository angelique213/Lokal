<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Shop All | Lokal</title>

  <!-- Icons (FA6 stable) -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css" crossorigin="anonymous" referrerpolicy="no-referrer"/>

  <!-- Site / Cart / Wishlist styles -->
  <link rel="stylesheet" href="style.css">
  <link rel="stylesheet" href="cart.css">
  <link rel="stylesheet" href="wishlist.css">
  <script src="wishlist.js" defer></script>

  <!-- Page-only styles -->
  <style>
    :root{
      --ink:#2b1f1a;
      --ink-2:#7a6f68;
      --tone:#6d6a33;
      --tone-2:#C9C78B;
      --line:#e8e3da;
      --chip:#f8f6f2;
      --card:#ffffff;
    }

    .shop-wrap{ max-width: 1200px; margin: 24px auto 60px; padding: 0 20px; }
    .section-title{ text-align:center; font-size:2.4rem; margin: 12px 0 18px; color:var(--ink); letter-spacing:.02em; }

    .filter-bar{
      display:grid;
      grid-template-columns: 1.6fr 1fr 1fr auto;
      gap:12px; align-items:center; margin:16px 0 22px;
    }
    .filter-bar .field{
      display:flex; align-items:center; gap:10px; background:var(--card);
      border:1px solid var(--line); padding:10px 12px; border-radius:14px;
      box-shadow: 0 1px 0 rgba(0,0,0,.02);
    }
    .filter-bar .field:focus-within{
      border-color:var(--tone); box-shadow:0 0 0 4px rgba(109,106,51,.12);
    }
    .filter-bar i{ color:var(--ink); opacity:.85; }

    .filter-bar input[type="search"]{
      border:0; outline:0; width:100%; font-size:.98rem; color:var(--ink);
      background:transparent; padding:4px 0;
    }

    .filter-bar select{
      border:0; outline:0; width:100%; font-size:.98rem; color:var(--ink);
      background:
        linear-gradient(to bottom,#fff,#f7f6f3) padding-box,
        linear-gradient(to bottom, var(--line), var(--line)) border-box;
      -webkit-appearance:none; appearance:none; padding:4px 30px 4px 0;
    }
    .field{ position:relative; }
    .field::after{
      content:"\f0dc";
      font: var(--fa-font-solid);
      position:absolute; right:10px; top:50%; transform:translateY(-50%) scale(.9);
      color:var(--ink); opacity:.5; pointer-events:none;
    }

    .btn-reset{
      height:36px; padding:0 12px;
      border-radius:10px; border:1px solid #cfc7c1; background:#fff; cursor:pointer;
      font-weight:700; color:var(--ink); font-size:.9rem; line-height:36px;
      transition: background .15s, box-shadow .15s, transform .02s;
    }
    .btn-reset:hover{ background:#f5f1ea; box-shadow:0 0 0 4px rgba(109,106,51,.10); }
    .btn-reset:active{ transform:translateY(1px); }

    .products-list{
      display:grid; gap:24px; grid-template-columns: repeat(4, 1fr);
    }
    @media (max-width: 992px){ .products-list{ grid-template-columns: repeat(3,1fr); } }
    @media (max-width: 768px){ .products-list{ grid-template-columns: repeat(2,1fr); } }
    @media (max-width: 520px){
      .filter-bar{ grid-template-columns: 1fr; }
      .products-list{ grid-template-columns: 1fr; }
    }

    .card{
      background:#fff; border:1px solid #eee; border-radius:14px; overflow:hidden; position:relative;
      transition: transform .25s, box-shadow .25s, border-color .25s;
    }
    .card:hover{ transform: translateY(-4px); box-shadow:0 10px 20px rgba(0,0,0,.08); border-color:#e6e3da; }
    .card .img-wrap{ aspect-ratio: 1/1; background:#f2f1e7; overflow:hidden; display:grid; place-items:center; }
    .card img{ width:100%; height:100%; object-fit:cover; }
    .card .body{ padding:14px 16px 16px; }
    .card .name{ font-weight:800; color:var(--ink); margin:0 0 6px; }
    .card .price{ font-weight:800; color:var(--ink); margin:0; }
    .card .meta{ display:flex; justify-content:space-between; align-items:center; margin-top:8px; color:var(--ink-2); font-size:.9rem; }

    /* Quick View button */
    .quick-btn{
      position:absolute; left:50%; top:36%; transform:translate(-50%,-50%);
      opacity:0; pointer-events:none; background:var(--ink); color:#fff; border:0; padding:10px 14px;
      border-radius: 10px; font-weight:700; cursor:pointer; transition: opacity .2s;
    }
    .card:hover .quick-btn{ opacity:.96; pointer-events:auto; }

    /* Place the heart on each card (uses base styles in wishlist.css) */
    .card .wishlist-btn{
      position:absolute; right:10px; top:10px; z-index:2;
    }

    .pager{
      display:flex; gap:8px; justify-content:center; align-items:center; margin-top:26px; flex-wrap:wrap;
    }
    .pager button{
      min-width:40px; height:40px; border-radius:10px; border:1px solid #d9d2cb; background:#fff; cursor:pointer;
      font-weight:800; color:var(--ink); font-size:.98rem; letter-spacing:.02em;
      box-shadow:0 1px 0 rgba(0,0,0,.03);
      transition: background .15s, color .15s, border-color .15s, transform .02s;
    }
    .pager button:hover{ background:#fbfaf8; border-color:#cfc7c1; }
    .pager button:active{ transform:translateY(1px); }
    .pager button[disabled]{ opacity:.5; cursor:not-allowed; }
    .pager .active{ background:var(--tone); color:#fff; border-color:var(--tone); }

    /* -------- Quick View Modal -------- */
    .qv-overlay{
      position: fixed; inset: 0; background: rgba(0,0,0,.45);
      opacity: 0; visibility: hidden; transition: opacity .2s, visibility .2s; z-index: 1000;
    }
    .qv-overlay.active{ opacity:1; visibility:visible; }

    .qv-modal{
      position: fixed; inset: 0; padding: 24px; display: grid; place-items: center;
      opacity: 0; visibility: hidden; transition: opacity .2s, visibility .2s; z-index: 1001;
    }
    .qv-modal.active{ opacity:1; visibility:visible; }

    .qv-shell{
      width: min(1100px, 96vw);
      background: #fff;
      border-radius: 12px;
      overflow: hidden;
      display: grid; grid-template-columns: 1.15fr 1fr; gap: 0;
      position: relative;
    }
    .qv-close{
      position: absolute; top: 12px; right: 12px;
      width: 36px; height: 36px; border-radius: 999px;
      border: 1px solid rgba(0,0,0,.15);
      background: #fff; color:#111; font-size: 20px; line-height: 1;
      display: grid; place-items: center; cursor: pointer;
      z-index: 1;
    }
    .qv-media{ background:#f6f6f4; display:grid; place-items:center; min-height: 420px; }
    .qv-media img{ width: 100%; height: 100%; object-fit: contain; aspect-ratio: 4/3; max-height: 80vh; }
    .qv-info{ padding: 28px; }
    .qv-brand{ letter-spacing:.28em; font-size:.8rem; color:var(--tone); margin:0 0 8px; text-transform: uppercase; }
    .qv-title{ font-size: 1.8rem; margin: 0 0 6px; color:var(--ink); line-height:1.25; }
    .qv-rating{ margin: 8px 0 10px; color:#e0a106; }
    .qv-price{ font-weight: 800; margin: 6px 0 14px; color:var(--ink); }
    .qv-rule{ border:0; border-top:1px solid #eee; margin: 16px 0 18px; }

    .qv-size{ margin:8px 0 12px; }
    .qv-size-label{ display:block; font-weight:700; color:var(--ink); margin-bottom:8px; }
    .size-pills{ display:flex; flex-wrap:wrap; gap:10px; }
    .size-pills input{ position:absolute; opacity:0; pointer-events:none; }
    .size-pills label{
      display:inline-flex; align-items:center; justify-content:center;
      min-width:56px; height:36px; padding:0 12px;
      border:1px solid #cfc7c1; border-radius:999px; background:#fff; color:var(--ink); font-weight:700; cursor:pointer; transition:.15s;
      font-size:.95rem;
    }
    .size-pills label:hover{ border-color:var(--tone); box-shadow:0 0 0 3px rgba(109,106,51,.14); }
    .size-pills input:checked + label{ background:var(--tone); color:#fff; border-color:var(--tone); }

    .qv-qty{
      display:inline-grid; grid-template-columns: 44px 70px 44px; height: 44px;
      border: 1px solid #bbb; border-radius: 8px; overflow: hidden; background:#fff;
      margin-bottom: 12px;
    }
    .qv-qty button{ background:#fff; border:0; font-size:22px; font-weight:700; color:var(--ink); cursor:pointer; border-right:1px solid #ddd; }
    .qv-qty button:last-of-type{ border-right:0; border-left:1px solid #ddd; }
    .qv-qty input{ border:0; width:70px; text-align:center; font-size:16px; outline:none; -webkit-appearance:none; appearance:textfield; color:var(--ink); }
    .qv-qty input::-webkit-outer-spin-button,
    .qv-qty input::-webkit-inner-spin-button{ -webkit-appearance:none; margin:0; }

    .qv-btn{
      width: 100%; height: 48px; border-radius: 8px; font-weight: 700; cursor:pointer;
      display:inline-flex; align-items:center; justify-content:center; gap:10px; transition: filter .15s;
    }
    .qv-btn-primary{ background:var(--tone); color:#fff; border:0; margin-bottom:10px; }
    .qv-btn-outline{ background:#fff; color:var(--ink); border:1px solid #ccc; }
    .qv-btn-outline:hover{ background:var(--tone-2); color:#fff; border-color:var(--tone); }

    @media (max-width: 820px){
      .qv-shell{ grid-template-columns: 1fr; }
      .qv-media{ min-height: 300px; }
      .qv-media img{ aspect-ratio: 4/3; max-height: 60vh; }
    }

    .lock-scroll{ overflow:hidden; }

    .product-link{ text-decoration:none; color:inherit; }
    .product-link:hover,.product-link:focus{ text-decoration:none; outline:none; }

    .stars .fa-star,
    .stars .fa-star-half-stroke,
    .qv-rating .fa-star,
    .qv-rating .fa-star-half-stroke{ color:#f6c31c; }
    .stars .fa-regular.fa-star,
    .qv-rating .fa-regular.fa-star{ color:#d8d2c8; }
  </style>
</head>
<body>

  <!-- HEADER -->
  <header class="header">
    <div class="logo">
      <a href="index.html" aria-label="Home">
        <img src="images/projectlogo.png" alt="logo">
      </a>
    </div>

    <div class="nav-center">
      <form class="site-search" action="search.html" method="GET">
        <i class="fa-solid fa-magnifying-glass"></i>
        <input type="search" name="q" placeholder="Search products, categories..." autocomplete="off"/>
        <button type="submit">Search</button>
      </form>

      <nav class="main-links">
        <ul>
          <li><a href="best-pick/best-picks.html">Best Picks</a></li>
          <li><a href="shop-all.html" class="active">Shop All</a></li>
          <li class="has-megamenu">
            <a href="#" class="catmenu-toggle" aria-expanded="false">
              Shop by Category <i class="fa-solid fa-chevron-down" aria-hidden="true"></i>
            </a>
            <div class="mega" id="catMega" role="menu" aria-label="Shop by Category">
              <h3 class="cat-heading">All Categories</h3>
              <ul class="cat-list">
                <li><a href="shop-all.html?cat=flavors"><i class="fa-solid fa-cookie-bite"></i> Flavors</a></li>
                <li><a href="shop-all.html?cat=accessories"><i class="fa-solid fa-gear"></i> Accessories</a></li>
                <li><a href="shop-all.html?cat=bags"><i class="fa-solid fa-bag-shopping"></i> Bags</a></li>
                <li><a href="shop-all.html?cat=clothing"><i class="fa-solid fa-shirt"></i> Clothing</a></li>
                <li><a href="shop-all.html?cat=home"><i class="fa-solid fa-mug-hot"></i> Home</a></li>
                <li><a href="shop-all.html?cat=crafts"><i class="fa-solid fa-scissors"></i> Crafts</a></li>
                <li><a href="shop-all.html?cat=christmas"><i class="fa-solid fa-snowflake"></i> Christmas</a></li>
              </ul>
            </div>
          </li>
        </ul>
      </nav>
    </div>

    <nav class="utils">
      <ul class="nav-links">
        <li><a href="login.html"><i class="fa-solid fa-user"></i></a></li>
        <li class="cart-icon">
          <a href="#" id="openCart" aria-label="Open cart">
            <i class="fa-solid fa-cart-shopping"></i>
            <span class="cart-count">0</span>
          </a>
        </li>
        <li style="position: relative;">
          <a href="wishlist.html" aria-label="Favorites" id="wishlistLink">
            <i class="fa-regular fa-heart"></i>
            <span class="wishlist-count" id="wishlistCount">0</span>
          </a>
        </li>
        <li><a href="support.html"><i class="fa-solid fa-headset"></i></a></li>
      </ul>
    </nav>
  </header>

  <!-- Cart Drawer -->
  <div class="cd-overlay" id="cdOverlay" aria-hidden="true"></div>
  <aside class="cd-drawer" id="cdDrawer" aria-hidden="true" role="dialog" aria-label="Cart drawer">
    <div class="cd-header">
      <h2>Cart</h2>
      <button id="cdClose" class="cd-close" aria-label="Close cart">×</button>
    </div>
    <div class="cd-body">
      <div id="cdItems" class="cd-items"></div>
      <div class="cd-summary">
        <div class="cd-row">
          <span>Subtotal</span>
          <strong id="cdSubtotal">₱0.00</strong>
        </div>
        <p class="cd-note">Shipping, taxes, and discount codes calculated at checkout.</p>
        <label class="cd-terms">
          <input id="cdAgree" type="checkbox">
          <span>I agree with the <a href="terms.html" target="_blank" rel="noopener">terms and conditions</a></span>
        </label>
        <button id="cdCheckout" class="cd-checkout" disabled>CHECK OUT</button>
      </div>
    </div>
  </aside>

  <!-- SHOP BODY -->
  <main class="shop-wrap">
    <h1 class="section-title">Shop All</h1>

    <!-- Filter Bar -->
    <div class="filter-bar">
      <div class="field">
        <i class="fa-solid fa-magnifying-glass"></i>
        <input id="fSearch" type="search" placeholder="Search name or description...">
      </div>
      <div class="field">
        <i class="fa-solid fa-layer-group"></i>
        <select id="fCategory" aria-label="Category">
          <option value="">All categories</option>
          <option value="flavors">Flavors</option>
          <option value="accessories">Accessories</option>
          <option value="bags">Bags</option>
          <option value="clothing">Clothing</option>
          <option value="home">Home</option>
          <option value="crafts">Crafts</option>
          <option value="christmas">Christmas</option>
        </select>
      </div>
      <div class="field">
        <i class="fa-solid fa-arrow-up-wide-short"></i>
        <select id="fSort" aria-label="Sort">
          <option value="featured">Sort: Featured</option>
          <option value="price-asc">Price: Low to High</option>
          <option value="price-desc">Price: High to Low</option>
          <option value="name-asc">Name: A–Z</option>
          <option value="name-desc">Name: Z–A</option>
        </select>
      </div>
      <button id="fReset" class="btn-reset" type="button">Reset</button>
    </div>

    <!-- Grid -->
    <section id="grid" class="products-list" aria-live="polite"></section>

    <!-- Pagination -->
    <div id="pager" class="pager"></div>
  </main>

  <!-- QUICK VIEW MODAL -->
  <div class="qv-overlay" id="qvOverlay" aria-hidden="true"></div>
  <div class="qv-modal" id="qvModal" aria-hidden="true" role="dialog" aria-modal="true" aria-label="Quick view">
    <div class="qv-shell" role="document">
      <button class="qv-close" id="qvClose" aria-label="Close">×</button>

      <div class="qv-media">
        <img id="qvImg" alt="">
      </div>

      <div class="qv-info">
        <p class="qv-brand">Lokal</p>
        <h2 class="qv-title" id="qvName"></h2>
        <div class="qv-rating" id="qvRating" aria-label="Product rating"></div>
        <p class="qv-price" id="qvPrice"></p>
        <hr class="qv-rule" />

        <!-- SIZE (clothing only) -->
        <div class="qv-size" id="qvSizeWrap" hidden>
          <span class="qv-size-label">Size</span>
          <div class="size-pills" role="radiogroup" aria-label="Choose size">
            <input type="radio" name="qvSize" id="qvS" value="Small"><label for="qvS">S</label>
            <input type="radio" name="qvSize" id="qvM" value="Medium"><label for="qvM">M</label>
            <input type="radio" name="qvSize" id="qvL" value="Large"><label for="qvL">L</label>
            <input type="radio" name="qvSize" id="qvXL" value="XL"><label for="qvXL">XL</label>
          </div>
        </div>

        <label class="qv-qty" aria-label="Quantity">
          <button type="button" id="qvDec" aria-label="Decrease">−</button>
          <input type="number" id="qvQty" value="1" min="1" aria-label="Quantity input">
          <button type="button" id="qvInc" aria-label="Increase">+</button>
        </label>

        <p class="qv-stock" id="qvStock" hidden>Only 6 items in stock!</p>

        <button class="qv-btn qv-btn-primary" id="qvAdd">
          <i class="fa-solid fa-cart-plus"></i> ADD TO CART
        </button>
        <button class="qv-btn qv-btn-outline" id="qvView">View Details</button>

        <div class="qv-desc" id="qvDesc"></div>
      </div>
    </div>
  </div>

  <!-- FOOTER -->
  <footer class="footer">
    <div class="footer-section">
      <h1>Contact Us</h1>
      <ul class="footer-list">
        <li>lokal@info.com</li>
        <li>lokal@admin.com</li>
        <li>Manila Philippines</li>
        <li class="border-list"></li>
        <li class="socials">
          <i class="fa-brands fa-square-instagram"></i>
          <i class="fa-brands fa-square-facebook"></i>
          <i class="fa-brands fa-tiktok"></i>
        </li>
      </ul>
    </div>
    <div class="footer-section">
      <h1>Quick Links</h1>
      <ul class="footer-list">
        <li><a href="index.html">Home</a></li>
        <li><a href="shop-all.html">Shop All</a></li>
        <li><a href="about.html">About Us</a></li>
        <li><a href="terms.html">Terms & Conditions</a></li>
      </ul>
    </div>
    <div class="footer-section">
      <h1>Subscribe to Newsletter</h1>
      <ul class="footer-list">
        <li>A local marketplace is a community hub where people buy, sell, or trade goods and services within their area.</li>
        <li class="sub">
          <input type="text" placeholder="Your email">
          <button class="button">Subscribe</button>
        </li>
      </ul>
    </div>
  </footer>

  <!-- LOGIC -->
  <script>
    /* ------------ Config ------------- */
    const PRODUCT_PAGE = 'best-pick/product.html';

    const PRODUCTS = [
      /* FLAVORS */
      { name:"Shamrock Otap", price:"₱120", desc:"Delicate layered pastry from Cebu.", img:"images/flavors/flavors1.png", images:["images/flavors/flavors1.png","images/flavors/flavors1a.png"], category:"flavors", rating:4.5, reviews:12, bullets:["Cebu favorite","Crisp flakes","Perfect pasalubong"] },
      { name:"Shamrock Rosquillos", price:"₱120", desc:"Iconic buttery biscuits from Cebu with a crisp bite.", img:"images/flavors/flavors2.png", images:["images/flavors/flavors2.png","images/flavors/flavors2a.png"], category:"flavors", rating:4.6, reviews:10, bullets:["Classic Cebu treat","Light & crunchy","Ideal for tea time"] },
      { name:"Mango Flavorful Candy", price:"₱100", desc:"Chewy candy bursting with the natural sweetness of mangoes.", img:"images/flavors/flavors5.png", images:["images/flavors/flavors5.png","images/flavors/flavors5a.png"], category:"flavors", rating:4.3, reviews:18, bullets:["Sweet & tangy","Pocket-size treat","Made with real mango"] },
      { name:"Dried Mangoes", price:"₱100", desc:"Cebu's Lucky Premium Dried Mangoes", img:"images/flavors/flavors26.png", images:["images/flavors/flavors26.png","images/flavors/flavors26a.png","images/flavors/flavors26b.png"], category:"flavors", rating:4.3, reviews:18, bullets:["Freshness Guaranteed","Pocket-size treat","Made with real mango"] },
      { name:"7D Dried Mangoes Dark Chocolate", price:"₱170", desc:"Premium dried mangoes dipped in rich dark chocolate.", img:"images/flavors/flavors6.png", images:["images/flavors/flavors6.png","images/flavors/flavors6a.png","images/flavors/flavors6b.png"], category:"flavors", rating:4.7, reviews:22, bullets:["Sweet-tart balance","Gift-ready","Made in PH"] },
      { name:"Davana Cassava Chips Barbeque", price:"₱120", desc:"Crunchy cassava chips with smoky barbeque seasoning.", img:"images/flavors/flavors7.png", images:["images/flavors/flavors7.png","images/flavors/flavors7a.png"], category:"flavors", rating:4.5, reviews:16, bullets:["Gluten-free","Locally sourced","Barbeque goodness"] },
      { name:"Auro Plant-based Chocolates", price:"₱110", desc:"Ethically crafted fiesta-inspired plant-based chocolate bars.", img:"images/flavors/flavors8.png", images:["images/flavors/flavors8.png","images/flavors/flavors8a.png"], category:"flavors", rating:4.8, reviews:20, bullets:["Vegan friendly","Award-winning PH brand","Sustainably sourced"] },
      { name:"Pure Benguet Honey", price:"₱400", desc:"Locally harvested pure wildflower honey from Benguet.", img:"images/flavors/flavors9.png", images:["images/flavors/flavors9.png","images/flavors/flavors9a.png"], category:"flavors", rating:4.9, reviews:25, bullets:["100% natural","Supports local beekeepers","No preservatives"] },
      { name:"Chocolea Choco Drink", price:"₱350", desc:"Single-origin cacao drink mix sweetened with coconut sugar.", img:"images/flavors/flavors10.png", images:["images/flavors/flavors10.png","images/flavors/flavors10a.png"], category:"flavors", rating:4.6, reviews:14, bullets:["Hot or cold","Rich cocoa taste","Homegrown Filipino brand"] },
      { name:"7D Dried Mangorind", price:"₱69", desc:"Chewy mix of tart tamarind and sweet mango.", img:"images/flavors/flavors11.png", images:["images/flavors/flavors11.png","images/flavors/flavors11a.png"], category:"flavors", rating:4.6, reviews:15, bullets:["90g pack","Great pasalubong","Sweet-tart balance"] },
      { name:"Guisantes Espesyal", price:"₱229", desc:"Green Peas with Mango Bits Pack of 12.", img:"images/flavors/flavors13.png", images:["images/flavors/flavors13.png","images/flavors/flavors13a.png"], category:"flavors", rating:4.6, reviews:17, bullets:["20g × 12 packs","Locally made"] },
      { name:"KangKong King", price:"₱149", desc:"Water Spinach Chips Original 60g", img:"images/flavors/flavors12.png", images:["images/flavors/flavors12.png","images/flavors/flavors12a.png","images/flavors/flavors12b.png"], category:"flavors", rating:4.6, reviews:14, bullets:["Real kangkong leaf","Coconut oil","Gluten-free"] },
      { name:"Sabanana", price:"₱59.75", desc:"Thin and crispy banana chips.", img:"images/flavors/flavors14.png", images:["images/flavors/flavors14.png","images/flavors/flavors14a.png"], category:"flavors", rating:4.6, reviews:18, bullets:["Sweet original","100g"] },
      { name:"Garlic Mushroom Chicharon", price:"₱199", desc:"Crispy mushroom chips with garlic.", img:"images/flavors/flavors15.png", images:["images/flavors/flavors15.png","images/flavors/flavors15a.png"], category:"flavors", rating:4.6, reviews:17, bullets:["75g","Healthier snack"] },
      { name:"Dried Mango Strips", price:"₱149", desc:"Guadalupe Dried Mangoes, Cebu.", img:"images/flavors/flavors16.png", images:["images/flavors/flavors16.png","images/flavors/flavors16a.png"], category:"flavors", rating:4.6, reviews:20, bullets:["All natural","100g"] },
      { name:"65% Dark Chocolate Bar", price:"₱279", desc:"Malagos 65% dark chocolate.", img:"images/flavors/flavors17.png", images:["images/flavors/flavors17.png","images/flavors/flavors17a.png"], category:"flavors", rating:4.6, reviews:25, bullets:["Single-origin Davao","Fruity notes"] },
      { name:"Manila Chocolate Bar Collection", price:"₱559", desc:"Artisan assortment from Manila Chocolatier.", img:"images/flavors/flavors18.png", images:["images/flavors/flavors18.png","images/flavors/flavors18a.png","images/flavors/flavors18b.png"], category:"flavors", rating:4.8, reviews:17, bullets:["Local cacao","Gift-ready"] },
      { name:"Camote Chips", price:"₱99", desc:"Sweet & salty camote chips.", img:"images/flavors/flavors19.png", images:["images/flavors/flavors19.png","images/flavors/flavors19a.png"], category:"flavors", rating:4.7, reviews:14, bullets:["Natural","Proudly PH"] },
      { name:"Ube Coco White Chocolate", price:"₱250", desc:"32% Ube Coco white chocolate w/ puffed rice.", img:"images/flavors/flavors20.png", images:["images/flavors/flavors20.png","images/flavors/flavors20a.png"], category:"flavors", rating:4.9, reviews:15, bullets:["60g","Tree-to-bar"] },
      { name:"Special Spicy Butcheron", price:"₱149", desc:"Crunchy, spicy butcheron snack.", img:"images/flavors/flavors21.png", images:["images/flavors/flavors21.png"], category:"flavors", rating:4.8, reviews:15, bullets:["50g","Halal"] },
      { name:"Sweet & Spicy Dilis", price:"₱100", desc:"Crispy anchovies, sweet-spicy.", img:"images/flavors/flavors22.png", images:["images/flavors/flavors22.png"], category:"flavors", rating:4.7, reviews:14, bullets:["Halal","Perfect snack"] },
      { name:"Sweet & Spicy Pusit", price:"₱119", desc:"Tender dried squid, sweet-spicy.", img:"images/flavors/flavors23.png", images:["images/flavors/flavors23.png"], category:"flavors", rating:4.6, reviews:14, bullets:["Halal","Great balance"] },
      { name:"Shortbread Cookies (Butter)", price:"₱339", desc:"Classic butter shortbread.", img:"images/flavors/flavors24.png", images:["images/flavors/flavors24.png","images/flavors/flavors24a.png"], category:"flavors", rating:4.9, reviews:20, bullets:["Perfect for cravings"] },
      { name:"Shortbread Cookies (Queso de Bola)", price:"₱359", desc:"Queso de Bola shortbread.", img:"images/flavors/flavors25.png", images:["images/flavors/flavors25.png","images/flavors/flavors25a.png"], category:"flavors", rating:5, reviews:21, bullets:["Perfect for cravings"] },

      /* ACCESSORIES */
      { name:"Sunglasses Cork Case", price:"₱600", desc:"Fold-flat cork eyewear case.", img:"images/accessories/accessories4.png", images:["images/accessories/accessories4.png","images/accessories/accessories4a.png"], category:"accessories", rating:4.5, reviews:18, bullets:["Eco-friendly","Scratch-safe lining"] },
      { name:"Firebend 02 Bamboo Shades", price:"₱4,000", desc:"Polarized bamboo sunglasses.", img:"images/accessories/accessories3.png", images:["images/accessories/accessories3.png","images/accessories/accessories3a.png"], category:"accessories", rating:4.6, reviews:31, bullets:["UV-blocking","Handmade"] },
      { name:"Alfombra Slippers with Beads", price:"₱350", desc:"Cozy beaded slippers.", img:"images/accessories/accessories5.png", images:["images/accessories/accessories5.png","images/accessories/accessories5a.png"], category:"accessories", rating:4.3, reviews:12, bullets:["Cushioned","Slip-on"] },
      { name:"Higawa Beaded Earrings", price:"₱2,000", desc:"Delicate beaded earrings.", img:"images/accessories/accessories6.png", images:["images/accessories/accessories6.png","images/accessories/accessories6a.png"], category:"accessories", rating:4.7, reviews:22, bullets:["Lightweight","Empowers artisans"] },
      { name:"Elara Beaded Earrings", price:"₱2,000", desc:"Celestial beadwork earrings.", img:"images/accessories/accessories7.png", images:["images/accessories/accessories7.png","images/accessories/accessories7a.png","images/accessories/accessories7b.png"], category:"accessories", rating:4.6, reviews:19, bullets:["Sparkling","Nickel-safe"] },
      { name:"Punuan Beaded Earrings", price:"₱2,000", desc:"Earth-tone artisanal earrings.", img:"images/accessories/accessories8.png", images:["images/accessories/accessories8.png","images/accessories/accessories8a.png"], category:"accessories", rating:4.5, reviews:17, bullets:["Nature-inspired","Light fit"] },
      { name:"Straw Headband Sunvisor", price:"₱250", desc:"Breathable foldable sunvisor.", img:"images/accessories/accessories9.png", images:["images/accessories/accessories9.png","images/accessories/accessories9a.png","images/accessories/accessories9b.png"], category:"accessories", rating:4.4, reviews:26, bullets:["Wide brim","Packs flat"] },
      { name:"Flat Head Hat", price:"₱300", desc:"Foldable wide-brim hat.", img:"images/accessories/accessories10.png", images:["images/accessories/accessories10.png","images/accessories/accessories10a.png","images/accessories/accessories10b.png"], category:"accessories", rating:4.3, reviews:21, bullets:["Packable","Breathable"] },
      { name:"Slides with Lace Strap", price:"₱250", desc:"House slides with lace-look strap.", img:"images/accessories/accessories11.png", images:["images/accessories/accessories11.png"], category:"accessories", rating:4.2, reviews:14, bullets:["Lightweight","Local materials"] },
      { name:"Native Abaca Headband", price:"₱200", desc:"Textured abaca headband.", img:"images/accessories/accessories12.png", images:["images/accessories/accessories12.png","images/accessories/accessories12a.png","images/accessories/accessories12b.png"], category:"accessories", rating:4.4, reviews:28, bullets:["Handwoven","Everyday neutral"] },

      /* BAGS */
      { name:"Bayong Bag", price:"₱1,600", desc:"Sustainable woven bayong bag.", img:"images/bags/bag1.png", images:["images/bags/bag1.png","images/bags/bag1a.png","images/bags/bag1b.png"], category:"bags", rating:4.6, reviews:18, bullets:["Eco-friendly","Durable weave"] },
      { name:"Buntal Shoulder Bag", price:"₱2,000", desc:"Lightweight Buri palm shoulder bag.", img:"images/bags/bag2.png", images:["images/bags/bag2.png","images/bags/bag2a.png","images/bags/bag2b.png"], category:"bags", rating:4.4, reviews:12, bullets:["Handwoven","Comfortable strap"] },
      { name:"Pandan Tote Bag", price:"₱300", desc:"Tropical pandan tote.", img:"images/bags/bag3.png", images:["images/bags/bag3.png","images/bags/bag3a.png","images/bags/bag3b.png"], category:"bags", rating:4.2, reviews:10, bullets:["Natural pandan","Zippered"] },
      { name:"Flower Square Handbag", price:"₱3,000", desc:"Chic floral square handbag.", img:"images/bags/bag4.png", images:["images/bags/bag4.png","images/bags/bag4a.png"], category:"bags", rating:4.7, reviews:15, bullets:["Premium Tikog","Zipper closure"] },
      { name:"Buntal Long Clutch Bag", price:"₱1,500", desc:"Sleek Buri palm clutch.", img:"images/bags/bag5.png", images:["images/bags/bag5.png","images/bags/bag5a.png"], category:"bags", rating:4.5, reviews:14, bullets:["Magnetic flap","Detachable chain"] },
      { name:"Mother of Pearl Clutch Bag", price:"₱6,000", desc:"Elegant mother-of-pearl clutch.", img:"images/bags/bag7.png", images:["images/bags/bag7.png","images/bags/bag7a.png"], category:"bags", rating:4.9, reviews:22, bullets:["Genuine shell","Gold chain sling"] },
      { name:"Sinamay Gift Bag", price:"₱100", desc:"Native gift bag, Sinamay & Abaca.", img:"images/bags/bag8.png", images:["images/bags/bag8.png","images/bags/bag8a.png"], category:"bags", rating:4.3, reviews:8, bullets:["Reusable","Biodegradable"] },
      { name:"Banig Tote Bag", price:"₱500", desc:"Colorful banig tote.", img:"images/bags/bag9.png", images:["images/bags/bag9.png","images/bags/bag9a.png"], category:"bags", rating:4.4, reviews:11, bullets:["Magnetic closure","Dual handle"] },
      { name:"Raffia Tote Bag", price:"₱1,500", desc:"Playful multicolor raffia tote.", img:"images/bags/bag10.png", images:["images/bags/bag10.png","images/bags/bag10a.png","images/bags/bag10b.png"], category:"bags", rating:4.6, reviews:17, bullets:["Natural raffia","Inner pocket"] },
      { name:"Tikog Handbag", price:"₱3,000", desc:"Tikog handbag with flowers.", img:"images/bags/bag11.png", images:["images/bags/bag11.png","images/bags/bag11a.png","images/bags/bag11b.png"], category:"bags", rating:4.8, reviews:21, bullets:["Woven Tikog","Double handle"] },

      /* CLOTHING */
      { name:"Bolero", price:"₱2,400", desc:"Elegant handmade bolero (Cavite).", img:"images/clothing/clothing1.png", images:["images/clothing/clothing1.png"], category:"clothing", rating:4.8, reviews:12, bullets:["Light fabric","Formal/semi-formal"] },
      { name:"Men's Cocoon Fully Callado Barong", price:"₱10,000", desc:"Cocoon barong with callado.", img:"images/clothing/clothing2.png", images:["images/clothing/clothing2.png","images/clothing/clothing2a.png","images/clothing/clothing2b.png","images/clothing/clothing2c.png"], category:"clothing", rating:4.9, reviews:20, bullets:["Cocoon silk","Classic"] },
      { name:"Aisha Dress", price:"₱1,500", desc:"Dress in Habing Maragondon + cotton linen.", img:"images/clothing/clothing3.png", images:["images/clothing/clothing3.png","images/clothing/clothing3a.png"], category:"clothing", rating:4.7, reviews:9, bullets:["Light & breathable"] },
      { name:"V-Neck Top", price:"₱1,000", desc:"V-neck top (Habing Maragondon).", img:"images/clothing/clothing4.png", images:["images/clothing/clothing4.png"], category:"clothing", rating:4.5, reviews:8, bullets:["Versatile","Comfortable"] },
      { name:"Victoria Top", price:"₱1,200", desc:"Top with Habing Maragondon.", img:"images/clothing/clothing5.png", images:["images/clothing/clothing5.png","images/clothing/clothing5a.png"], category:"clothing", rating:4.6, reviews:10, bullets:["Breathable","Modern Filipiniana"] },
      { name:"Erika Top", price:"₱2,000", desc:"Modern Filipiniana top.", img:"images/clothing/clothing6.png", images:["images/clothing/clothing6.png","images/clothing/clothing6a.png"], category:"clothing", rating:4.8, reviews:14, bullets:["Structured fit"] },
      { name:"Jacket", price:"₱1,400", desc:"Habing Maragondon + taffeta jacket.", img:"images/clothing/clothing7.png", images:["images/clothing/clothing7.png","images/clothing/clothing7a.png"], category:"clothing", rating:4.4, reviews:7, bullets:["Lightweight","Layering"] },
      { name:"Rhea Top", price:"₱1,200", desc:"Habing Maragondon + cotton linen.", img:"images/clothing/clothing8.png", images:["images/clothing/clothing8.png","images/clothing/clothing8a.png"], category:"clothing", rating:4.5, reviews:9, bullets:["Daily wear"] },
      { name:"Malou Skirt", price:"₱1,500", desc:"A-line skirt (Habing + cotton linen).", img:"images/clothing/clothing9.png", images:["images/clothing/clothing9.png","images/clothing/clothing9a.png"], category:"clothing", rating:4.6, reviews:11, bullets:["Flowy","Elegant"] },
      { name:"Fatima Top", price:"₱1,500", desc:"Soft blouse (Habing + cotton linen).", img:"images/clothing/clothing10.png", images:["images/clothing/clothing10.png","images/clothing/clothing10a.png","images/clothing/clothing10b.png"], category:"clothing", rating:4.7, reviews:10, bullets:["Feminine fit"] },
      { name:"Gabriela Bolero", price:"₱3,000", desc:"Filipiniana-inspired bolero.", img:"images/clothing/clothing11.png", images:["images/clothing/clothing11.png","images/clothing/clothing11a.png","images/clothing/clothing11b.png"], category:"clothing", rating:4.9, reviews:19, bullets:["Statement piece"] },
      { name:"Poncho", price:"₱1,800", desc:"Cozy poncho (Habing Maragondon).", img:"images/clothing/clothing12.png", images:["images/clothing/clothing12.png"], category:"clothing", rating:4.6, reviews:8, bullets:["Warm & soft"] },

      /* HOME */
      { name:"Handwoven Bath Towels", price:"₱1,000", desc:"Soft, absorbent handwoven towels.", img:"images/home/home1.png", images:["images/home/home1.png","images/home/home1a.png","images/home/home1b.png"], category:"home", rating:4.6, reviews:12, bullets:["Eco yarns","Craftsmanship"] },
      { name:"Napkin Ring Floral", price:"₱800", desc:"Decorative floral napkin ring.", img:"images/home/home2.png", images:["images/home/home2.png","images/home/home2a.png"], category:"home", rating:4.4, reviews:9, bullets:["Festive","Sustainable"] },
      { name:"Mother of Pearl Utility Dish", price:"₱2,000", desc:"Shell-inlay utility dish.", img:"images/home/home3.png", images:["images/home/home3.png","images/home/home3a.png"], category:"home", rating:4.8, reviews:14, bullets:["Genuine shell","Elegant"] },
      { name:"Atin Reed Diffuser", price:"₱900", desc:"Marine, jasmine & woody notes.", img:"images/home/home4.png", images:["images/home/home4.png","images/home/home4a.png"], category:"home", rating:4.5, reviews:10, bullets:["Calming","Natural oils"] },
      { name:"Banana Bark Picture Frame", price:"₱1,500", desc:"Banana bark frame w/ gold detail.", img:"images/home/home5.png", images:["images/home/home5.png","images/home/home5a.png"], category:"home", rating:4.3, reviews:8, bullets:["Fits 5×7","Sustainable"] },
      { name:"Bamboo Woven Storage", price:"₱3,000", desc:"Handcrafted bamboo organizer.", img:"images/home/home6.png", images:["images/home/home6.png","images/home/home6a.png"], category:"home", rating:4.7, reviews:11, bullets:["Lightweight","Durable"] },
      { name:"Coco Planter", price:"₱2,000", desc:"Planter inspired by coconut tree.", img:"images/home/home7.png", images:["images/home/home7.png","images/home/home7a.png"], category:"home", rating:4.6, reviews:10, bullets:["Natural rattan","Indoor plants"] },
      { name:"Plain Acacia Mug", price:"₱6,000", desc:"Rustic acacia wood mug.", img:"images/home/home8.png", images:["images/home/home8.png"], category:"home", rating:4.5, reviews:9, bullets:["Durable","Natural grain"] },
      { name:"Manila Ceramic Mug", price:"₱200", desc:"Mug with wood handle & PH prints.", img:"images/home/home9.png", images:["images/home/home9.png"], category:"home", rating:4.4, reviews:12, bullets:["Vibrant design","Durable"] },
      { name:"Acacia Wood Salad Tosser", price:"₱350", desc:"Solid acacia salad tossers.", img:"images/home/home10.png", images:["images/home/home10.png","images/home/home10a.png"], category:"home", rating:4.5, reviews:11, bullets:["Ergonomic","Sustainable"] },
      { name:"Acacia Wood Rectangle Plate", price:"₱500", desc:"Rectangular acacia plate.", img:"images/home/home11.png", images:["images/home/home11.png","images/home/home11a.png","images/home/home11b.png"], category:"home", rating:4.6, reviews:10, bullets:["Handmade","Food-safe"] },
      { name:"Round Acacia Coaster", price:"₱600", desc:"Set of six acacia coasters.", img:"images/home/home12.png", images:["images/home/home12.png","images/home/home12a.png","images/home/home12b.png"], category:"home", rating:4.7, reviews:13, bullets:["Eco-friendly","Durable"] },
      { name:"Acacia Wood Round Plate", price:"₱300", desc:"8-inch acacia round plate.", img:"images/home/home13.png", images:["images/home/home13.png"], category:"home", rating:4.5, reviews:9, bullets:["Reusable","Polished"] },
      { name:"Titanic Boat Shape Nito Tray", price:"₱700", desc:"Nito tray shaped like a boat.", img:"images/home/home14.png", images:["images/home/home14.png","images/home/home14a.png","images/home/home14b.png"], category:"home", rating:4.8, reviews:15, bullets:["Handcrafted","Tropical charm"] },

      /* CHRISTMAS */
      { name:"Santa Ornament", price:"₱479", desc:"Pinoy-themed Santa ornament.", img:"images/christmas/christmas1.png", images:["images/christmas/christmas1.png","images/christmas/christmas1a.png"], category:"christmas", rating:4.7, reviews:18, bullets:["Hand-painted","Lightweight"] },
      { name:"Santa Stockings", price:"₱295", desc:"Habing Maragondon stockings.", img:"images/christmas/christmas2.png", images:["images/christmas/christmas2.png","images/christmas/christmas2a.png"], category:"christmas", rating:4.4, reviews:22, bullets:["Festive","Durable"] },
      { name:"Christmas Parol", price:"₱900", desc:"Foldable parol by Kababaihan ng Maynila.", img:"images/christmas/christmas3.png", images:["images/christmas/christmas3.png","images/christmas/christmas3a.png"], category:"christmas", rating:4.8, reviews:41, bullets:["61 cm","Foldable"] },
      { name:"Magnolia Queso De Bola", price:"₱300", desc:"Classic holiday queso de bola.", img:"images/christmas/christmas4.png", images:["images/christmas/christmas4.png","images/christmas/christmas4a.png"], category:"christmas", rating:4.6, reviews:35, bullets:["Rich & tangy"] },
      { name:"Christmas Ornament (Kape at Pandesal)", price:"₱479", desc:"Mini Santa with kape & pandesal.", img:"images/christmas/christmas5.png", images:["images/christmas/christmas5.png","images/christmas/christmas5a.png","images/christmas/christmas5b.png"], category:"christmas", rating:4.5, reviews:19, bullets:["Thread hanger","Cute gift"] },
      { name:"Santa Candy Tray", price:"₱500", desc:"Mini Santa holding a tray.", img:"images/christmas/christmas6.png", images:["images/christmas/christmas6.png","images/christmas/christmas6a.png","images/christmas/christmas6b.png"], category:"christmas", rating:4.4, reviews:16, bullets:["Resin+abaca","H8.5×L27×W25cm"] },
      { name:"Capiz Orn with Jeep", price:"₱300", desc:"Capiz Santa + Jeepney ornament.", img:"images/christmas/christmas7.png", images:["images/christmas/christmas7.png"], category:"christmas", rating:4.6, reviews:24, bullets:["3.75×3.375×0.125in"] },
      { name:"Capiz Orn with Kalabaw", price:"₱300", desc:"Capiz Santa + kalabaw ornament.", img:"images/christmas/christmas8.png", images:["images/christmas/christmas8.png"], category:"christmas", rating:4.6, reviews:21, bullets:["Capiz material"] },
      { name:"Natural Christmas Wreath", price:"₱900", desc:"Twig wreath with lights.", img:"images/christmas/christmas9.png", images:["images/christmas/christmas9.png"], category:"christmas", rating:4.7, reviews:28, bullets:["16 inches","Handcrafted"] },
      { name:"Fruit Basket", price:"₱900", desc:"Mr. Santa with fruit basket.", img:"images/christmas/christmas10.png", images:["images/christmas/christmas10.png","images/christmas/christmas10a.png","images/christmas/christmas10b.png"], category:"christmas", rating:4.3, reviews:12, bullets:["40×28×30 cm"] },
      { name:"Mini Parol Ornament (Set of 2)", price:"₱350", desc:"Set of 2 capiz mini parols.", img:"images/christmas/christmas11.png", images:["images/christmas/christmas11.png","images/christmas/christmas11a.png"], category:"christmas", rating:4.6, reviews:26, bullets:["Lightweight","Glossy"] },
      { name:"Welcome Hanging Board", price:"₱650", desc:"Santa with ‘Merry Christmas’ board.", img:"images/christmas/christmas12.png", images:["images/christmas/christmas12.png","images/christmas/christmas12a.png"], category:"christmas", rating:4.5, reviews:17, bullets:["Native accents","Wood lettering"] },
      { name:"Capiz Star Ornaments", price:"₱350", desc:"Capiz stars in Natural or Red.", img:"images/christmas/christmas13.png", images:["images/christmas/christmas13.png","images/christmas/christmas13a.png","images/christmas/christmas13b.png"], category:"christmas", rating:4.7, reviews:33, bullets:["Lightweight","Classic"] },
      { name:"Cebu Best Mango Chocolate", price:"₱699", desc:"Dried mango dipped in dark chocolate.", img:"images/christmas/christmas14.png", images:["images/christmas/christmas14.png","images/christmas/christmas14a.png","images/christmas/christmas14b.png","images/christmas/christmas14c.png"], category:"christmas", rating:4.7, reviews:33, bullets:["12 count","14×14×3cm"] },
      { name:"Cebu Best Dried Mangoes", price:"₱339", desc:"Premium dried mangoes from Cebu.", img:"images/christmas/christmas15.png", images:["images/christmas/christmas15.png","images/christmas/christmas15a.png"], category:"christmas", rating:4.7, reviews:33, bullets:["180g"] },
      { name:"Audrey's Coconut Otap", price:"₱259", desc:"Crispy, flaky otap with coconut.", img:"images/christmas/christmas16.png", images:["images/christmas/christmas16.png","images/christmas/christmas16a.png","images/christmas/christmas16b.png"], category:"christmas", rating:4.7, reviews:33, bullets:["Authentic Cebu taste"] },

      /* CRAFTS */
      { name:"Model Jeepney", price:"₱200", desc:"Handcrafted miniature Jeepney.", img:"images/crafts/crafts1.png", images:["images/crafts/crafts1.png","images/crafts/crafts1a.png","images/crafts/crafts1b.png"], category:"crafts", rating:4.8, reviews:26, bullets:["Native+recycled","Souvenir"] },
      { name:"Buri Round Fan", price:"₱100", desc:"Traditional buri fan.", img:"images/crafts/crafts2.png", images:["images/crafts/crafts2.png","images/crafts/crafts2a.png"], category:"crafts", rating:4.6, reviews:19, bullets:["Eco-friendly","Durable"] },
      { name:"Jusi Fabric Fan", price:"₱600", desc:"Jusi fabric hand fan, embroidered.", img:"images/crafts/crafts3.png", images:["images/crafts/crafts3.png","images/crafts/crafts3a.png","images/crafts/crafts3b.png"], category:"crafts", rating:4.7, reviews:22, bullets:["Elegant","Lightweight"] },
      { name:"Sigay Sungka", price:"₱500", desc:"Traditional sungka board game.", img:"images/crafts/crafts4.png", images:["images/crafts/crafts4.png","images/crafts/crafts4a.png"], category:"crafts", rating:4.8, reviews:28, bullets:["Solid wood","Sigay shells"] },
      { name:"Wooden Base Carabao", price:"₱400", desc:"Carabao + farmer figurine.", img:"images/crafts/crafts5.png", images:["images/crafts/crafts5.png","images/crafts/crafts5a.png","images/crafts/crafts5b.png"], category:"crafts", rating:4.5, reviews:14, bullets:["Gold tin + wood","15×5.5×4 cm"] },
      { name:"Mother of Pearl Cutwork", price:"₱2,000", desc:"Round MOP cutwork decor (Jeepney).", img:"images/crafts/crafts6.png", images:["images/crafts/crafts6.png","images/crafts/crafts6a.png","images/crafts/crafts6b.png"], category:"crafts", rating:4.9, reviews:31, bullets:["Genuine MOP","Polished"] },
    ];

    /* ------------- Utilities ------------- */
    const grid = document.getElementById('grid');
    const pager = document.getElementById('pager');
    const fSearch = document.getElementById('fSearch');
    const fCategory = document.getElementById('fCategory');
    const fSort = document.getElementById('fSort');
    const fReset = document.getElementById('fReset');

    const PER_PAGE = 48;
    let currentPage = 1;

    const pesoToNumber = (p) => Number(String(p).replace(/[^\d.]/g,'')||0);

    function isClothing(item){
      return (item.category||'').toLowerCase() === 'clothing' ||
             (item.img||'').toLowerCase().includes('/clothing/') ||
             /(barong|bolero|shirt|dress|top|blouse|pants|trousers|skirt|coat|jacket)/i.test(item.name||'');
    }

    function starsHTML(r){
      const full = Math.floor(r||0);
      const half = (r - full >= 0.25 && r - full < 0.75) ? 1 : 0;
      const roundedFull = half ? full : Math.round(r||0);
      let html = '';
      for (let i = 0; i < roundedFull; i++) html += '<i class="fa-solid fa-star"></i>';
      if (half) html += '<i class="fa-solid fa-star-half-stroke"></i>';
      while ((html.match(/fa-star/g) || []).length < 5) html += '<i class="fa-regular fa-star"></i>';
      return html;
    }

    function slugify(s){
      return String(s||'').toLowerCase().replace(/[^a-z0-9]+/g,'-').replace(/(^-|-$)/g,'');
    }

    function toAbs(p){ try { return new URL(p, window.location.href).href; } catch { return p; } }

    function goToProductDetail(data){
      const payload = {
        ...data,
        img: toAbs(data.img),
        images: (Array.isArray(data.images) ? data.images : [data.img]).map(toAbs)
      };
      localStorage.setItem('productDetail', JSON.stringify(payload));
      window.location.href = PRODUCT_PAGE;
    }

    /* ------------- Filtering / Sorting ------------- */
    function getFiltered(){
      const term = (fSearch.value||'').toLowerCase().trim();
      const cat = (fCategory.value||'').toLowerCase();

      let list = PRODUCTS.slice();

      if (cat) list = list.filter(p => (p.category||'').toLowerCase() === cat);
      if (term) list = list.filter(p =>
        (p.name||'').toLowerCase().includes(term) ||
        (p.desc||'').toLowerCase().includes(term)
      );

      switch (fSort.value){
        case 'price-asc':
          list.sort((a,b)=> pesoToNumber(a.price) - pesoToNumber(b.price)); break;
        case 'price-desc':
          list.sort((a,b)=> pesoToNumber(b.price) - pesoToNumber(a.price)); break;
        case 'name-asc':
          list.sort((a,b)=> (a.name||'').localeCompare(b.name||'')); break;
        case 'name-desc':
          list.sort((a,b)=> (b.name||'').localeCompare(a.name||'')); break;
        default: /* featured */ break;
      }
      return list;
    }

    function renderPager(total){
      pager.innerHTML = '';
      const pages = Math.max(1, Math.ceil(total / PER_PAGE));

      const btnPrev = document.createElement('button');
      btnPrev.textContent = '‹';
      btnPrev.disabled = currentPage <= 1;
      btnPrev.addEventListener('click', ()=> { currentPage = Math.max(1, currentPage-1); paint(); });
      pager.appendChild(btnPrev);

      for (let p=1; p<=pages; p++){
        const b = document.createElement('button');
        b.textContent = p;
        if (p === currentPage) b.classList.add('active');
        b.addEventListener('click', ()=> { currentPage = p; paint(); });
        pager.appendChild(b);
      }

      const btnNext = document.createElement('button');
      btnNext.textContent = '›';
      btnNext.disabled = currentPage >= pages;
      btnNext.addEventListener('click', ()=> { currentPage = Math.min(pages, currentPage+1); paint(); });
      pager.appendChild(btnNext);
    }

    /* ---- RENDER GRID (with wishlist heart) ---- */
    function paint(){
      const list = getFiltered();
      renderPager(list.length);
      const start = (currentPage - 1) * PER_PAGE;
      const items = list.slice(start, start + PER_PAGE);

      grid.innerHTML = '';
      items.forEach((p, i)=>{
        const idx = start + i; // index in filtered list
        const wishData = `
          data-id="${slugify(p.name)}"
          data-name="${p.name}"
          data-price="${p.price}"
          data-img="${toAbs(p.img)}"
          data-desc="${(p.desc||'').replace(/"/g,'&quot;')}"
          data-url="${location.href}"
        `;
        const card = document.createElement('article');
        card.className = 'card';
        card.innerHTML = `
          <a class="img-wrap product-link" href="#" data-idx="${idx}">
            <img src="${p.img}" alt="${p.name}">
          </a>

          <!-- ❤️ Favorites button (picked up by wishlist.js) -->
          <button type="button" class="wishlist-btn" aria-label="Add to favorites" ${wishData}>
            <i class="fa-regular fa-heart"></i>
          </button>

          <button type="button" class="quick-btn" data-qv="${idx}">Quick View</button>
          <div class="body">
            <a class="product-link" href="#" data-idx="${idx}">
              <p class="name">${p.name}</p>
            </a>
            <p class="price">${p.price}</p>
            <div class="meta">
              <span>${(p.category||'').charAt(0).toUpperCase() + (p.category||'').slice(1)}</span>
              <span class="stars" title="${p.rating||0}">${starsHTML(p.rating||0)}</span>
            </div>
          </div>
        `;
        grid.appendChild(card);
      });
    }
    // expose for the ?cat= pre-filter script
    window.paint = paint;
    window.currentPage = currentPage;

    function productByFilteredIndex(filteredIndex){
      const list = getFiltered();
      return list[filteredIndex];
    }

    /* ------------- Quick View ------------- */
    const qvOverlay = document.getElementById('qvOverlay');
    const qvModal   = document.getElementById('qvModal');
    const qvImg     = document.getElementById('qvImg');
    const qvName    = document.getElementById('qvName');
    const qvPrice   = document.getElementById('qvPrice');
    const qvDesc    = document.getElementById('qvDesc');
    const qvClose   = document.getElementById('qvClose');
    const qvAdd     = document.getElementById('qvAdd');
    const qvView    = document.getElementById('qvView');
    const qvQty     = document.getElementById('qvQty');
    const qvDec     = document.getElementById('qvDec');
    const qvInc     = document.getElementById('qvInc');
    const qvStock   = document.getElementById('qvStock');
    const qvRating  = document.getElementById('qvRating');
    const qvSizeWrap= document.getElementById('qvSizeWrap');

    let currentFilteredIndex = null;

    function openQVByIndex(filteredIdx){
      currentFilteredIndex = filteredIdx;
      const p = productByFilteredIndex(filteredIdx);
      if (!p) return;

      qvImg.src   = p.img;
      qvImg.alt   = p.name;
      qvName.textContent  = p.name;
      qvPrice.textContent = p.price;
      qvDesc.textContent  = p.desc || '';
      qvQty.value = 1;
      qvRating.innerHTML = starsHTML(p.rating || 0);
      qvStock.hidden = true;

      // Size for clothing only
      qvSizeWrap.hidden = !isClothing(p);
      document.querySelectorAll('input[name="qvSize"]').forEach(r => r.checked = false);

      qvOverlay.classList.add('active');
      qvModal.classList.add('active');
      document.body.classList.add('lock-scroll');
      qvClose.focus();
    }

    function closeQV(){
      qvOverlay.classList.remove('active');
      qvModal.classList.remove('active');
      document.body.classList.remove('lock-scroll');
      currentFilteredIndex = null;
    }

    function getChosenQVSize(){
      const r = Array.from(document.querySelectorAll('input[name="qvSize"]')).find(x=>x.checked);
      return r ? r.value : null;
    }

    // Open QV
    document.addEventListener('click', (e)=>{
      const btn = e.target.closest('button[data-qv]');
      if (!btn) return;
      e.preventDefault();
      openQVByIndex(Number(btn.dataset.qv));
    });

    // Qty controls
    qvDec.addEventListener('click', ()=>{ qvQty.value = Math.max(1, (parseInt(qvQty.value)||1)-1); });
    qvInc.addEventListener('click', ()=>{ qvQty.value = (parseInt(qvQty.value)||1)+1; });

    // Add to cart from QV (use global cart.js API)
    qvAdd.addEventListener('click', ()=>{
      if (currentFilteredIndex == null) return;
      const p = productByFilteredIndex(currentFilteredIndex);
      const clothing = isClothing(p);
      let chosenSize = null;
      if (clothing) {
        chosenSize = getChosenQVSize();
        if (!chosenSize) { alert('Please choose a size.'); return; }
      }

      window.addToCart({
        id: slugify(p.name),
        baseName: p.name,
        name: clothing && chosenSize ? `${p.name} (Size: ${chosenSize})` : p.name,
        img: toAbs(p.img),
        price: p.price,
        desc: p.desc || '',
        size: chosenSize || null,
        quantity: Math.max(1, parseInt(qvQty.value)||1)
      });
      window.openCartDrawer?.();
      closeQV();
    });

    // View details from QV
    qvView.addEventListener('click', ()=>{
      if (currentFilteredIndex == null) return;
      const p = productByFilteredIndex(currentFilteredIndex);
      const clothing = isClothing(p);
      const chosenSize = clothing ? getChosenQVSize() : null;

      goToProductDetail({
        img: p.img,
        images: Array.isArray(p.images) && p.images.length ? p.images : [p.img],
        name: p.name,
        price: p.price,
        desc: p.desc || '',
        rating: p.rating || 0,
        reviewsCount: p.reviews || 0,
        bullets: p.bullets || [],
        preselectedSize: chosenSize,
        category: p.category || ''
      });
    });

    // Close QV
    qvClose.addEventListener('click', closeQV);
    qvOverlay.addEventListener('click', closeQV);
    document.addEventListener('keydown', (e)=>{ if(e.key==='Escape' && qvModal.classList.contains('active')) closeQV(); });

    /* ------------- Card click -> product page ------------- */
    document.addEventListener('click', (e)=>{
      const link = e.target.closest('.product-link');
      if (!link) return;
      e.preventDefault();
      const filteredIdx = Number(link.dataset.idx);
      const p = productByFilteredIndex(filteredIdx);
      if (!p) return;

      goToProductDetail({
        img: p.img,
        images: Array.isArray(p.images) && p.images.length ? p.images : [p.img],
        name: p.name,
        price: p.price,
        desc: p.desc || '',
        rating: p.rating || 0,
        reviewsCount: p.reviews || 0,
        bullets: p.bullets || [],
        preselectedSize: null,
        category: p.category || ''
      });
    });

    /* ------------- Filters / Reset ------------- */
    fSearch.addEventListener('input', ()=>{ currentPage = 1; paint(); });
    fCategory.addEventListener('change', ()=>{ currentPage = 1; paint(); });
    fSort.addEventListener('change', ()=>{ currentPage = 1; paint(); });
    fReset.addEventListener('click', ()=>{
      fSearch.value = '';
      fCategory.value = '';
      fSort.value = 'featured';
      currentPage = 1;
      paint();
    });

    /* ------------- Init ------------- */
    paint();
  </script>

  <!-- Load global cart API (window.addToCart, window.openCartDrawer) -->
  <script src="cart.js"></script>

  <script>
    // Lock page scroll when cart drawer toggles
    document.addEventListener('DOMContentLoaded', function () {
      const drawer = document.getElementById('cdDrawer');
      const toggleLock = () => {
        document.body.classList.toggle('lock-scroll', drawer.classList.contains('active'));
      };
      new MutationObserver(toggleLock).observe(drawer, { attributes: true, attributeFilter: ['class'] });
    });

    /* Read ?cat=... and pre-filter the grid */
    (function () {
      try {
        const p = new URLSearchParams(location.search);
        const cat = (p.get('cat') || '').toLowerCase();
        if (!cat) return;
        const sel = document.getElementById('fCategory');
        if (sel) {
          const map = {
            'flavors':'flavors','accessories':'accessories','bags':'bags',
            'clothing':'clothing','home':'home','crafts':'crafts','christmas':'christmas'
          };
          sel.value = map[cat] || cat;
          sel.dispatchEvent(new Event('change'));
        }
        history.replaceState({}, '', location.pathname);
      } catch (e) {}
    })();
  </script>
</body>
</html>
