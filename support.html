<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Lokal • Support</title>

  <!-- Site styles & icons -->
  <link rel="stylesheet" href="style.css">
  <link rel="stylesheet" href="wishlist.css">
  <link rel="stylesheet" href="cart.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css" crossorigin="anonymous"/>

  <style>
    :root{
      --ink:#2b1f1a; --muted:#7a6f68; --line:#D7D6AA; --brand:#6A6932;
      --brand-2:#8A8841; --brand-3:#A9A74F; --chip:#E6E5CA; --card:#fff;
      --hero-start:#BAB86C; --hero-end:#E6E5CA; --ok:#166534; --err:#b91c1c;
    }
    body{font-family:system-ui,-apple-system,Segoe UI,Roboto,Inter,Arial,sans-serif; color:var(--ink); background:#fff;}
    a{color:var(--brand-2);}

    /* Hero */
    .hero{background:linear-gradient(180deg,var(--hero-start) 0%, var(--hero-end) 100%);color:var(--ink);padding:48px 20px;}
    .hero .wrap{max-width:1100px;margin:0 auto;display:grid;grid-template-columns:1.4fr .9fr;gap:24px;align-items:center;}
    .hero h1{font-size:2.4rem;margin:0 0 8px;}
    .hero p{opacity:.95;margin:0 0 16px;}
    .hero .stats{display:flex;gap:18px;flex-wrap:wrap;margin-top:10px;}

    .chip{background:var(--chip);border:1px solid var(--line);color:var(--ink);padding:8px 12px;border-radius:999px;font-weight:700;}

    .hero-card{background:#ffffffd9;border:1px solid rgba(0,0,0,.06);backdrop-filter: blur(6px);border-radius:16px;padding:18px; color:#1f2937;}
    .hero-card h3{margin:0 0 8px;font-size:1.05rem}
    .hero-card p{margin:0 0 8px;color:#475569}
    .hero-card .row{display:flex;gap:10px;flex-wrap:wrap}
    .hero-card .btn,
    .btn{height:46px;padding:0 18px;border-radius:10px;border:0;background:var(--brand);color:#fff;font-weight:800;cursor:pointer;transition:filter .15s, background .15s;}
    .hero-card .btn:hover, .btn:hover{background:var(--brand-2);}
    .hero-card .ghost{background:#fff;border:1px solid var(--line);color:var(--brand);}

    /* Quick links */
    .wrap{max-width:1100px;margin:32px auto;padding:0 20px;}
    .quick{display:grid;grid-template-columns:repeat(3,1fr);gap:18px;margin-top:-24px;}
    @media (max-width:880px){.hero .wrap{grid-template-columns:1fr}.quick{grid-template-columns:1fr 1fr}}
    @media (max-width:560px){.quick{grid-template-columns:1fr}}
    .qcard{background:#fff;border:1px solid var(--line);border-radius:16px; padding:16px; display:flex; gap:12px; align-items:flex-start;transition: box-shadow .2s, transform .2s, border-color .2s; text-decoration:none; color:inherit;}
    .qcard:hover{transform:translateY(-2px); box-shadow:0 10px 20px rgba(0,0,0,.06); border-color:#e2ddd5;}
    .qcard i{font-size:22px;color:var(--brand);min-width:26px; margin-top:2px;}
    .qcard h3{margin:0 0 6px;font-size:1.05rem}
    .qcard p{margin:0;color:var(--muted)}

    /* FAQ */
    .faq-head{display:flex;flex-wrap:wrap;gap:12px;align-items:center;justify-content:space-between;margin:12px 0 10px;}
    .faq-head h2{margin:0}
    .faq-search{flex:1;min-width:260px;display:flex;align-items:center;gap:10px;border:1px solid var(--line);border-radius:12px;padding:10px 12px;background:#fff;}
    .faq-search input{border:0;outline:0;width:100%;font-size:1rem;}
    .accordion{border:1px solid var(--line);border-radius:14px;overflow:hidden;background:#fff}
    .faq-item{border-top:1px solid var(--line)}
    .faq-item:first-child{border-top:0}
    .faq-btn{width:100%; text-align:left; background:#fff; border:0; padding:16px 18px; cursor:pointer; display:flex; justify-content:space-between; gap:16px;font-weight:800; color:#1f2937;}
    .faq-btn:hover{ background: transparent; }
    .faq-btn i{transition:transform .18s ease}
    .faq-btn[aria-expanded="true"] i{transform:rotate(180deg)}
    .faq-panel{display:none;padding:0 18px 18px;color:#475569;line-height:1.6}
    .faq-item.open .faq-panel{display:block}

    /* Policy tiles */
    .policies{display:grid;grid-template-columns:repeat(3,1fr);gap:16px;margin-top:20px;}
    @media (max-width:880px){.policies{grid-template-columns:1fr 1fr}}
    @media (max-width:560px){.policies{grid-template-columns:1fr}}
    .tile{background:#fff;border:1px solid var(--line);border-radius:14px;padding:16px;}
    .tile h3{margin:0 0 6px}
    .tile p, .tile ul{margin:0;color:#475569}
    .tile ul{padding-left:18px;margin-top:6px}

    /* Contact form */
    .contact{display:grid;grid-template-columns:1.1fr .9fr;gap:18px;margin-top:26px;}
    @media (max-width:920px){.contact{grid-template-columns:1fr}}
    form{padding:18px;border:1px solid var(--line);border-radius:14px;background:#fff;box-shadow:0 2px 8px rgba(0,0,0,.03);}
    label{display:block;font-weight:800;margin:10px 0 6px}
    .row{display:grid;grid-template-columns:1fr 1fr;gap:12px}
    @media (max-width:560px){.row{grid-template-columns:1fr}}
    input,textarea,select{width:100%;padding:12px 14px;border:1px solid #d9d2cb;border-radius:10px;background:#fff;color:#222;font-size:16px;outline:none;transition:border-color .15s, box-shadow .15s;}
    textarea{min-height:140px;resize:vertical;}
    input:focus,textarea:focus,select:focus{border-color:var(--brand);box-shadow:0 0 0 4px rgba(106,105,50,.12);}
    .actions{display:flex;gap:10px;align-items:center;margin-top:14px}
    .note{color:var(--muted);font-size:.95rem}
    .status{margin-top:10px;font-weight:800}
    .status.ok{color:var(--ok)} .status.err{color:var(--err)}
    .cardy{border:1px solid var(--line);border-radius:14px;background:#fff;padding:16px}
    .cardy p{margin:4px 0}
    .hp{position:absolute;left:-5000px;top:auto;width:1px;height:1px;overflow:hidden;}

    /* Safety so hidden overlays never block the header */
    #cdOverlay[aria-hidden="true"], #cdDrawer[aria-hidden="true"]{ display:none!important; pointer-events:none!important; }
    .hi-tag{ pointer-events:none; }
  </style>
</head>

<body>
  <!-- ========== AUTH POPUP ========== -->
  <div class="lokal-auth la-overlay" id="lokalAuthOverlay" aria-hidden="true">
    <div class="la-modal" role="dialog" aria-modal="true" aria-labelledby="laTitle">
      <div class="la-head">
        <h3 id="laTitle" class="la-title">SIGN IN</h3>
        <button class="la-close" id="laClose" aria-label="Close">×</button>
      </div>
      <div class="la-body">
        <p class="la-intro">Sign in with your email or sign up to become a Lokal Member.</p>
        <form id="laEmailForm" novalidate>
          <label class="la-label" for="laEmail">Email <span style="color:#b02a37">*</span></label>
          <input class="la-input" id="laEmail" type="email" placeholder="Email" required />
          <button class="la-btn" type="submit">CONTINUE</button>
        </form>
        <form id="laPassForm" hidden novalidate>
          <label class="la-label" for="laPass">Password</label>
          <input class="la-input" id="laPass" type="password" placeholder="••••••" required minlength="6" />
          <button class="la-btn" type="submit">SIGN IN</button>
          <p class="la-sub"><a href="#" id="laBackEmail">Use another email</a></p>
        </form>
      </div>
      <div class="la-foot">
        <div class="la-mini"><i class="fa-solid fa-lock"></i> All data is kept secure (demo)</div>
        <a class="la-mlink" href="membership.html">Lokal Membership</a>
      </div>
    </div>
  </div>
  <!-- ========== /AUTH POPUP ========== -->

  <!-- ===== HEADER ===== -->
  <header class="header">
    <div class="logo">
      <a href="index.html" aria-label="Home">
        <img src="images/projectlogo.png" alt="logo">
      </a>
    </div>

    <div class="nav-center">
      <form class="site-search" action="search.html" method="GET">
        <i class="fa-solid fa-magnifying-glass"></i>
        <input type="search" name="q" placeholder="Search products, categories..." autocomplete="off" />
        <button type="submit">Search</button>
      </form>
      <nav class="main-links">
        <ul>
          <li><a href="best-pick/best-picks.html">Best Picks</a></li>
          <li><a href="shop-all.html">Shop All</a></li>
          <li><a href="support.html" class="active">Support</a></li>
        </ul>
      </nav>
    </div>

    <nav class="utils">
      <ul class="nav-links">
        <li><a href="#" aria-label="Account"><i class="fa-solid fa-user"></i></a></li>
        <li>
          <a href="#" id="openCart" aria-label="Open cart">
            <i class="fa-solid fa-cart-shopping"></i>
            <span class="cart-count">0</span>
          </a>
        </li>
        <li style="position: relative;">
          <a href="wishlist.html" aria-label="Favorites" id="wishlistLink">
            <i class="fa-regular fa-heart"></i>
            <span class="wishlist-count" id="wishlistCount">0</span>
          </a>
        </li>
        <li><a href="support.html" aria-label="Support"><i class="fa-solid fa-headset"></i></a></li>
      </ul>
    </nav>
  </header>

  <!-- HERO -->
  <section class="hero">
    <div class="wrap">
      <div>
        <h1>How can we help?</h1>
        <p>Find quick answers below or send us a message — we usually reply within <strong>24 hours</strong>.</p>
        <div class="stats">
          <span class="chip"><i class="fa-solid fa-clock"></i>&nbsp; Mon–Fri, 9am–6pm PHT</span>
          <span class="chip"><i class="fa-solid fa-envelope"></i>&nbsp; shoplokalphilippines@gmail.com</span>
        </div>
      </div>
      <div class="hero-card">
        <h3>Need help with an order?</h3>
        <p>Have your order number ready and we’ll sort it out fast.</p>
        <div class="row">
          <button class="btn" onclick="document.getElementById('supportForm').scrollIntoView({behavior:'smooth'})">Contact Support</button>
          <button class="btn ghost" onclick="document.getElementById('faq').scrollIntoView({behavior:'smooth'})">Browse FAQs</button>
        </div>
      </div>
    </div>
  </section>

  <!-- QUICK LINKS -->
  <section class="wrap quick" aria-label="Popular help topics">
    <a class="qcard" href="#shipping">
      <i class="fa-solid fa-truck"></i>
      <div>
        <h3>Shipping & Delivery</h3>
        <p>Where we ship, timelines, and tracking info.</p>
      </div>
    </a>
    <a class="qcard" href="#returns">
      <i class="fa-solid fa-rotate-left"></i>
      <div>
        <h3>Returns & Refunds</h3>
        <p>Eligibility window and how refunds are processed.</p>
      </div>
    </a>
    <a class="qcard" href="#contact">
      <i class="fa-solid fa-shield-heart"></i>
      <div>
        <h3>Product Support</h3>
        <p>Item quality issues or missing parts? We’ll fix it.</p>
      </div>
    </a>
  </section>

  <!-- FAQ -->
  <section id="faq" class="wrap" aria-label="Frequently Asked Questions">
    <div class="faq-head">
      <h2>Frequently Asked Questions</h2>
      <label class="faq-search" aria-label="Search FAQs">
        <i class="fa-solid fa-magnifying-glass"></i>
        <input id="faqSearch" type="search" placeholder="Search keywords: shipping, return, size…" />
      </label>
    </div>

    <div id="faqList" class="accordion">
      <div class="faq-item" id="shipping">
        <button class="faq-btn" aria-expanded="false" aria-controls="faq1">Where do you ship and how long does it take? <i class="fa-solid fa-chevron-down"></i></button>
        <div id="faq1" class="faq-panel">
          We currently ship within the Philippines. Most Metro Manila orders arrive in 2–4 business days; provincial 4–7 business days.
          You’ll receive a tracking link once your order ships.
        </div>
      </div>

      <div class="faq-item">
        <button class="faq-btn" aria-expanded="false" aria-controls="faq2">How much is shipping? <i class="fa-solid fa-chevron-down"></i></button>
        <div id="faq2" class="faq-panel">
          Shipping is calculated at checkout based on your address and cart weight. We occasionally run free-shipping promos — watch our homepage banners.
        </div>
      </div>

      <div class="faq-item" id="returns">
        <button class="faq-btn" aria-expanded="false" aria-controls="faq3">What’s your return & refund policy? <i class="fa-solid fa-chevron-down"></i></button>
        <div id="faq3" class="faq-panel">
          You can request a return within 7 days of delivery if the item is defective, damaged, or incorrect. We’ll arrange a replacement or issue a refund to your original payment method once the return is received/approved.
        </div>
      </div>

      <div class="faq-item">
        <button class="faq-btn" aria-expanded="false" aria-controls="faq4">I received the wrong/defective item. What should I do? <i class="fa-solid fa-chevron-down"></i></button>
        <div id="faq4" class="faq-panel">
          Sorry about that! Please contact us with your order number and photos of the issue. We’ll fix it ASAP with a replacement or refund.
        </div>
      </div>

      <div class="faq-item">
        <button class="faq-btn" aria-expanded="false" aria-controls="faq5">Can I change or cancel my order? <i class="fa-solid fa-chevron-down"></i></button>
        <div id="faq5" class="faq-panel">
          We can edit/cancel orders that haven’t shipped yet. Message us immediately with your order number and requested change.
        </div>
      </div>

      <div class="faq-item">
        <button class="faq-btn" aria-expanded="false" aria-controls="faq6">What payment methods do you accept? <i class="fa-solid fa-chevron-down"></i></button>
        <div id="faq6" class="faq-panel">
          We currently accept major credit/debit cards and local e-wallets (coming soon). Cash on Delivery may be offered on selected items/areas.
        </div>
      </div>

      <div class="faq-item">
        <button class="faq-btn" aria-expanded="false" aria-controls="faq7">Do you have size guides for clothing? <i class="fa-solid fa-chevron-down"></i></button>
        <div id="faq7" class="faq-panel">
          Yes — check the product page’s size chart or ask us your measurements and the item you’re eyeing, and we’ll recommend a size.
        </div>
      </div>

      <div class="faq-item">
        <button class="faq-btn" aria-expanded="false" aria-controls="faq8">Do you offer gifting or special packaging? <i class="fa-solid fa-chevron-down"></i></button>
        <div id="faq8" class="faq-panel">
          Gift notes and special wrapping are available for select items. Add a note at checkout or message support to confirm availability and fees.
        </div>
      </div>

      <div class="faq-item">
        <button class="faq-btn" aria-expanded="false" aria-controls="faq9">How do I contact you? <i class="fa-solid fa-chevron-down"></i></button>
        <div id="faq9" class="faq-panel">
          Email us at <a href="mailto:shoplokalphilippines@gmail.com">shoplokalphilippines@gmail.com</a> or use the form below. We typically reply within 24 hours (Mon–Fri).
        </div>
      </div>
    </div>

    <!-- Policy tiles -->
    <div class="policies" aria-label="Key policies">
      <article class="tile">
        <h3>Returns</h3>
        <ul>
          <li>Request within 7 days of delivery</li>
          <li>Item must be unused & with tags</li>
          <li>Photos required for defects/damage</li>
        </ul>
      </article>
      <article class="tile">
        <h3>Shipping</h3>
        <ul>
          <li>PH nationwide shipping</li>
          <li>Metro Manila: 2–4 days</li>
          <li>Provincial: 4–7 days</li>
        </ul>
      </article>
      <article class="tile">
        <h3>Payments</h3>
        <ul>
          <li>Cards (Visa/Mastercard)</li>
          <li>E-wallets (coming soon)</li>
          <li>COD on select items/areas</li>
        </ul>
      </article>
    </div>
  </section>

  <!-- CONTACT -->
  <section id="contact" class="wrap contact" aria-label="Contact Support">
    <form id="supportForm" novalidate>
      <h2 style="margin:0 0 8px">Contact Support</h2>
      <p class="note" style="margin:0 0 12px">We’ll reply from <strong>shoplokalphilippines@gmail.com</strong>.</p>

      <div class="row">
        <div>
          <label for="name">Full name</label>
          <input id="name" name="name" type="text" placeholder="Juan Dela Cruz" required />
        </div>
        <div>
          <label for="email">Email</label>
          <input id="email" name="email" type="email" placeholder="you@email.com" required />
        </div>
      </div>

      <div class="row">
        <div>
          <label for="topic">Topic</label>
          <select id="topic" name="topic">
            <option value="">Select…</option>
            <option>Orders & Shipping</option>
            <option>Returns & Refunds</option>
            <option>Product Question</option>
            <option>Website Issue</option>
            <option>Other</option>
          </select>
        </div>
        <div>
          <label for="order">Order # (optional)</label>
          <input id="order" name="order" type="text" placeholder="e.g., 12345" />
        </div>
      </div>

      <label for="subject">Subject</label>
      <input id="subject" name="subject" type="text" placeholder="Short summary of your request" />

      <label for="message">Message</label>
      <textarea id="message" name="message" placeholder="Tell us what’s up…" required></textarea>

      <!-- Honeypot -->
      <div class="hp" aria-hidden="true">
        <label>Leave this field empty<input type="text" name="company"></label>
      </div>

      <div class="actions">
        <button class="btn" type="submit" id="supportSendBtn">Send Message</button>
        <span id="supportStatus" class="status" role="status" aria-live="polite" tabindex="-1"></span>
      </div>
    </form>

    <aside class="cardy">
      <h3 style="margin:0 0 8px">Other ways to reach us</h3>
      <p><i class="fa-solid fa-envelope"></i> &nbsp; <a href="mailto:shoplokalphilippines@gmail.com">shoplokalphilippines@gmail.com</a></p>
      <p><i class="fa-solid fa-clock"></i> &nbsp; Mon–Fri, 9am–6pm PHT</p>
      <hr style="border:0;border-top:1px solid #eee;margin:12px 0">
      <p style="color:var(--muted);">Response time: usually within 24 hours. Weekends/holidays may take a bit longer.</p>
    </aside>
  </section>

  <!-- FOOTER -->
  <footer class="footer" role="contentinfo">
    <div class="footer-grid" aria-label="Site footer">
      <section class="footer-section" aria-labelledby="ft-contact-title">
        <h2 id="ft-contact-title" class="ft-title">Contact Us</h2>
        <ul class="footer-list">
          <li>
            <a href="mailto:shoplokalphilippines@gmail.com?subject=Lokal%20Support%20Request&body=Hi%20Lokal%20Team%2C%0A%0AIssue%3A%20%0AOrder%20%23%3A%20%0ABrowser%2FDevice%3A%20%0A%0AThanks%2C%0A" aria-label="Email shoplokalphilippines at gmail dot com">
              shoplokalphilippines@gmail.com
            </a>
          </li>
          <li><address style="font-style:normal">Manila, Philippines</address></li>
          <li class="border-list" aria-hidden="true"></li>
          <li class="socials" aria-label="Social links">
            <a href="#" aria-label="Instagram"><i class="fa-brands fa-square-instagram" aria-hidden="true"></i></a>
            <a href="#" aria-label="Facebook"><i class="fa-brands fa-square-facebook" aria-hidden="true"></i></a>
            <a href="#" aria-label="TikTok"><i class="fa-brands fa-tiktok" aria-hidden="true"></i></a>
          </li>
        </ul>
        <p class="ft-note" style="margin-top:8px">
          Need help? Visit our <a href="support.html">Support</a> page or email us.
        </p>
      </section>

      <nav class="footer-section" aria-labelledby="ft-links-title">
        <h2 id="ft-links-title" class="ft-title">Quick Links</h2>
        <ul class="footer-list">
          <li><a href="index.html">Home</a></li>
          <li><a href="shop-all.html">Shop All</a></li>
          <li><a href="about.html">About Us</a></li>
          <li><a href="terms.html">Terms &amp; Conditions</a></li>
          <li><a href="support.html">Support</a></li>
        </ul>
      </nav>

      <section class="footer-section" aria-labelledby="ft-news-title">
        <h2 id="ft-news-title" class="ft-title">Subscribe to Newsletter</h2>
        <p class="ft-subcopy">Get product drops, deals, and stories from local makers—straight to your inbox.</p>
        <form id="newsletterForm" class="ft-news-form" novalidate>
          <label class="sr-only" for="newsletterEmail">Email address</label>
          <input id="newsletterEmail" name="email" type="email" inputmode="email" autocomplete="email" placeholder="Your email" required aria-describedby="newsletterNote" />
          <button class="button" id="newsletterBtn" type="submit" aria-label="Subscribe to newsletter">Subscribe</button>
          <div class="ft-consent">
            <input id="newsletterConsent" name="consent" type="checkbox" required />
            <label for="newsletterConsent">I agree to the <a href="terms.html">Terms &amp; Conditions</a> and <a href="terms.html#privacy">Privacy Policy</a>.</label>
          </div>
          <p id="newsletterNote" class="ft-note">We never share your email. Unsubscribe anytime.</p>
          <div id="newsletterMsg" class="ft-msg" role="status" aria-live="polite"></div>
        </form>
      </section>
    </div>

    <div class="ft-legal">
      <small>&copy; <span id="yearNow"></span> Lokal. All rights reserved.</small>
    </div>
  </footer>

  <!-- Drawer (kept for consistency) -->
  <div class="cd-overlay" id="cdOverlay" aria-hidden="true"></div>
  <aside class="cd-drawer" id="cdDrawer" aria-hidden="true" role="dialog" aria-label="Cart drawer">
    <div class="cd-header">
      <h2>Cart</h2>
      <button id="cdClose" class="cd-close" aria-label="Close cart">×</button>
    </div>
    <div class="cd-body">
      <div id="cdItems" class="cd-items"></div>
      <div class="cd-summary">
        <div class="cd-row">
          <span>Subtotal</span>
          <strong id="cdSubtotal">₱0.00</strong>
        </div>
        <p class="cd-note">Shipping, taxes, and discount codes calculated at checkout.</p>
        <label class="cd-terms">
          <input id="cdAgree" type="checkbox">
          <span>I agree with the <a href="terms.html" target="_blank" rel="noopener">terms and conditions</a></span>
        </label>
        <button id="cdCheckout" class="cd-checkout" disabled>CHECK OUT</button>
      </div>
    </div>
  </aside>

  <!-- Core scripts -->
  <script src="cart.js" defer></script>
  <script src="wishlist.js" defer></script>
  <script src="newsletter.js" defer></script>

  <!-- FAQ + Contact behavior -->
  <script>
    /* Accordions with hash deep-link support */
    document.addEventListener('click', (e)=>{
      const btn = e.target.closest('.faq-btn');
      if(!btn) return;
      const item = btn.parentElement;
      const isOpen = item.classList.contains('open');
      document.querySelectorAll('.faq-item.open').forEach(x=>{
        if(x!==item){ x.classList.remove('open'); x.querySelector('.faq-btn').setAttribute('aria-expanded','false'); }
      });
      item.classList.toggle('open', !isOpen);
      btn.setAttribute('aria-expanded', String(!isOpen));
      if (!isOpen && item.id) history.replaceState(null, '', '#'+item.id);
    });

    /* Open a specific FAQ if hash is present */
    window.addEventListener('load', ()=>{
      const hash = location.hash.replace('#','');
      if (!hash) return;
      const item = document.getElementById(hash);
      const btn = item?.querySelector('.faq-btn');
      if (btn && item){ item.classList.add('open'); btn.setAttribute('aria-expanded','true'); item.scrollIntoView({behavior:'smooth', block:'start'}); }
    });

    /* FAQ Search (resets when empty) */
    const faqSearch = document.getElementById('faqSearch');
    if (faqSearch) {
      faqSearch.addEventListener('input', ()=>{
        const q = faqSearch.value.toLowerCase().trim();
        document.querySelectorAll('#faqList .faq-item').forEach(it=>{
          const text = it.textContent.toLowerCase();
          it.style.display = q ? (text.includes(q) ? '' : 'none') : '';
        });
      });
    }

    /* CONTACT FORM → Apps Script */
    const WEB_APP_URL = 'https://script.google.com/macros/s/AKfycbxkZCFWx_nc1KVtUzfCplWVFi-S1d6B8PUn8Wt0YhF1kcdpZZ59QMLQOLENvE6gN5Pm/exec';
    const form     = document.getElementById('supportForm');
    const statusEl = document.getElementById('supportStatus');
    const sendBtn  = document.getElementById('supportSendBtn');

    function setStatus(msg, isErr){
      statusEl.textContent = msg;
      statusEl.className = 'status ' + (isErr ? 'err' : 'ok');
      if (msg) statusEl.focus();
      if (!isErr && msg) {
        setTimeout(()=>{ statusEl.style.opacity = '0'; }, 2200);
        setTimeout(()=>{ statusEl.textContent=''; statusEl.style.opacity=''; }, 3200);
      }
    }

    form.addEventListener('submit', async (e)=>{
      e.preventDefault();
      setStatus('', false);
      sendBtn.disabled = true; sendBtn.textContent = 'Sending…';

      const fd = new FormData(form);

      const topic = (form.topic.value  || '').trim();
      const order = (form.order.value  || '').trim();
      let base    = (form.subject.value|| 'New support request').trim();
      base = base.replace(/^\s*\[[^\]]+\]\s*/g, '').replace(/\(Order\s*#\s*[^)]+\)\s*/ig, '').trim();

      const parts = [];
      if (topic) parts.push(`[${topic}]`);
      parts.push(base || 'Message');
      if (order) parts.push(`(Order #${order})`);
      const subject = parts.join(' ');
      fd.set('subject', subject);

      try{
        const res = await fetch(WEB_APP_URL, { method: 'POST', body: new URLSearchParams(fd) });
        const looksOpaque = res.type === 'opaque';
        let ok = looksOpaque || res.ok;
        if (!looksOpaque) {
          try { const data = await res.json(); if ('ok' in data) ok = !!data.ok; } catch {}
        }
        if (ok) {
          form.reset();
          setStatus('Thanks! Your message has been sent. We’ll respond within 24 hours.', false);
          form.scrollIntoView({behavior:'smooth', block:'start'});
        } else {
          setStatus('There was an error sending your message. Please try again.', true);
        }
      } catch {
        setStatus('Network error. Please try again.', true);
      } finally{
        sendBtn.disabled = false; sendBtn.textContent = 'Send Message';
      }
    });

    /* Cart drawer shim so header icon works here too */
    window.openCartDrawer = window.openCartDrawer || function(){
      document.getElementById('cdDrawer')?.classList.add('active');
      document.getElementById('cdOverlay')?.classList.add('active');
      document.body.classList.add('lock-scroll');
    };
    document.addEventListener('click', (e)=>{
      const btn = e.target.closest('#openCart');
      if (!btn) return;
      e.preventDefault();
      window.openCartDrawer();
    });
    const drawer = document.getElementById('cdDrawer');
    if (drawer){
      new MutationObserver(() => {
        document.body.classList.toggle('lock-scroll', drawer.classList.contains('active'));
      }).observe(drawer, { attributes: true, attributeFilter: ['class'] });
    }
  </script>

  <!-- Supabase + unified Account behavior -->
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <script src="supabase.js"></script>
  <script>
  (function(){
    // Open the popup programmatically
    window.openAuthPopup = () => {
      const overlay = document.getElementById('lokalAuthOverlay');
      const emailForm = document.getElementById('laEmailForm');
      const passForm  = document.getElementById('laPassForm');
      const emailIn   = document.getElementById('laEmail');
      if (!overlay || !emailForm || !passForm || !emailIn) return;
      overlay.setAttribute('aria-hidden','false');
      emailForm.hidden = false;
      passForm.hidden  = true;
      setTimeout(()=> emailIn.focus(), 50);
    };

    // Intercept Account icon click
    document.addEventListener('click', async (e) => {
      const a = e.target.closest('a[aria-label="Account"]');
      if (!a) return;
      e.preventDefault();
      const { data: { session } } = await sb.auth.getSession();
      if (session) location.href = 'user.html';
      else window.openAuthPopup();
    });

    // Auth popup controller
    const overlay   = document.getElementById('lokalAuthOverlay');
    const emailForm = document.getElementById('laEmailForm');
    const passForm  = document.getElementById('laPassForm');
    const emailIn   = document.getElementById('laEmail');
    const passIn    = document.getElementById('laPass');

    if (overlay && emailForm && passForm) {
      const closeAuth = () => overlay.setAttribute('aria-hidden','true');
      document.getElementById('laClose')?.addEventListener('click', closeAuth);
      overlay.addEventListener('click', e => { if (e.target === overlay) closeAuth(); });
      document.addEventListener('keydown', e => { if (e.key === 'Escape') closeAuth(); });

      emailForm.onsubmit = (e) => {
        e.preventDefault();
        const email = (emailIn.value || '').trim().toLowerCase();
        if (!email) { emailIn.focus(); return; }
        passForm.dataset.email = email;
        emailForm.hidden = true;
        passForm.hidden  = false;
        passIn.focus();
        document.getElementById('laBackEmail')?.addEventListener('click', ev => {
          ev.preventDefault();
          emailForm.hidden = false;
          passForm.hidden  = true;
          emailIn.focus();
        }, { once: true });
      };

      passForm.onsubmit = async (e) => {
        e.preventDefault();
        const email = passForm.dataset.email || '';
        const password = passIn.value || '';
        try {
          const { data, error } = await sb.auth.signInWithPassword({ email, password });
          if (!error && data?.user) { closeAuth(); location.href = 'user.html'; return; }
          const code = error?.code || '';
          if (code === 'invalid_credentials' || /invalid|password/i.test(error?.message||'')) { alert('Incorrect email or password.'); return; }
          const make = confirm('Account not found. Create a new one with this email?');
          if (!make) return;
          const { error: signUpError } = await sb.auth.signUp({
            email, password,
            options: { emailRedirectTo: 'https://angelique213.github.io/Lokal/user.html' }
          });
          if (signUpError) { alert(signUpError.message); return; }
          alert('Check your email to verify, then sign in.');
          closeAuth();
        } catch (err) {
          alert((err && err.message) || 'Network error. Please try again.');
        }
      };
    }

    // Footer year
    document.addEventListener('DOMContentLoaded', ()=>{
      const y = document.getElementById('yearNow');
      if (y) y.textContent = new Date().getFullYear();
    });
  })();
  </script>
</body>
</html>
